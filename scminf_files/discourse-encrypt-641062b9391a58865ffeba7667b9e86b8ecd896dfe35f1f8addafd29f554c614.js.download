define("discourse/plugins/discourse-encrypt/discourse/components/encrypt-enable-dropdown",["exports","@ember/object","I18n","select-kit/components/dropdown-select-box"],(function(e,t,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=n.default.extend({classNames:["encrypt-enable-dropdown"],selectKitOptions:{icon:"bars",showFullTitle:!1},content:(0,t.computed)("importIdentity","isEncryptEnabled",(function(){var e=[];return e.push({id:"import",icon:"file-import",name:this.importIdentity?this.isEncryptEnabled?r.default.t("encrypt.preferences.use_paper_key"):r.default.t("encrypt.preferences.generate_key"):r.default.t("encrypt.preferences.import")}),this.isEncryptEnabled&&e.push({id:"reset",icon:"trash-alt",name:r.default.t("encrypt.reset.title")}),e}))});e.default=i})),define("discourse/plugins/discourse-encrypt/discourse/components/encrypt-preferences-dropdown",["exports","select-kit/components/dropdown-select-box","I18n"],(function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=t.default.extend({classNames:["encrypt-preferences-dropdown"],selectKitOptions:{icon:"wrench",showFullTitle:!1},content:[{id:"export",icon:"file-export",name:r.default.t("encrypt.export.title")},{id:"managePaperKeys",icon:"ticket-alt",name:r.default.t("encrypt.manage_paper_keys.title")},{id:"rotate",icon:"sync",name:r.default.t("encrypt.rotate.title")},{id:"reset",icon:"trash-alt",name:r.default.t("encrypt.reset.title")}]});e.default=n})),define("discourse/plugins/discourse-encrypt/discourse/components/encrypted-post-timer-dropdown",["exports","I18n","select-kit/components/dropdown-select-box","@ember/object","@ember/object/computed"],(function(e,t,r,n,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=[{id:"",name:t.default.t("encrypt.time_bomb.never")},{id:"3",name:t.default.t("encrypt.time_bomb.3_minutes")},{id:"60",name:t.default.t("encrypt.time_bomb.1_hour")},{id:"180",name:t.default.t("encrypt.time_bomb.3_hours")},{id:"720",name:t.default.t("encrypt.time_bomb.12_hours")},{id:"1440",name:t.default.t("encrypt.time_bomb.24_hours")},{id:"4320",name:t.default.t("encrypt.time_bomb.3_days")},{id:"10080",name:t.default.t("encrypt.time_bomb.7_days")}],s=r.default.extend({classNames:["encrypted-post-timer-dropdown"],classNameBindings:["hidden:hidden"],selectKitOptions:{icon:"discourse-trash-clock",showFullTitle:!0},content:(0,n.computed)("topicDeleteAt",(function(){var e=this;return this.topicDeleteAt?o.filter((function(t){return t.id.length>0&&moment().add(t.id,"minutes")<moment(e.topicDeleteAt)})):o})),hidden:(0,i.empty)("content")});e.default=s})),Ember.TEMPLATES["javascripts/discourse/connectors/composer-action-after/encrypt"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"if",[[24,["showEncryptControls"]]],null,{"statements":[[0,"  "],[7,"div",true],[10,"class","encrypt-controls"],[8],[0,"\\n"],[4,"if",[[24,["isEncryptActive"]]],null,{"statements":[[0,"      "],[7,"a",false],[12,"href",""],[12,"title",[22,"title"]],[12,"class",[29,["btn btn-default btn-icon no-text encrypt-toggle ",[28,"if",[[24,["model","isEncrypted"]],"enabled"],null]," ",[28,"if",[[24,["disabled"]],"disabled"],null]]]],[3,"action",[[23,0,[]],"clicked"]],[8],[0,"\\n        "],[1,[28,"d-icon",[[28,"if",[[24,["model","isEncrypted"]],"lock","unlock"],null]],null],false],[0,"\\n      "],[9],[4,"if",[[24,["model","isEncrypted"]]],null,{"statements":[[4,"unless",[[24,["model","editingPost"]]],null,{"statements":[[7,"div",true],[10,"class","composer-action-divider"],[8],[9],[1,[28,"encrypted-post-timer-dropdown",null,[["topicDeleteAt","onChange"],[[23,0,["model","topic","delete_at"]],[28,"action",[[23,0,[]],"timerClicked"],null]]]],false],[0,"\\n          "],[7,"span",true],[11,"title",[28,"i18n",["encrypt.time_bomb.title"],[["after"],[[23,0,["model","deleteAfterMinutesLabel"]]]]]],[8],[1,[23,0,["model","deleteAfterMinutesLabel"]],false],[9],[0,"\\n"]],"parameters":[]},null]],"parameters":[]},null],[0,"\\n"],[4,"if",[[24,["model","showEncryptError"]]],null,{"statements":[[0,"        "],[7,"span",true],[10,"class","error"],[8],[1,[24,["model","encryptError"]],false],[9],[0,"\\n"]],"parameters":[]},null]],"parameters":[]},{"statements":[[4,"if",[[24,["isEncryptEnabled"]]],null,{"statements":[[0,"      "],[7,"span",true],[11,"title",[28,"i18n",["encrypt.preferences.status_enabled_but_inactive"],null]],[8],[0,"\\n        "],[1,[28,"d-icon",["unlock"],[["class"],["disabled"]]],false],[0,"\\n      "],[9],[0,"\\n    "]],"parameters":[]},null]],"parameters":[]}],[0,"  "],[9],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/connectors/composer-action-after/encrypt"}}),define("discourse/plugins/discourse-encrypt/discourse/connectors/composer-action-after/encrypt",["exports","@ember/object","discourse/plugins/discourse-encrypt/lib/discourse","I18n"],(function(e,t,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i={setupComponent:function(e,i){var o=this,s=i.currentUser;i.setProperties({encryptStatus:(0,r.getEncryptionStatus)(s),listener:function(){i.set("encryptStatus",(0,r.getEncryptionStatus)(s))},didInsertElement:function(){this._super.apply(this,arguments),this.appEvents.on("encrypt:status-changed",this,this.listener)},willDestroyElement:function(){this._super.apply(this,arguments),this.appEvents.off("encrypt:status-changed",this,this.listener)}}),(0,t.defineProperty)(i,"isEncryptEnabled",(0,t.computed)("encryptStatus",(function(){return o.encryptStatus!==r.ENCRYPT_DISABLED}))),(0,t.defineProperty)(i,"isEncryptActive",(0,t.computed)("encryptStatus",(function(){return o.encryptStatus===r.ENCRYPT_ACTIVE}))),(0,t.defineProperty)(i,"showEncryptControls",(0,t.computed)("model.isNew","model.creatingPrivateMessage","model.topic.encrypted_title",(function(){return o.model.isNew&&o.model.creatingPrivateMessage||o.model.topic&&o.model.topic.encrypted_title}))),(0,t.defineProperty)(i,"canEncrypt",(0,t.computed)("model.encryptError",(function(){return!o.model.encryptError}))),(0,t.defineProperty)(i,"canDisableEncrypt",(0,t.computed)("model.topic.encrypted_title",(function(){return!(o.model.topic&&o.model.topic.encrypted_title)}))),(0,t.defineProperty)(i,"disabled",(0,t.computed)("model.isEncrypted","canEncrypt","canDisableEncrypt",(function(){return o.model.isEncrypted?!o.canDisableEncrypt:!o.canEncrypt}))),(0,t.defineProperty)(i,"title",(0,t.computed)("model.isEncrypted","model.encryptError",(function(){return o.model.encryptError?o.model.encryptError:o.model.isEncrypted?n.default.t("encrypt.checkbox.checked"):n.default.t("encrypt.checkbox.unchecked")})))},actions:{clicked:function(){this.disabled?this.model.set("showEncryptError",!this.model.showEncryptError):this.model.setProperties({isEncrypted:!this.model.isEncrypted,isEncryptedChanged:!0,showEncryptError:!this.model.isEncrypted,deleteAfterMinutes:null,deleteAfterMinutesLabel:null})},timerClicked:function(e,t){var r=t.name;e?this.model.setProperties({deleteAfterMinutes:e,deleteAfterMinutesLabel:r}):this.model.setProperties({deleteAfterMinutes:null,deleteAfterMinutesLabel:null})}}};e.default=i})),Ember.TEMPLATES["javascripts/discourse/connectors/user-preferences-security/encrypt"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"if",[[24,["canEnableEncrypt"]]],null,{"statements":[[0,"  "],[7,"div",true],[10,"class","control-group pref-title"],[8],[0,"\\n    "],[7,"label",true],[10,"class","control-label"],[8],[1,[28,"i18n",["encrypt.title"],null],false],[9],[0,"\\n"],[4,"if",[[24,["capabilities","isIE11"]]],null,{"statements":[[0,"      "],[7,"div",true],[10,"class","alert alert-error"],[8],[0,"\\n        "],[7,"p",true],[8],[1,[28,"i18n",["encrypt.preferences.ie11"],null],false],[9],[0,"\\n      "],[9],[0,"\\n"]],"parameters":[]},{"statements":[[4,"if",[[24,["isInsecureContext"]]],null,{"statements":[[0,"      "],[7,"div",true],[10,"class","alert alert-error"],[8],[0,"\\n        "],[7,"p",true],[8],[1,[28,"i18n",["encrypt.preferences.insecure_context"],null],false],[9],[0,"\\n      "],[9],[0,"\\n"]],"parameters":[]},{"statements":[[0,"      "],[7,"div",true],[10,"class","controls"],[8],[0,"\\n"],[4,"if",[[24,["isCurrentUser"]]],null,{"statements":[[4,"if",[[24,["isEncryptEnabled"]]],null,{"statements":[[4,"if",[[24,["isEncryptActive"]]],null,{"statements":[[0,"              "],[7,"p",true],[8],[1,[28,"i18n",["encrypt.preferences.status_enabled"],null],false],[9],[0,"\\n              "],[1,[28,"d-button",null,[["icon","action","label","id"],["times",[28,"action",[[23,0,[]],"deactivateEncrypt"],null],"encrypt.preferences.deactivate","deactivate"]]],false],[0,"\\n              "],[1,[28,"d-button",null,[["icon","action","label"],["plus",[28,"action",[[23,0,[]],"generatePaperKey",true],null],"encrypt.generate_paper_key.title_device"]]],false],[0,"\\n              "],[1,[28,"d-button",null,[["icon","action","label"],["ticket-alt",[28,"action",[[23,0,[]],"generatePaperKey"],null],"encrypt.generate_paper_key.title"]]],false],[0,"\\n              "],[1,[28,"encrypt-preferences-dropdown",null,[["onChange"],[[28,"action",[[23,0,[]],"selectEncryptPreferencesDropdownAction"],null]]]],false],[0,"\\n"]],"parameters":[]},{"statements":[[0,"              "],[7,"form",true],[8],[0,"\\n                "],[7,"p",true],[8],[1,[28,"i18n",["encrypt.preferences.status_enabled_but_inactive"],null],false],[9],[0,"\\n\\n"],[4,"if",[[24,["importIdentity"]]],null,{"statements":[[0,"                  "],[1,[28,"html-safe",[[28,"i18n",["encrypt.preferences.notice_import"],null]],null],false],[0,"\\n                  "],[1,[28,"textarea",null,[["class","value","placeholder"],["imported-key-pair",[24,["identity"]],[24,["identityPlaceholder"]]]]],false],[0,"\\n"]],"parameters":[]},{"statements":[[0,"                  "],[1,[28,"html-safe",[[28,"i18n",["encrypt.preferences.notice_active"],null]],null],false],[0,"\\n                  "],[7,"p",true],[8],[0,"\\n                    "],[7,"label",true],[10,"for","password"],[8],[1,[28,"i18n",["encrypt.preferences.paper_key_label"],null],false],[9],[0,"\\n                    "],[1,[28,"input",null,[["type","value","placeholder","id","autocomplete","disabled"],["password",[24,["passphrase"]],[28,"i18n",["encrypt.preferences.paper_key_placeholder"],null],"passphrase","current-password",[24,["inProgress"]]]]],false],[0,"\\n                  "],[9],[0,"\\n"]],"parameters":[]}],[0,"\\n                "],[7,"p",true],[8],[0,"\\n                  "],[1,[28,"d-button",null,[["class","icon","action","type","disabled","label"],["btn-primary","unlock",[28,"action",[[23,0,[]],"activateEncrypt"],null],"submit",[24,["inProgress"]],"encrypt.preferences.activate"]]],false],[0,"\\n                  "],[1,[28,"encrypt-enable-dropdown",null,[["isEncryptEnabled","importIdentity","onChange"],[[24,["isEncryptEnabled"]],[24,["importIdentity"]],[28,"action",[[23,0,[]],"selectEncryptEnableDropdownAction"],null]]]],false],[0,"\\n                "],[9],[0,"\\n              "],[9],[0,"\\n"]],"parameters":[]}]],"parameters":[]},{"statements":[[0,"            "],[7,"p",true],[8],[1,[28,"i18n",["encrypt.preferences.status_disabled"],null],false],[9],[0,"\\n"],[4,"if",[[24,["importIdentity"]]],null,{"statements":[[0,"              "],[1,[28,"html-safe",[[28,"i18n",["encrypt.preferences.notice_import"],null]],null],false],[0,"\\n              "],[1,[28,"textarea",null,[["class","value","placeholder"],["imported-key-pair",[24,["identity"]],[24,["identityPlaceholder"]]]]],false],[0,"\\n"]],"parameters":[]},null],[0,"            "],[1,[28,"d-button",null,[["class","icon","action","disabled","label"],["btn-primary","lock",[28,"action",[[23,0,[]],"enableEncrypt"],null],[24,["inProgress"]],"encrypt.preferences.enable"]]],false],[0,"\\n            "],[1,[28,"encrypt-enable-dropdown",null,[["isEncryptEnabled","importIdentity","onChange"],[[24,["isEncryptEnabled"]],[24,["importIdentity"]],[28,"action",[[23,0,[]],"selectEncryptEnableDropdownAction"],null]]]],false],[0,"\\n"]],"parameters":[]}]],"parameters":[]},{"statements":[[4,"if",[[24,["isEncryptEnabled"]]],null,{"statements":[[0,"            "],[7,"p",true],[8],[1,[28,"i18n",["encrypt.preferences.status_enabled_other"],null],false],[9],[0,"\\n            "],[7,"p",true],[8],[7,"a",false],[12,"href",""],[12,"class","text-danger"],[3,"action",[[23,0,[]],"selectEncryptEnableDropdownAction","reset"]],[8],[1,[28,"i18n",["encrypt.reset.title"],null],false],[9],[9],[0,"\\n"]],"parameters":[]},{"statements":[[0,"            "],[7,"p",true],[8],[1,[28,"i18n",["encrypt.preferences.status_disabled_other"],null],false],[9],[0,"\\n"]],"parameters":[]}]],"parameters":[]}],[0,"      "],[9],[0,"\\n    "]],"parameters":[]}]],"parameters":[]}],[0,"  "],[9],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/connectors/user-preferences-security/encrypt"}}),define("discourse/plugins/discourse-encrypt/discourse/connectors/user-preferences-security/encrypt",["exports","@ember/object","discourse/lib/show-modal","discourse/plugins/discourse-encrypt/lib/database","discourse/plugins/discourse-encrypt/lib/discourse","discourse/plugins/discourse-encrypt/lib/pack","discourse/plugins/discourse-encrypt/lib/protocol","I18n"],(function(e,t,r,n,i,o,s,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var c={setupComponent:function(e,r){var n=this;r.set("isInsecureContext",!window.isSecureContext),(0,t.defineProperty)(r,"canEnableEncrypt",(0,t.computed)("model.can_encrypt",(function(){return n.model.can_encrypt}))),(0,t.defineProperty)(r,"isCurrentUser",(0,t.computed)("currentUser.id","model.id",(function(){return n.currentUser.id===n.model.id}))),r.isCurrentUser?(r.setProperties({encryptStatus:(0,i.getEncryptionStatus)(e.model),passphrase:"",importIdentity:!1,identity:"",identityPlaceholder:(0,o.getPackedPlaceholder)(),inProgress:!1,listener:function(){r.set("encryptStatus",(0,i.getEncryptionStatus)(e.model))},didInsertElement:function(){this._super.apply(this,arguments),this.appEvents.on("encrypt:status-changed",this,this.listener)},willDestroyElement:function(){this._super.apply(this,arguments),this.appEvents.off("encrypt:status-changed",this,this.listener)}}),(0,t.defineProperty)(r,"isEncryptEnabled",(0,t.computed)("encryptStatus",(function(){return n.encryptStatus!==i.ENCRYPT_DISABLED}))),(0,t.defineProperty)(r,"isEncryptActive",(0,t.computed)("encryptStatus",(function(){return n.encryptStatus===i.ENCRYPT_ACTIVE})))):(0,t.defineProperty)(r,"isEncryptEnabled",(0,t.computed)("model.encrypt_public",(function(){return!!n.model.encrypt_public})))},actions:{enableEncrypt:function(){var e=this;return this.set("inProgress",!0),(0,i.enableEncrypt)(this.model,this.importIdentity&&this.identity).then((function(){e.appEvents.trigger("encrypt:status-changed")})).catch((function(){return bootbox.alert(a.default.t("encrypt.preferences.key_pair_invalid"))})).finally((function(){e.setProperties({passphrase:"",inProgress:!1,importIdentity:!1,identity:""})}))},activateEncrypt:function(){var e=this;return this.set("inProgress",!0),(this.importIdentity?(0,s.importIdentity)((0,o.unpackIdentity)(this.identity)).then((function(e){return(0,n.saveDbIdentity)(e)})):(0,i.activateEncrypt)(this.model,this.passphrase)).then((function(){e.appEvents.trigger("encrypt:status-changed")})).catch((function(){e.importIdentity?bootbox.alert(a.default.t("encrypt.preferences.key_pair_invalid")):bootbox.alert(a.default.t("encrypt.preferences.paper_key_invalid"))})).finally((function(){return e.setProperties({passphrase:"",inProgress:!1,importIdentity:!1,identity:""})}))},deactivateEncrypt:function(){var e=this;this.setProperties("inProgress",!0),(0,n.deleteDb)().then((function(){e.appEvents.trigger("encrypt:status-changed")})).finally((function(){return e.set("inProgress",!1)}))},generatePaperKey:function(e){(0,r.default)("generate-paper-key",{model:{user:this.model,device:e}})},selectEncryptPreferencesDropdownAction:function(e){switch(e){case"export":(0,r.default)("export-key-pair",{model:this.model});break;case"managePaperKeys":(0,r.default)("manage-paper-keys",{model:this.model});break;case"rotate":(0,r.default)("rotate-key-pair",{model:this.model});break;case"reset":(0,r.default)("reset-key-pair",{model:this.model})}},selectEncryptEnableDropdownAction:function(e){switch(e){case"import":this.toggleProperty("importIdentity");break;case"reset":(0,r.default)("reset-key-pair",{model:this.model})}}}};e.default=c})),define("discourse/plugins/discourse-encrypt/discourse/controllers/activate-encrypt",["exports","@ember/controller","discourse/mixins/modal-functionality","discourse/plugins/discourse-encrypt/lib/discourse","I18n"],(function(e,t,r,n,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=t.default.extend(r.default,{onShow:function(){var e=this.widgets||[];e.push(this.model.widget),this.setProperties({widgets:e,passphrase:"",error:""})},onClose:function(){this.widgets&&this.widgets.forEach((function(e){e.state.encryptState="error",e.state.error=i.default.t("encrypt.preferences.status_enabled_but_inactive"),e.scheduleRerender()}))},actions:{activate:function(){var e=this;return this.set("inProgress",!0),(0,n.activateEncrypt)(this.currentUser,this.passphrase).then((function(){e.appEvents.trigger("encrypt:status-changed"),e.widgets.forEach((function(e){e.state.encryptState="decrypting",e.scheduleRerender()})),e.set("widgets",null),e.send("closeModal")})).catch((function(){return e.set("error",i.default.t("encrypt.preferences.paper_key_invalid"))})).finally((function(){return e.set("inProgress",!1)}))}}});e.default=o})),define("discourse/plugins/discourse-encrypt/discourse/controllers/export-key-pair",["exports","@ember/controller","@ember/runloop","discourse/lib/copy-text","discourse/mixins/modal-functionality","discourse/plugins/discourse-encrypt/lib/discourse","discourse/plugins/discourse-encrypt/lib/pack","discourse/plugins/discourse-encrypt/lib/protocol","I18n"],(function(e,t,r,n,i,o,s,a,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var u=t.default.extend(i.default,{onShow:function(){var e=this;this.setProperties({inProgress:!0,exported:""}),(0,o.getIdentity)().then((function(e){return(0,a.exportIdentity)(e)})).then((function(t){e.setProperties({exported:(0,s.packIdentity)(t.private),inProgress:!1})})).catch((function(){e.setProperties({inProgress:!1,error:c.default.t("encrypt.preferences.paper_key_invalid")})}))},onClose:function(){this.setProperties({inProgress:!1,exported:""})},actions:{copy:function(){var e=this,t=document.querySelector("pre.exported-key-pair");(0,n.default)("",t)&&(this.set("copied",!0),(0,r.later)((function(){return e.set("copied",!1)}),2e3))}}});e.default=u})),define("discourse/plugins/discourse-encrypt/discourse/controllers/generate-paper-key",["exports","@ember/controller","discourse/lib/ajax","discourse/mixins/modal-functionality","discourse/plugins/discourse-encrypt/lib/discourse","discourse/plugins/discourse-encrypt/lib/paper-key","discourse/plugins/discourse-encrypt/lib/protocol"],(function(e,t,r,n,i,o,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=t.default.extend(n.default,{onShow:function(){var e=this;this.set("inProgress",!0);var t=(0,o.generatePaperKey)(),n=this.model.device?"device":"paper_"+t.substr(0,t.indexOf(" ")).toLowerCase();(0,i.getIdentity)().then((function(e){return(0,s.exportIdentity)(e,t)})).then((function(i){return e.set("paperKey",t),(0,r.ajax)("/encrypt/keys",{type:"PUT",data:{public:i.public,private:i.private,label:n}})})).finally((function(){return e.set("inProgress",!1)}))},onClose:function(){this.setProperties({paperKey:"",inProgress:!1})}});e.default=a})),define("discourse/plugins/discourse-encrypt/discourse/controllers/manage-paper-keys",["exports","@ember/controller","discourse-common/utils/decorators","discourse/lib/ajax","discourse/lib/show-modal","discourse/mixins/modal-functionality"],(function(e,t,r,n,i,o){"use strict";var s,a;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var c,u,l,p,d,E,f=t.default.extend(o.default,(s=(0,r.default)("model.encrypt_private"),c=a={keys:function(){var e=[];if(this.model.encrypt_private){var t=JSON.parse(this.model.encrypt_private);Object.keys(t).forEach((function(t){t.startsWith("paper_")?e.push({isPaper:!0,label:t,name:t.substr("paper_".length)}):"passphrase"===t&&e.unshift({isPassphrase:!0,label:"passphrase"})}))}return e},actions:{generatePaperKey:function(){(0,i.default)("generate-paper-key",{model:{user:this.model,device:!1}})},delete:function(e){return(0,n.ajax)("/encrypt/keys",{type:"DELETE",data:{label:e}})}}},u="keys",l=[s],p=Object.getOwnPropertyDescriptor(a,"keys"),d=a,E={},Object.keys(p).forEach((function(e){E[e]=p[e]})),E.enumerable=!!E.enumerable,E.configurable=!!E.configurable,("value"in E||E.initializer)&&(E.writable=!0),E=l.slice().reverse().reduce((function(e,t){return t(c,u,e)||e}),E),d&&void 0!==E.initializer&&(E.value=E.initializer?E.initializer.call(d):void 0,E.initializer=void 0),void 0===E.initializer&&(Object.defineProperty(c,u,E),E=null),a));e.default=f})),define("discourse/plugins/discourse-encrypt/discourse/controllers/reset-key-pair",["exports","@ember/controller","discourse-common/utils/decorators","discourse/lib/ajax","discourse/lib/ajax-error","discourse/mixins/modal-functionality","discourse/plugins/discourse-encrypt/lib/database","rsvp"],(function(e,t,r,n,i,o,s,a){"use strict";var c,u;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var l,p,d,E,f,y,m=t.default.extend(o.default,(c=(0,r.default)("isLoadingStats","inProgress","encryptedPmsCount","currentUser.username","confirmation"),l=u={onShow:function(){var e=this;this.setProperties({isLoadingStats:!0,inProgress:!1,encryptedPmsCount:null,confirmation:""}),(0,n.ajax)("/encrypt/stats",{data:{user_id:this.get("model.id")}}).then((function(t){t.encrypted_pms_count>0&&e.set("encryptedPmsCount",t.encrypted_pms_count)})).finally((function(){e.set("isLoadingStats",!1)}))},disabled:function(e,t,r,n,i){return e||t||r&&r>0&&n!==i},actions:{reset:function(){var e=this;this.set("inProgress",!0),a.Promise.all([(0,n.ajax)("/encrypt/reset",{type:"POST",data:{user_id:this.get("model.id")}}),s.deleteDb]).then((function(){e.currentUser.setProperties({encrypt_public:null,encrypt_private:null}),e.appEvents.trigger("encrypt:status-changed"),e.send("closeModal")})).catch(i.popupAjaxError).finally((function(){e.set("inProgress",!1)}))}}},p="disabled",d=[c],E=Object.getOwnPropertyDescriptor(u,"disabled"),f=u,y={},Object.keys(E).forEach((function(e){y[e]=E[e]})),y.enumerable=!!y.enumerable,y.configurable=!!y.configurable,("value"in y||y.initializer)&&(y.writable=!0),y=d.slice().reverse().reduce((function(e,t){return t(l,p,e)||e}),y),f&&void 0!==y.initializer&&(y.value=y.initializer?y.initializer.call(f):void 0,y.initializer=void 0),void 0===y.initializer&&(Object.defineProperty(l,p,y),y=null),u));e.default=m})),define("discourse/plugins/discourse-encrypt/discourse/controllers/rotate-key-pair",["exports","@ember/controller","discourse-common/utils/decorators","discourse/lib/ajax","discourse/lib/ajax-error","discourse/mixins/modal-functionality","discourse/plugins/discourse-encrypt/lib/database","discourse/plugins/discourse-encrypt/lib/discourse","discourse/plugins/discourse-encrypt/lib/protocol","rsvp"],(function(e,t,r,n,i,o,s,a,c,u){"use strict";var l,p,d;function E(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw o}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return f(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return f(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function y(e,t,r,n,i){var o={};return Object.keys(n).forEach((function(e){o[e]=n[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce((function(r,n){return n(e,t,r)||r}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var m=t.default.extend(o.default,(l=(0,r.default)("loading"),p=(0,r.default)("loading","currentUser.username","confirmation"),y(d={onShow:function(){this.setProperties({confirmation:"",loading:!1,error:null})},label:function(e){return e?"encrypt.rotate.".concat(e):"encrypt.rotate.title"},disabled:function(e,t,r){return e||t!==r},actions:{rotate:function(){var e=this;this.set("loading","fetching"),this.appEvents.trigger("modal-body:clearFlash"),u.Promise.all([(0,n.ajax)("/encrypt/rotate"),(0,a.getIdentity)(),(0,c.generateIdentity)()]).then((function(t){var r=E(t,3),n=r[0],i=r[1],o=r[2];e.set("loading","rotating"),o.signPublic=i.signPublic,o.signPrivate=i.signPrivate;var s=Object.keys(n.topic_keys);return u.Promise.all([o,(0,c.exportIdentity)(o),u.Promise.all(s.map((function(e){return(0,c.importKey)(n.topic_keys[e],i.encryptPrivate).then((function(e){return(0,c.exportKey)(e,o.encryptPublic)}))}))).then((function(e){for(var t={},r=0;r<s.length;++r)t[s[r]]=e[r];return t}))])})).then((function(t){var r=E(t,3),i=r[0],o=r[1],a=r[2];return e.set("loading","saving"),(0,n.ajax)("/encrypt/rotate",{type:"PUT",data:{public:o.public,keys:a}}).then((function(){return e.set("loading","updating"),(0,s.saveDbIdentity)(i)})).then((function(){e.set("loading","finished"),e.appEvents.trigger("encrypt:status-changed")}))})).catch((function(t){e.setProperties({confirmation:"",loading:null}),e.appEvents.trigger("modal-body:flash",{messageClass:"error",text:(0,i.extractError)(t)})}))}}},"label",[l],Object.getOwnPropertyDescriptor(d,"label"),d),y(d,"disabled",[p],Object.getOwnPropertyDescriptor(d,"disabled"),d),d));e.default=m})),define("discourse/plugins/discourse-encrypt/discourse/initializers/add-search-results",["exports","discourse-common/lib/icon-library","discourse/lib/ajax","discourse/lib/plugin-api","discourse/models/post","discourse/models/topic","discourse/plugins/discourse-encrypt/lib/discourse","I18n","rsvp"],(function(e,t,r,n,i,o,s,a,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var u="discourse-encrypt-cache";function l(e,t,r){e[t]||(e[t]={}),e[t][r.id]=r}function p(e,r){return(0,s.putTopicKey)(r.id,r.topic_key),(0,s.putTopicTitle)(r.id,r.encrypted_title),(0,s.getTopicTitle)(r.id).then((function(n){return r.title=n,r.fancy_title="".concat((0,t.iconHTML)("user-secret")," ").concat(n),r.excerpt=null,l(e,"topics",r),r}))}function d(e){return(0,r.ajax)("/encrypt/posts").then((function(t){t.posts.forEach((function(t){return function(e,t){t.topic_title_headline=null,l(e,"posts",t)}(e,t)}));var r=t.topics.map((function(t){return p(e,t).catch((function(){}))}));return c.Promise.all(r)}))}var E={name:"add-search-results",initialize:function(e){var t=e.lookup("current-user:main");if((0,s.getEncryptionStatus)(t)===s.ENCRYPT_ACTIVE){var r=e.lookup("session:main");(0,n.withPluginApi)("0.11.3",(function(e){e.addSearchResultsCallback((function(e){var t,n=function(e){var t=e.get(u);return t||e.set(u,t={}),t}(r),s=[];if(e.topics.forEach((function(e){e.topic_key&&s.push(p(n,e).catch((function(){})))})),"private_messages"===(null==e||null===(t=e.grouped_search_result)||void 0===t?void 0:t.type_filter)){var l=c.Promise.resolve();n.loaded||(l=d(n),n.loaded=!0),s.push(l.then((function(){return function(e,t){var r=t.grouped_search_result.term.toLowerCase().trim().split(/\s+/).filter((function(e){return!e.startsWith("@")&&!e.includes(":")})),n=new Set(t.topics.map((function(e){return e.id}))),s={};Object.values(e.topics||{}).forEach((function(e){n.has(e.id)||r.every((function(t){return e.title.toLowerCase().includes(t)}))&&(s[e.id]=e=o.default.create(e),t.topics.unshift(e))})),Object.values(e.posts||{}).forEach((function(e){1===e.post_number&&s[e.topic_id]&&((e=i.default.create(e)).setProperties({topic:s[e.topic_id],blurb:a.default.t("encrypt.encrypted_post")}),t.posts.unshift(e),t.grouped_search_result.post_ids.unshift(e.id))})),t.posts.map((function(t){e.topics[t.topic_id]&&t.set("topic_title_headline","")}))}(n,e)})))}return c.Promise.all(s).then((function(){return e}))}))}))}}};e.default=E})),define("discourse/plugins/discourse-encrypt/discourse/initializers/auto-enable-encrypt",["exports","discourse/plugins/discourse-encrypt/lib/discourse"],(function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r="discourse-encrypt-auto-enable",n={name:"auto-enable-encrypt",initialize:function(e){if(e.lookup("site-settings:main").auto_enable_encrypt){var n=e.lookup("current-user:main");n?window.localStorage.getItem(r)||(0,t.getEncryptionStatus)(n)!==t.ENCRYPT_DISABLED||(window.localStorage.setItem(r,!0),(0,t.enableEncrypt)(n).then((function(){e.lookup("service:app-events").trigger("encrypt:status-changed")}))):window.localStorage.removeItem(r)}}};e.default=n})),define("discourse/plugins/discourse-encrypt/discourse/initializers/decrypt-post-revision",["exports","discourse/lib/plugin-api","discourse/lib/text","discourse/plugins/discourse-encrypt/lib/discourse","discourse/plugins/discourse-encrypt/lib/protocol","rsvp"],(function(e,t,r,n,i,o){"use strict";function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw o}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var c={name:"decrypt-post-revisions",initialize:function(e){var a=e.lookup("current-user:main");(0,n.getEncryptionStatus)(a)===n.ENCRYPT_ACTIVE&&(0,t.withPluginApi)("0.11.3",(function(e){e.modifyClassStatic("model:post",{pluginId:"decrypt-post-revisions",loadRevision:function(){return this._super.apply(this,arguments).then((function(e){if(!(0,n.hasTopicKey)(e.topic_id))return e;var t=(0,n.getTopicKey)(e.topic_id);return o.Promise.all([t.then((function(t){return(0,i.decrypt)(t,e.raws.previous)})),t.then((function(t){return(0,i.decrypt)(t,e.raws.current)}))]).then((function(e){var t=s(e,2),n=t[0],i=t[1];return o.Promise.all([n.raw,(0,r.cookAsync)(n.raw),i.raw,(0,r.cookAsync)(i.raw)])})).then((function(t){var r=s(t,4),n=r[0],i=r[1],o=r[2],a=r[3];return e.body_changes.side_by_side='\n                <div class="revision-content">'.concat(i,'</div>\n                <div class="revision-content">').concat(a,"</div>"),e.body_changes.side_by_side_markdown='\n                <table class="markdown">\n                  <tr>\n                    <td class="diff-del">'.concat(n,'</td>\n                    <td class="diff-ins">').concat(o,"</td>\n                  </tr>\n                </table>"),e}))}))}})}))}};e.default=c})),define("discourse/plugins/discourse-encrypt/discourse/initializers/decrypt-posts",["exports","@ember/runloop","discourse-common/lib/icon-library","discourse/helpers/loading-spinner","discourse/lib/ajax","discourse/lib/lightbox","discourse/lib/link-hashtags","discourse/lib/link-mentions","discourse/lib/load-oneboxes","discourse/lib/plugin-api","discourse/lib/show-modal","discourse/lib/text","discourse/lib/uploads","discourse/plugins/discourse-encrypt/lib/base64","discourse/plugins/discourse-encrypt/lib/debounced-queue","discourse/plugins/discourse-encrypt/lib/discourse","discourse/plugins/discourse-encrypt/lib/protocol","discourse/plugins/discourse-encrypt/lib/uploads","I18n","pretty-text/engines/discourse-markdown-it","pretty-text/upload-short-url","rsvp"],(function(e,t,r,n,i,o,s,a,c,u,l,p,d,E,f,y,m,A,h,T,R,I){"use strict";function S(e){return function(e){if(Array.isArray(e))return b(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return b(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return b(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var O;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var v,g,P=[];function N(e){var t=e.data("orig-src")||e.data("orig-href"),r=(0,R.lookupCachedUploadUrl)(t),n=r.short_path;if(n){var i=e.closest("[data-topic-id]").data("topic-id"),o=e.data("key")?new I.Promise((function(t,r){window.crypto.subtle.importKey("raw",(0,E.base64ToBuffer)(e.data("key")),{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]).then(t,r)})):(0,y.getTopicKey)(i);if("A"===e.prop("tagName")){if(e.removeAttr("data-orig-href"),n===R.MISSING)return;if(e.attr("href",n),!(e.data("key")||e.text().endsWith(".encrypted"))||!e.hasClass(T.ATTACHMENT_CSS_CLASS))return;e.off("click.discourse-encrypt"),e.on("click.discourse-encrypt",(function(){return(0,A.downloadEncryptedFile)(n,o,{type:e.data("type")}).then((function(t){var r=document.createElement("a");r.href=window.URL.createObjectURL(t.blob),r.download=(t.name||e.text()).replace(/\.encrypted$/,""),r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(r.href)})),!1}))}else if("IMG"===e.prop("tagName")){if(e.removeAttr("data-orig-src"),n===R.MISSING)return;return e.data("key")||e.attr("alt").endsWith(".encrypted")?(r.promise||(r.promise=(0,A.downloadEncryptedFile)(n,o,{type:e.data("type")})),r.promise.then((function(e){return r.url=e.blob_url=window.URL.createObjectURL(e.blob),e})),r.promise.then((function(t){var r=t.name?(0,d.markdownNameFromFileName)(t.name):e.attr("alt").replace(/\.encrypted$/,"");e.attr("alt",r),e.attr("src",t.blob_url)}))):void e.attr("src",n)}}}var L={name:"decrypt-posts",initialize:function(e){var d=e.lookup("current-user:main"),E=e.lookup("site-settings:main");(0,y.getEncryptionStatus)(d)!==y.ENCRYPT_DISABLED&&(0,u.withPluginApi)("0.11.3",(function(e){var u={};function d(e,t,r){var n=this,i=e.encrypted_raw;if(i&&t.ciphertext!==i){if(!window.isSecureContext)return t.encryptState="error",void(t.error=h.default.t("encrypt.preferences.insecure_context"));if(i&&!(0,y.hasTopicKey)(r))return t.encryptState="error",void(t.error=h.default.t("encrypt.missing_topic_key"));t.encryptState="decrypting",t.ciphertext=i,(0,y.getIdentity)().then((function(){(0,y.getTopicKey)(r).then((function(r){(0,m.decrypt)(r,i).then((function(t){return t.signature&&(O||(O=new f.default(500,y.getUserIdentities)),O.push(t.signed_by_name).then((function(e){return e[t.signed_by_name]})).then((function(e){return(0,m.verify)(e.signPublic,t,i)})).then((function(r){u[e.id]=function(e,t){var r={user_id:e.user_id,user_name:e.username,created_at:e.created_at,updated_at:e.updated_at,topic_id:e.topicId,post_id:e.id,post_number:e.post_number},n=[];if(Object.keys(t).forEach((function(i){if("raw"!==i&&"signed_by_id"!==i&&"signed_by_name"!==i&&("user_id"!==i||e.user_name===t.user_name)){var o=r[i],s=t[i],a=o!==s;"created_at"!==i&&"updated_at"!==i||(o=new Date(o),s=new Date(s),a=Math.abs(o-s)>=5e3),a&&n.push({attr:i,actual:o,expected:s})}})),t.signed_by_name!==e.username&&n.push({attr:"signed_by_name",actual:t.signed_by_name,expected:e.username}),console&&console.warn&&n.length>0){var i="";i+="Integrity check for post #".concat(e.post_number," (post ID ").concat(e.id,") failed.\n"),n.forEach((function(e){return i+="  - ".concat(e.attr,' - expected "').concat(e.expected,'" vs actual "').concat(e.actual,'"\n')})),console.warn(i)}return n}(e,t),r||u[e.id].push({attr:"signature",actual:!1,expected:!0})})).catch((function(){u[e.id]=[{attr:"signature",actual:!1,expected:!0}]})).finally((function(){return n.scheduleRerender()}))),(0,p.cookAsync)(t.raw)})).then((function(e){t.encryptState="decrypted",t.plaintext=e.string,n.scheduleRerender()})).catch((function(){t.encryptState="error",t.error=h.default.t("encrypt.invalid_ciphertext"),n.scheduleRerender()}))})).catch((function(){t.encryptState="error",t.error=h.default.t("encrypt.invalid_topic_key"),n.scheduleRerender()}))})).catch((function(){(0,l.default)("activate-encrypt",{model:{widget:n}})}))}}function A(e,o,u){var l=this;return"decrypting"===o.encryptState?e.cooked="<div class='alert alert-info'>"+(0,n.renderSpinner)("small")+" "+h.default.t("encrypt.decrypting")+"</div>":"decrypted"===o.encryptState?(e.cooked=o.plaintext,(0,t.next)((function(){var t=document.querySelector("article[data-post-id='".concat(e.id,"']"))||document.querySelector("#post_".concat(e.post_number,".small-action"));!function(e,t,r){var n,o=$(r),u=(0,a.linkSeenMentions)(r,e);u.length>0&&(P[t]||(P[t]=new f.default(500,(function(e){return(0,a.fetchUnseenMentions)(e,t)}))),(n=P[t]).push.apply(n,S(u)).then((function(){return(0,a.linkSeenMentions)(r,e)})));var l,p=(0,s.linkSeenHashtags)(o);p.length>0&&(v||(v=new f.default(500,s.fetchUnseenHashtags)),(l=v).push.apply(l,S(p)).then((function(){(0,s.linkSeenHashtags)(o)}))),r.querySelectorAll("img[data-orig-src], a[data-orig-href]").forEach((function(e){var t=e.dataset.origSrc||e.dataset.origHref;(0,R.lookupCachedUploadUrl)(t).url?N($(e)):(g||(g=new f.default(500,(function(e){return(0,R.lookupUncachedUploadUrls)(e,i.ajax)}))),g.push(t).then((function(){return N($(e))})))})),(0,c.loadOneboxes)(r,i.ajax,t,null,e.max_oneboxes_per_post,!1)}(l.siteSettings,u,t)}))):"error"===o.encryptState&&(e.cooked="<div class='alert alert-error'>"+(0,r.iconHTML)("times")+" "+o.error+"</div>"+e.cooked),e.cooked}e.includePostAttributes("encrypted_raw"),e.decorateWidget("post-contents:after-cooked",(function(){$(".cooked img").not($(".d-lazyload-hidden")).not($("a.lightbox img")).each((function(){var e=$(this).attr("src");(this.naturalWidth>E.max_image_width||this.naturalHeight>E.max_image_height)&&e.startsWith("blob:")&&($(this).wrap('<div class="lightbox-wrapper"><a class="lightbox" href="'+e+'"</a></div>'),(0,o.default)($(this).parents(".cooked")[0],E))}))})),e.decorateWidget("post-meta-data:after",(function(e){var t=u[e.attrs.id];if(void 0!==t){if(0===t.length)return e.h("div.post-info.integrity-pass",{title:h.default.t("encrypt.integrity_check_pass")},(0,r.iconNode)("check"));var n=t.map((function(e){return e.attr})).filter((function(e){return"updated_at"!==e&&"signed_by_name"!==e})),i=[];return n.length>0?i.push(h.default.t("encrypt.integrity_check_fail",{fields:n.join(", ")})):t.forEach((function(e){"updated_at"===e.attr?i.push(h.default.t("encrypt.integrity_check_warn_updated_at")):"signed_by_name"===e.attr&&i.push(h.default.t("encrypt.integrity_check_warn_signed_by",e))})),e.h(0===n.length?"div.post-info.integrity-warn":"div.post-info.integrity-fail",{title:i.join(" ")},(0,r.iconNode)(0===n.length?"exclamation-triangle":"times"))}})),e.reopenWidget("post-contents",{html:function(e,t){var r=e.topicId;return-1!==e.id&&(0,y.hasTopicTitle)(r)&&(d.call(this,e,t,r),A.call(this,e,t,r)),this._super.apply(this,arguments)}}),e.reopenWidget("post-small-action",{html:function(e,t){var r=e.topicId;return-1!==e.id&&(0,y.hasTopicTitle)(r)&&""!==e.encrypted_raw&&(d.call(this,e,t,r),A.call(this,e,t,r)),this._super.apply(this,arguments)}}),e.decorateWidget("post-meta-data:after",(function(e){var t=e.getModel();return e.attach("encrypted-post-timer-counter",{post:t})}))}))}};e.default=L})),define("discourse/plugins/discourse-encrypt/discourse/initializers/decrypt-topics",["exports","@ember/component","@ember/runloop","discourse-common/lib/debounce","discourse-common/lib/icon-library","discourse/lib/plugin-api","discourse/lib/text","discourse/lib/utilities","discourse/plugins/discourse-encrypt/lib/discourse","I18n"],(function(e,t,r,n,i,o,s,a,c,u){"use strict";function l(e){return function(e){if(Array.isArray(e))return p(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return p(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return p(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function d(e,t,r){r=r||{},document.querySelectorAll(e).forEach((function(e){var n=t?e.querySelector(t):e;if(n){var o=e.dataset.topicId||n.dataset.topicId;if(o&&(0,c.hasTopicTitle)(o)){(0,c.getTopicTitle)(o).then((function(t){t=(0,s.emojiUnescape)((0,a.escapeExpression)(t));var o=(0,i.iconHTML)("user-secret",{title:"encrypt.encrypted_icon_title",class:"private-message-glyph"});if(r.replaceIcon){var c=e.querySelector(".private-message-glyph-wrapper");c&&(c.innerHTML=o,n.innerHTML=t)}else r.addIcon?n.innerHTML=o+" "+t:n.innerHTML=t})).catch((function(){}));var u=e.querySelector(".edit-topic");u&&(u.style.display="none")}}}))}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var E={name:"decrypt-topics",container:null,initialize:function(e){var i=e.lookup("current-user:main");if((0,c.getEncryptionStatus)(i)===c.ENCRYPT_ACTIVE){this.container=e;var u=e.lookup("service:app-events");u.on("encrypt:status-changed",this,this.decryptTitles),u.on("page:changed",this,this.decryptDocTitle);var p=this;t.default.reopen({didRender:function(){return(0,r.scheduleOnce)("afterRender",p,(function(){(0,n.default)(p,p.decryptTitles,500)})),this._super.apply(this,arguments)}}),(0,o.withPluginApi)("0.11.3",(function(e){e.reopenWidget("quick-access-panel",{setItems:function(){var e=arguments,t=this;return(0,c.waitForPendingTitles)().catch((function(){console.warn("Not all encrypted titles could be decrypted")})).finally((function(){return t._super.apply(t,l(e))}))}}),e.reopenWidget("default-notification-item",{description:function(){if(this.attrs.fancy_title&&this.attrs.topic_id&&this.attrs.topic_key){var e=(0,c.syncGetTopicTitle)(this.attrs.topic_id);if(e)return'<span data-topic-id="'.concat(this.attrs.topic_id,'">').concat((0,s.emojiUnescape)((0,a.escapeExpression)(e)),"</span>")}return this._super.apply(this,arguments)}}),e.reopenWidget("quick-access-item",{_contentHtml:function(){var e=this.attrs.href;if(e){var t=e.match(/\/t\/.*?\/(\d+)/);if(t&&t[1]){t=parseInt(t[1],10);var r=(0,c.syncGetTopicTitle)(t);if(r)return(0,s.emojiUnescape)((0,a.escapeExpression)(r))}}return this._super.apply(this,arguments)}})})),(0,o.withPluginApi)("0.11.3",(function(e){e.decorateWidget("header:after",(function(e){(e.widget.state.userVisible||e.widget.state.searchVisible)&&(0,n.default)(p,p.decryptTitles,500)}))}))}},decryptTitles:function(){d("a.raw-topic-link",null,{addIcon:!0}),d("a.topic-link","span"),d("a.topic-link",null,{addIcon:!0}),d("h1.header-title",".topic-link",{replaceIcon:!0}),d("h1",".fancy-title",{replaceIcon:!0}),d(".topic-list-item, .latest-topic-list-item",".title",{addIcon:!0})},decryptDocTitle:function(e){var t=this;if(e.currentRouteName.startsWith("topic.")){var r=this.container.lookup("controller:topic").get("model.id");(0,c.getTopicTitle)(r).then((function(e){var r=t.container.lookup("service:document-title");r.setTitle(r.getTitle().replace(u.default.t("encrypt.encrypted_title"),e))}))}}};e.default=E})),define("discourse/plugins/discourse-encrypt/discourse/initializers/encrypt-composer",["exports","discourse-common/utils/decorators","discourse/lib/plugin-api","discourse/models/composer","discourse/plugins/discourse-encrypt/lib/discourse","discourse/plugins/discourse-encrypt/lib/protocol","I18n","rsvp"],(function(e,t,r,n,i,o,s,a){"use strict";function c(e,t,r,n,i){var o={};return Object.keys(n).forEach((function(e){o[e]=n[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce((function(r,n){return n(e,t,r)||r}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var u={name:"encrypt-composer",initialize:function(e){var o=e.lookup("current-user:main");(0,i.getEncryptionStatus)(o)===i.ENCRYPT_ACTIVE&&(n.default.serializeOnCreate("is_encrypted","isEncrypted"),n.default.serializeOnCreate("delete_after_minutes","deleteAfterMinutes"),(0,r.withPluginApi)("0.11.3",(function(e){var r,n,o,u,l,p;e.modifyClass("model:composer",(r=(0,t.on)("init"),n=(0,t.observes)("creatingPrivateMessage","topic"),o=(0,t.observes)("targetRecipients"),u=(0,t.default)("topic.encrypted_title","topic.id"),l=(0,t.default)("encryptErrorMissingKey","encryptErrorUser","encryptErrorGroup"),c(p={pluginId:"encrypt-composer",updateEncryptProperties:function(){var e=this.isEncrypted;this.topic&&this.topic.encrypted_title&&(0,i.hasTopicKey)(this.topic.id)?e=!0:this.isNew&&this.creatingPrivateMessage&&(this.isEncryptedChanged||(e=this.siteSettings.encrypt_pms_default)),this.setProperties({isEncrypted:e,showEncryptError:e})},checkEncryptRecipients:function(){var e=this;if(this.targetRecipients){var t=this.targetRecipients.split(",");t.push(this.user.username);var r=new Set(this.site.groups.map((function(e){return e.name.toLowerCase()})));t.filter((function(e){return r.has(e.toLowerCase())})).length>0?this.setProperties({isEncrypted:!1,isEncryptedChanged:!0,showEncryptError:this.showEncryptError||this.isEncrypted,encryptErrorGroup:!0}):this.setProperties({encryptErrorGroup:!1});var n=t.filter((function(e){return!r.has(e.toLowerCase())}));(0,i.getUserIdentities)(n).then((function(){e.setProperties({encryptErrorUser:!1})})).catch((function(t){e.setProperties({isEncrypted:!1,isEncryptedChanged:!0,showEncryptError:e.showEncryptError||e.isEncrypted,encryptErrorUser:t})}))}else this.setProperties({isEncrypted:this.siteSettings.encrypt_pms_default,isEncryptedChanged:!0,showEncryptError:!0,encryptErrorUser:!1,encryptErrorGroup:!1})},encryptErrorMissingKey:function(e,t){return e&&!(0,i.hasTopicKey)(t)},encryptError:function(e,t,r){return e?s.default.t("encrypt.composer.no_topic_key"):t?s.default.t("encrypt.composer.user_has_no_key",{username:t}):r?s.default.t("encrypt.composer.group_not_allowed"):void 0},beforeSave:function(){var e=this;return this.showEncryptError&&this.encryptError?new a.Promise((function(t,r){bootbox.confirm(s.default.t("encrypt.composer.confirm.message",{error:e.encryptError}),s.default.t("encrypt.composer.confirm.no_value"),s.default.t("encrypt.composer.confirm.yes_value"),(function(e){return e?t():r()}))})):a.Promise.resolve()}},"updateEncryptProperties",[r,n],Object.getOwnPropertyDescriptor(p,"updateEncryptProperties"),p),c(p,"checkEncryptRecipients",[o],Object.getOwnPropertyDescriptor(p,"checkEncryptRecipients"),p),c(p,"encryptErrorMissingKey",[u],Object.getOwnPropertyDescriptor(p,"encryptErrorMissingKey"),p),c(p,"encryptError",[l],Object.getOwnPropertyDescriptor(p,"encryptError"),p),p))})),e.lookup("service:app-events").on("composer:reply-reloaded",this,this.composerReplyReloaded))},composerReplyReloaded:function(e){if(e.privateMessage){var t,r;if("edit"===e.action&&e.originalText){var n=e.get("topic.id");if(!(0,i.hasTopicKey)(n))return;t=(0,i.getTopicTitle)(n),r=(0,i.getTopicKey)(n).then((function(t){return(0,o.decrypt)(t,e.reply)})).then((function(e){return e.raw}))}else{var s=e.reply?e.reply.indexOf("\n"):-1;if(-1===s)return;var a=e.reply.substr(0,s).trim(),c=e.reply.substr(s+1).trim(),u=(0,i.getIdentity)().then((function(e){return(0,o.importKey)(a,e.encryptPrivate)}));e.title&&(t=u.then((function(t){return(0,o.decrypt)(t,e.title)}))),c&&(r=u.then((function(e){return(0,o.decrypt)(e,c)})).then((function(e){return e.raw})))}t&&t.then((function(t){return e.setProperties({title:t,isEncrypted:!0,isEncryptedChanged:!0})})),r&&r.then((function(t){return e.setProperties({reply:t,isEncrypted:!0,isEncryptedChanged:!0})}))}}};e.default=u})),define("discourse/plugins/discourse-encrypt/discourse/initializers/encrypt-delete-topic",["exports","discourse/lib/ajax","discourse/lib/plugin-api","discourse/models/post","I18n"],(function(e,t,r,n,i){"use strict";function o(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return s(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a={name:"encrypt-delete-topic",initialize:function(){(0,r.withPluginApi)("0.11.3",(function(e){e.modifyClass("controller:topic",{pluginId:"encrypt-delete-topic",permanentDeleteConfirmation:function(e){bootbox.confirm(i.default.t("encrypt.post.delete.confirm"),i.default.t("encrypt.post.delete.no_value"),i.default.t("encrypt.post.delete.yes_value"),(function(t){t&&e()}))},createTimer:function(e){return(0,t.ajax)("/encrypt/encrypted_post_timers",{type:"POST",data:{post_id:e}})},deleteTimer:function(e){return(0,t.ajax)("/encrypt/encrypted_post_timers",{type:"DELETE",data:{post_id:e}})},deleteTopic:function(){var e=this,t=this._super;if(!this.model.encrypted_title)return t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)));this.permanentDeleteConfirmation((function(){return e.createTimer(e.model.postStream.posts[0].id).then((function(){return e.model.destroy(e.currentUser)}))}))},actions:{deletePost:function(e){var t=arguments,r=this,n=this._super;if(!e.encrypted_raw||1===e.get("post_number"))return n.call.apply(n,[this].concat(Array.prototype.slice.call(arguments)));this.permanentDeleteConfirmation((function(){return r.createTimer(e.id).then((function(i){return e.setProperties({delete_at:i.delete_at}),n.call.apply(n,[r].concat(o(t)))}))}))},deleteSelected:function(){var e=this,t=this._super,r=this.currentUser;return this.selectedAllPosts?(this.send("toggleMultiSelect"),this.deleteTopic()):this.selectedPosts[0].encrypted_raw?void this.permanentDeleteConfirmation((function(){return e.createTimer(e.selectedPostIds).then((function(t){n.default.deleteMany(e.selectedPostIds),e.get("model.postStream.posts").forEach((function(n){e.postSelected(n)&&n.setDeletedState(r)&&n.setProperties({delete_at:t.delete_at,deleted_at:new Date,deleted_by:r})})),e.send("toggleMultiSelect")}))})):t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))},recoverTopic:function(){var e=arguments,t=this,r=this._super;return this.model.encrypted_title?this.deleteTimer(this.model.postStream.posts[0].id).then((function(){return t.model.postStream.posts[0].setProperties({delete_at:!1}),r.call.apply(r,[t].concat(o(e)))})):r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments)))},recoverPost:function(e){var t=arguments,r=this,n=this._super;return e.encrypted_raw?this.deleteTimer(e.id).then((function(){return e.setProperties({delete_at:!1}),n.call.apply(n,[r].concat(o(t)))})):n.call.apply(n,[this].concat(Array.prototype.slice.call(arguments)))}}})}))}};e.default=a})),define("discourse/plugins/discourse-encrypt/discourse/initializers/encrypt-drafts",["exports","discourse/lib/plugin-api","discourse/lib/text","discourse/lib/utilities","discourse/plugins/discourse-encrypt/lib/discourse","discourse/plugins/discourse-encrypt/lib/protocol","discourse/plugins/discourse-encrypt/lib/utils","I18n","rsvp"],(function(e,t,r,n,i,o,s,a,c){"use strict";function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw o}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return l(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var p,d=["action","archetypeId","categoryId","composerTime","noBump","postId","reply","tags","title","recipients","whisper"],E={name:"encrypt-drafts",initialize:function(e){var l=e.lookup("current-user:main");if((0,i.getEncryptionStatus)(l)===i.ENCRYPT_ACTIVE){var E=!!p;p=e,E||(0,t.withPluginApi)("0.11.3",(function(e){e.modifyClassStatic("model:draft",{pluginId:"encrypt-drafts",save:function(e,t,r,n){var a=this,l=this._super;if(!p||p.isDestroyed||p.isDestroying)return c.Promise.reject();var E=p.lookup("controller:composer"),f=!!E.get("model.isEncrypted");if(0===e.indexOf("topic_")){var y=e.substr("topic_".length);f=!!(0,i.hasTopicKey)(y)}if(f){if(!(r=(0,s.filterObjectKeys)(r,d)).title&&!r.reply)return l.call.apply(l,[this].concat(Array.prototype.slice.call(arguments)));var m=(0,o.generateKey)(),A=c.Promise.all([m,(0,i.getIdentity)()]).then((function(e){var t=u(e,2),r=t[0],n=t[1];return(0,o.exportKey)(r,n.encryptPublic)})),h=r.title?m.then((function(e){return(0,o.encrypt)(e,r.title)})):"",T=r.reply?m.then((function(e){return(0,o.encrypt)(e,{raw:r.reply},{includeUploads:!0})})):"";return c.Promise.all([h,T,A]).then((function(i){var o=u(i,3),s=o[0],c=o[1],p=o[2];return r.title=s,r.reply=p+"\n"+c,r.encrypted=!0,l.call(a,e,t,r,n)}))}return l.call.apply(l,[this].concat(Array.prototype.slice.call(arguments)))}}),e.modifyClass("model:user-drafts-stream",{pluginId:"encrypt-drafts",findItems:function(e){var t=this;return this._super(e).then((function(){t.content.forEach((function(e){e.data.encrypted&&(e.title=":lock: "+a.default.t("encrypt.encrypted_title"),e.title=(0,r.emojiUnescape)((0,n.escapeExpression)(e.title)),e.excerpt=a.default.t("encrypt.encrypted_post"))}))}))}})}))}}};e.default=E})),define("discourse/plugins/discourse-encrypt/discourse/initializers/encrypt-posts",["exports","discourse/lib/ajax","discourse/lib/plugin-api","discourse/plugins/discourse-encrypt/lib/discourse","discourse/plugins/discourse-encrypt/lib/protocol","I18n","rsvp"],(function(e,t,r,n,i,o,s){"use strict";function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw o}}return r}(e,t)||u(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||u(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){if(e){if("string"==typeof e)return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function p(e){var t=Discourse.__container__.lookup("controller:composer"),r=t.model,n=t.currentUser,i=(new Date).toISOString();return e.signed_by_id=n.id,e.signed_by_name=n.username,e.user_id=r.post?r.post.user_id:r.user.id,e.user_name=r.post?r.post.username:r.user.username,e.created_at=r.post?r.post.created_at:i,e.updated_at=i,r.topic&&(e.topic_id=r.topic.id),r.post&&(e.post_id=r.post.id,e.post_number=r.post.post_number),e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var d={name:"encrypt-posts",initialize:function(e){var u=e.lookup("current-user:main");(0,n.getEncryptionStatus)(u)===n.ENCRYPT_ACTIVE&&(0,r.withPluginApi)("0.11.3",(function(e){e.modifyClassStatic("model:topic",{pluginId:"encrypt-posts",update:function(e,t){var r=arguments,s=this,a=this._super;return(0,n.hasTopicKey)(e.id)?(0,n.getTopicKey)(e.id).then((function(e){return(0,i.encrypt)(e,{raw:t.title})})).then((function(e){t.title=o.default.t("encrypt.encrypted_title"),t.encrypted_title=e})).then((function(){return a.call.apply(a,[s].concat(c(r)))})):a.call.apply(a,[this].concat(Array.prototype.slice.call(arguments)))}}),e.modifyClass("adapter:post",{pluginId:"encrypt-posts",createRecord:function(e,r,l){var p=arguments,d=this,E=this._super;if(!l.is_encrypted)return E.call.apply(E,[this].concat(Array.prototype.slice.call(arguments)));var f=(0,n.getIdentity)(),y=l.topic_id?(0,n.getTopicKey)(l.topic_id):(0,i.generateKey)(),m=l.title,A=l.raw,h=m?y.then((function(e){return(0,i.encrypt)(e,{raw:m})})).then((function(e){return l.encrypted_title=e})).finally((function(){return l.title=o.default.t("encrypt.encrypted_title")})):s.Promise.resolve(),T=A?y.then((function(e){return(0,i.encrypt)(e,{raw:A},{includeUploads:!0})})).then((function(e){return l.encrypted_raw=e})).finally((function(){return l.raw=o.default.t("encrypt.encrypted_post")})):s.Promise.resolve(),R=s.Promise.resolve(),I=[];return l.target_recipients&&(I=l.target_recipients.split(",")),I.length>0&&(I.push(u.username),R=s.Promise.all([y,(0,n.getUserIdentities)(I)]).then((function(e){for(var t=a(e,2),r=t[0],n=t[1],o=[],c=0;c<I.length;++c)o.push((0,i.exportKey)(r,n[I[c]].encryptPublic));return s.Promise.all(o)})).then((function(e){l.encrypted_keys={};for(var t=0;t<e.length;++t)l.encrypted_keys[I[t]]=e[t];l.encrypted_keys=JSON.stringify(l.encrypted_keys)})).catch((function(e){return bootbox.alert(o.default.t("encrypt.composer.user_has_no_key",{username:e})),s.Promise.reject(e)}))),l.composer_open_duration_msecs=1e4,l.typing_duration_msecs=1e4,s.Promise.all([h,T,R]).then((function(){return E.call.apply(E,[d].concat(c(p)))})).then((function(e){return s.Promise.all([y,h,f]).then((function(r){var o=a(r,3),s=o[0],c=o[1],l=o[2];return(0,n.putTopicKey)(e.payload.topic_id,s),(0,n.putTopicTitle)(e.payload.topic_id,c),(0,i.encrypt)(s,{raw:A,signed_by_id:u.id,signed_by_name:u.username,user_id:e.payload.user_id,user_name:e.payload.username,topic_id:e.payload.topic_id,post_id:e.payload.id,post_number:e.payload.post_number,created_at:e.payload.created_at,updated_at:e.payload.updated_at},{signKey:l.signPrivate,includeUploads:!0}).then((function(r){return e.payload.encrypted_raw=r,(0,t.ajax)("/encrypt/post",{type:"PUT",data:{post_id:e.payload.id,encrypted_raw:r}})}))})).then((function(){return e}))}))},update:function(e,t,r,o){var u=arguments,l=this,d=this._super;return(0,n.hasTopicKey)(o.topic_id)?s.Promise.all([(0,n.getTopicKey)(o.topic_id),(0,n.getIdentity)()]).then((function(e){var t=a(e,2),r=t[0],n=t[1];return(0,i.encrypt)(r,p({raw:o.raw}),{signKey:n.signPrivate,includeUploads:!0})})).then((function(e){delete o.cooked,delete o.raw_old,o.raw=e})).then((function(){return d.call.apply(d,[l].concat(c(u)))})):d.call.apply(d,[this].concat(Array.prototype.slice.call(arguments)))}})}))}};e.default=d})),define("discourse/plugins/discourse-encrypt/discourse/initializers/encrypt-status",["exports","discourse-common/lib/get-url","discourse/lib/plugin-api","discourse/plugins/discourse-encrypt/lib/database","discourse/plugins/discourse-encrypt/lib/discourse","I18n","@ember/template"],(function(e,t,r,n,i,o,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a={name:"encrypt-status",initialize:function(e){var a=e.lookup("current-user:main"),c=e.lookup("service:app-events");c.on("encrypt:status-changed",(function(e){e||(0,i.reload)()}));var u=(0,i.getEncryptionStatus)(a);a&&u===i.ENCRYPT_ACTIVE||(0,n.deleteDb)(),!a||u!==i.ENCRYPT_ACTIVE||a.encrypt_private&&0!==Object.keys(JSON.parse(a.encrypt_private)).length||(0,r.withPluginApi)("0.11.3",(function(e){var r=(0,t.default)("/").replace(/\/$/,""),n=o.default.t("encrypt.no_backup_warn",{basePath:r});e.addGlobalNotice((0,s.htmlSafe)(n),"key-backup-notice",{level:"warn",dismissable:!0,dismissDuration:moment.duration(1,"day")})}));var l=e.lookup("message-bus:main");l&&u!==i.ENCRYPT_DISABLED&&l.subscribe("/plugin/encrypt/keys",(function(e){a.setProperties({encrypt_public:e.public,encrypt_private:e.private}),c.trigger("encrypt:status-changed",!0)}))}};e.default=a})),define("discourse/plugins/discourse-encrypt/discourse/initializers/encrypt-uploads",["exports","discourse/lib/plugin-api","discourse/lib/uploads","discourse/plugins/discourse-encrypt/lib/base64","discourse/plugins/discourse-encrypt/lib/discourse","discourse/plugins/discourse-encrypt/lib/uploads","discourse/plugins/discourse-encrypt/lib/uppy-upload-encrypt-plugin","pretty-text/white-lister","rsvp"],(function(e,t,r,n,i,o,s,a,c){"use strict";function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw o}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return l(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var p={name:"encrypt-uploads",initialize:function(e){var n=this,o=e.lookup("current-user:main"),s=e.lookup("site-settings:main");(0,i.getEncryptionStatus)(o)===i.ENCRYPT_ACTIVE&&(0,t.withPluginApi)("0.11.3",(function(e){a.DEFAULT_LIST.push("a[data-key]"),a.DEFAULT_LIST.push("a[data-type]"),a.DEFAULT_LIST.push("img[data-key]"),a.DEFAULT_LIST.push("img[data-type]");var t={};s.enable_experimental_composer_uploader?n._useExperimentalComposerUploadProcessor(e,s,t):n._useStableUploadProcessor(e,s,t),e.addComposerUploadMarkdownResolver((function(e){var n=t[e.original_filename.replace(/\.encrypted$/,"")]||Object.values(t).find((function(t){return t.filesize===e.filesize}));if(n){Object.assign(e,n.metadata);var i=(0,r.getUploadMarkdown)(e).replace("](","|type=".concat(n.type,"|key=").concat(n.key,"]("));return delete t[n.original_filename],i}}))}))},_useStableUploadProcessor:function(e,t,r){e.addComposerUploadHandler([".*"],(function(s,a){var l=e.container.lookup("controller:composer"),p=l.get("model.topic.id");if(!l.get("model.isEncrypted")&&!(0,i.hasTopicKey)(p))return!0;var d=(0,o.getMetadata)(s,t),E=(0,o.readFile)(s),f=(0,o.generateUploadKey)(),y=f.then((function(e){return window.crypto.subtle.exportKey("raw",e).then((function(e){return(0,n.bufferToBase64)(e)}))})),m=window.crypto.getRandomValues(new Uint8Array(12)),A=c.Promise.all([E,f]).then((function(e){var t=u(e,2),r=t[0],n=t[1];return window.crypto.subtle.encrypt({name:"AES-GCM",iv:m,tagLength:128},n,r)}));return c.Promise.all([A,y,d]).then((function(e){var t=u(e,3),n=t[0],i=t[1],o=t[2],c=new Blob([m,n],{type:"application/x-binary"}),l=new File([c],"".concat(s.name,".encrypted"));a.$().fileupload("send",{files:[l],originalFiles:[l],formData:{type:"composer"}}),r[s.name]={key:i,metadata:o,type:s.type,filesize:l.size}})),!1}))},_useExperimentalComposerUploadProcessor:function(e,t,r){e.addComposerUploadPreProcessor(s.default,(function(e){return{composerModel:e.composerModel,siteSettings:t,storeEncryptedUpload:function(e,t){r[e]=t}}}))}};e.default=p})),define("discourse/plugins/discourse-encrypt/discourse/initializers/fetch-encrypt-keys",["exports","discourse-common/lib/icon-library","discourse/lib/ajax","discourse/lib/plugin-api","discourse/lib/preload-store","discourse/plugins/discourse-encrypt/lib/discourse","rsvp"],(function(e,t,r,n,i,o,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a="discourse-encrypt-bookmark-cache";function c(e,t,n,i){if(!n)return u(e,t),t;var o=s.Promise.resolve();if(!e.get(a)){var c="/u/".concat(i,"/bookmarks.json");o=(0,r.ajax)(c).then((function(t){return u(e,t)}))}return o.then((function(){var r,i,o,s=new Set;return null===(r=t)||void 0===r||null===(i=r.user_bookmark_list)||void 0===i||null===(o=i.bookmarks)||void 0===o||o.forEach((function(e){s.add(e.id)})),e.get(a).forEach((function(e){var r,i;e.title.toLowerCase().includes(n.toLowerCase())&&((null===(r=t)||void 0===r||null===(i=r.user_bookmark_list)||void 0===i?void 0:i.bookmarks)||(t={user_bookmark_list:{bookmarks:[]}}),s.has(e.id)||(s.add(e.id),t.user_bookmark_list.bookmarks.push(e)))})),t}))}function u(e,r){var n,i,c;if(!(null==r||null===(n=r.user_bookmark_list)||void 0===n?void 0:n.bookmarks))return s.Promise.resolve();var u={},l=e.get(a);l&&l.forEach((function(e){u[e.id]=e}));var p=[];return null==r||null===(i=r.user_bookmark_list)||void 0===i||null===(c=i.bookmarks)||void 0===c||c.forEach((function(e){e.topic_key&&((0,o.putTopicKey)(e.topic_id,e.topic_key),(0,o.putTopicTitle)(e.topic_id,e.encrypted_title),p.push((0,o.getTopicTitle)(e.topic_id).then((function(r){e.title=r,e.fancy_title="".concat((0,t.iconHTML)("user-secret")," ").concat(r),e.excerpt=null,u[e.id]=e})).catch((function(){}))))})),s.Promise.all(p).then((function(){e.set(a,Object.values(u))}))}var l={name:"fetch-encrypt-keys",initialize:function(e){var t=e.lookup("current-user:main");if((0,o.getEncryptionStatus)(t)!==o.ENCRYPT_DISABLED){var r=e.lookup("session:main");for(var s in i.default.data)if(s.includes("topic_")){var a=i.default.data[s];if((0,o.putTopicKey)(a.id,a.topic_key),(0,o.putTopicTitle)(a.id,a.encrypted_title),a.related_messages)for(var u=0;u<a.related_messages.length;++u){var l=a.related_messages[u];(0,o.putTopicKey)(l.id,l.topic_key),(0,o.putTopicTitle)(l.id,l.encrypted_title)}}(0,n.withPluginApi)("0.11.3",(function(e){e.modifyClass("adapter:notification",{pluginId:"fetch-encrypt-keys",find:function(){return this._super.apply(this,arguments).then((function(e){return e.notifications.forEach((function(e){e.topic_key&&((0,o.putTopicKey)(e.topic_id,e.topic_key),(0,o.putTopicTitle)(e.topic_id,e.encrypted_title))})),e}))}}),e.modifyClassStatic("model:topic",{pluginId:"fetch-encrypt-keys",create:function(e){return e&&e.topic_key&&((0,o.putTopicKey)(e.id,e.topic_key),(0,o.putTopicTitle)(e.id,e.encrypted_title)),this._super.apply(this,arguments)}}),e.modifyClass("model:topic",{pluginId:"fetch-encrypt-keys",updateFromJson:function(e){return e.topic_key&&((0,o.putTopicKey)(e.id,e.topic_key),(0,o.putTopicTitle)(e.id,e.encrypted_title)),this._super.apply(this,arguments)}}),e.modifyClass("model:bookmark",{pluginId:"fetch-encrypt-keys",loadItems:function(e){return this._super.apply(this,arguments).then((function(n){return c(r,n,e.q,t.username)}))}}),e.modifyClass("route:user-activity-bookmarks",{pluginId:"fetch-encrypt-keys",_loadBookmarks:function(e){return this._super.apply(this,arguments).then((function(n){return c(r,n,e.q,t.username)}))}})}))}}};e.default=l})),define("discourse/plugins/discourse-encrypt/discourse/initializers/invite-to-encrypted-topic",["exports","discourse/lib/ajax","discourse/lib/plugin-api","discourse/plugins/discourse-encrypt/lib/discourse","discourse/plugins/discourse-encrypt/lib/protocol","I18n","rsvp"],(function(e,t,r,n,i,o,s){"use strict";function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw o}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return c(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var u={name:"invite-to-encrypted-topic",initialize:function(e){var c=e.lookup("current-user:main");(0,n.getEncryptionStatus)(c)===n.ENCRYPT_ACTIVE&&(0,r.withPluginApi)("0.11.3",(function(e){e.modifyClass("model:topic",{pluginId:"invite-to-encrypted-topic",createInvite:function(e,r,c){var u=this,l=this._super;return(0,n.hasTopicKey)(this.id)?s.Promise.all([(0,n.getTopicKey)(this.id),(0,n.getUserIdentities)([e])]).then((function(t){var r=a(t,2),n=r[0],o=r[1];return(0,i.exportKey)(n,o[e].encryptPublic)})).then((function(n){(0,t.ajax)("/t/".concat(u.id,"/invite"),{type:"POST",data:{user:e,key:n,group_ids:r,custom_message:c}})})).catch((function(e){return bootbox.alert(o.default.t("encrypt.composer.user_has_no_key",{username:e})),s.Promise.reject(e)})):l.call.apply(l,[this].concat(Array.prototype.slice.call(arguments)))}})}))}};e.default=u})),Ember.TEMPLATES["javascripts/modal/activate-encrypt"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"d-modal-body",null,[["title"],["encrypt.title"]],{"statements":[[4,"if",[[24,["error"]]],null,{"statements":[[0,"    "],[7,"div",true],[10,"class","alert alert-error"],[8],[1,[22,"error"],false],[9],[0,"\\n"]],"parameters":[]},null],[0,"  "],[7,"div",true],[8],[0,"\\n    "],[7,"p",true],[8],[1,[28,"i18n",["encrypt.preferences.status_enabled_but_inactive"],null],false],[9],[0,"\\n    "],[1,[28,"html-safe",[[28,"i18n",["encrypt.preferences.notice_active"],null]],null],false],[0,"\\n    "],[7,"p",true],[8],[0,"\\n      "],[7,"label",true],[10,"for","passphrase"],[8],[1,[28,"i18n",["encrypt.preferences.paper_key_label"],null],false],[9],[0,"\\n      "],[1,[28,"input",null,[["type","value","placeholder","id","autocomplete","disabled"],["password",[24,["passphrase"]],[28,"i18n",["encrypt.preferences.paper_key_placeholder"],null],"passphrase","current-password",[24,["inProgress"]]]]],false],[0,"\\n    "],[9],[0,"\\n  "],[9],[0,"\\n"]],"parameters":[]},null],[0,"\\n"],[7,"div",true],[10,"class","modal-footer"],[8],[0,"\\n  "],[1,[28,"d-button",null,[["class","icon","label","action"],["btn btn-primary","unlock","encrypt.preferences.activate",[28,"action",[[23,0,[]],"activate"],null]]]],false],[0,"\\n  "],[1,[28,"d-modal-cancel",null,[["close"],[[28,"action",[[23,0,[]],"closeModal"],null]]]],false],[0,"\\n"],[9],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/templates/modal/activate-encrypt"}}),Ember.TEMPLATES["javascripts/modal/export-key-pair"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"d-modal-body",null,[["title"],["encrypt.export.title"]],{"statements":[[0,"  "],[7,"div",true],[8],[0,"\\n    "],[7,"p",true],[8],[1,[28,"i18n",["encrypt.export.instructions"],null],false],[9],[0,"\\n    "],[7,"pre",true],[10,"class","exported-key-pair"],[8],[1,[22,"exported"],false],[9],[0,"  "],[9],[0,"\\n"]],"parameters":[]},null],[0,"\\n"],[7,"div",true],[10,"class","modal-footer"],[8],[0,"\\n  "],[1,[28,"d-button",null,[["class","icon","label","disabled","action"],[[28,"if",[[24,["copied"]],"btn btn-primary ok","btn btn-primary"],null],"far-clipboard",[28,"if",[[24,["copied"]],"admin.customize.copied_to_clipboard","admin.customize.copy_to_clipboard"],null],[24,["inProgress"]],[28,"action",[[23,0,[]],"copy"],null]]]],false],[0,"\\n  "],[1,[28,"d-modal-cancel",null,[["close"],[[28,"action",[[23,0,[]],"closeModal"],null]]]],false],[0,"\\n"],[9],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/templates/modal/export-key-pair"}}),Ember.TEMPLATES["javascripts/modal/generate-paper-key"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"d-modal-body",null,[["title"],[[28,"if",[[24,["model","device"]],"encrypt.generate_paper_key.title_device","encrypt.generate_paper_key.title"],null]]],{"statements":[[0,"  "],[7,"div",true],[8],[0,"\\n    "],[7,"p",true],[8],[1,[28,"i18n",[[28,"if",[[24,["model","device"]],"encrypt.generate_paper_key.instructions_device","encrypt.generate_paper_key.instructions"],null]],null],false],[9],[0,"\\n    "],[7,"p",true],[10,"class","paper-key"],[8],[1,[22,"paperKey"],false],[9],[0,"\\n  "],[9],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/templates/modal/generate-paper-key"}}),Ember.TEMPLATES["javascripts/modal/manage-paper-keys"]=Ember.HTMLBars.template({id:null,block:'{"symbols":["key"],"statements":[[4,"d-modal-body",null,[["title"],["encrypt.manage_paper_keys.title"]],{"statements":[[0,"  "],[7,"div",true],[8],[0,"\\n"],[4,"if",[[24,["keys"]]],null,{"statements":[[0,"      "],[7,"p",true],[8],[1,[28,"i18n",["encrypt.manage_paper_keys.instructions"],null],false],[9],[0,"\\n      "],[7,"table",true],[10,"class","paper-keys"],[8],[0,"\\n        "],[7,"tbody",true],[8],[0,"\\n"],[4,"each",[[24,["keys"]]],null,{"statements":[[0,"            "],[7,"tr",true],[8],[0,"\\n              "],[7,"td",true],[8],[0,"\\n                "],[1,[28,"d-icon",["key"],null],false],[0,"\\n"],[4,"if",[[23,1,["isPaper"]]],null,{"statements":[[0,"                  "],[7,"span",true],[10,"class","paper-key"],[8],[1,[23,1,["name"]],false],[9],[0,"\\n                  ...\\n"]],"parameters":[]},{"statements":[[4,"if",[[23,1,["isPassphrase"]]],null,{"statements":[[0,"                  "],[7,"span",true],[10,"class","passphrase"],[8],[0,"\\n                    "],[1,[28,"i18n",["encrypt.manage_paper_keys.passphrase"],null],false],[0,"\\n                    "],[7,"i",true],[8],[1,[28,"i18n",["encrypt.manage_paper_keys.not_recommended"],null],false],[9],[0,"\\n                  "],[9],[0,"\\n                "]],"parameters":[]},null]],"parameters":[]}],[0,"              "],[9],[0,"\\n              "],[7,"td",true],[8],[0,"\\n                "],[1,[28,"d-button",null,[["icon","action","actionParam","class","title"],["far-trash-alt",[28,"action",[[23,0,[]],"delete"],null],[23,1,["label"]],"btn-danger pull-right","encrypt.manage_paper_keys.delete"]]],false],[0,"\\n              "],[9],[0,"\\n            "],[9],[0,"\\n"]],"parameters":[1]},null],[0,"        "],[9],[0,"\\n      "],[9],[0,"\\n"]],"parameters":[]},{"statements":[[0,"      "],[7,"p",true],[8],[1,[28,"i18n",["encrypt.manage_paper_keys.no_key"],null],false],[9],[0,"\\n"]],"parameters":[]}],[0,"  "],[9],[0,"\\n"]],"parameters":[]},null],[0,"\\n"],[7,"div",true],[10,"class","modal-footer"],[8],[0,"\\n  "],[1,[28,"d-button",null,[["icon","action","label"],["ticket-alt",[28,"action",[[23,0,[]],"generatePaperKey"],null],"encrypt.generate_paper_key.title"]]],false],[0,"\\n"],[9],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/templates/modal/manage-paper-keys"}}),Ember.TEMPLATES["javascripts/modal/reset-key-pair"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"d-modal-body",null,[["title"],["encrypt.reset.title"]],{"statements":[[4,"conditional-loading-section",null,[["isLoading"],[[24,["isLoadingStats"]]]],{"statements":[[4,"if",[[24,["encryptedPmsCount"]]],null,{"statements":[[0,"      "],[7,"p",true],[8],[1,[28,"i18n",["encrypt.reset.instructions"],null],false],[9],[0,"\\n      "],[7,"p",true],[8],[0,"\\n        "],[1,[28,"html-safe",[[28,"i18n",["encrypt.reset.instructions_lost_pms"],[["count"],[[24,["encryptedPmsCount"]]]]]],null],false],[0,"\\n        "],[1,[28,"html-safe",[[28,"i18n",["encrypt.reset.confirm_instructions"],[["username"],[[24,["currentUser","username"]]]]]],null],false],[0,"\\n      "],[9],[0,"\\n      "],[1,[28,"input",null,[["type","value"],["text",[24,["confirmation"]]]]],false],[0,"\\n"]],"parameters":[]},{"statements":[[0,"      "],[7,"p",true],[8],[1,[28,"i18n",["encrypt.reset.instructions_safe"],null],false],[9],[0,"\\n"]],"parameters":[]}]],"parameters":[]},null]],"parameters":[]},null],[0,"\\n"],[7,"div",true],[10,"class","modal-footer"],[8],[0,"\\n  "],[1,[28,"d-button",null,[["class","icon","label","action","disabled"],["btn btn-danger","trash-alt","encrypt.reset.title",[28,"action",[[23,0,[]],"reset"],null],[24,["disabled"]]]]],false],[0,"\\n  "],[1,[28,"d-modal-cancel",null,[["close"],[[28,"action",[[23,0,[]],"closeModal"],null]]]],false],[0,"\\n"],[9],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/templates/modal/reset-key-pair"}}),Ember.TEMPLATES["javascripts/modal/rotate-key-pair"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"d-modal-body",null,[["title"],["encrypt.rotate.title"]],{"statements":[[0,"  "],[7,"p",true],[8],[1,[28,"i18n",["encrypt.rotate.instructions"],null],false],[9],[0,"\\n  "],[7,"p",true],[8],[1,[28,"html-safe",[[28,"i18n",["encrypt.reset.confirm_instructions"],[["username"],[[24,["currentUser","username"]]]]]],null],false],[9],[0,"\\n  "],[1,[28,"input",null,[["type","value"],["text",[24,["confirmation"]]]]],false],[0,"\\n"]],"parameters":[]},null],[0,"\\n"],[7,"div",true],[10,"class","modal-footer"],[8],[0,"\\n  "],[1,[28,"d-button",null,[["class","icon","label","action","disabled"],["btn btn-primary","sync",[24,["label"]],[28,"action",[[23,0,[]],"rotate"],null],[24,["disabled"]]]]],false],[0,"\\n  "],[1,[28,"d-modal-cancel",null,[["close"],[[28,"action",[[23,0,[]],"closeModal"],null]]]],false],[0,"\\n"],[9],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/templates/modal/rotate-key-pair"}}),define("discourse/plugins/discourse-encrypt/discourse/widgets/encrypted-post-timer-counter",["@ember/runloop","discourse-common/lib/icon-library","discourse/widgets/widget","I18n","virtual-dom"],(function(e,t,r,n,i){"use strict";(0,r.createWidget)("encrypted-post-timer-counter",{tagName:"div.encrypted-post-timer-counter",init:function(t){var r=this;t.post.delete_at&&(0,e.later)((function(){r.scheduleRerender()}),6e4)},formatedClock:function(e){var t=Math.max(moment(e.post.delete_at)-moment().utc(),6e4);return moment.duration(t).humanize()},html:function(e){if(e.post.delete_at)return(0,i.h)("div",{attributes:{title:n.default.t("encrypt.time_bomb.title",{after:this.formatedClock(e)})}},[(0,t.iconNode)("discourse-trash-clock"),this.formatedClock(e)])}})})),define("discourse/plugins/discourse-encrypt/lib/base64",["exports"],(function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.base64ToBuffer=function(e){var r=e.length;for(;"="===e.charAt(r-1);)--r;r=Math.floor(r/4*3);for(var n=new Uint8Array(r),i=0,o=0;i<r;i+=3){var s=t.indexOf(e.charAt(o++)),a=t.indexOf(e.charAt(o++)),c=t.indexOf(e.charAt(o++)),u=t.indexOf(e.charAt(o++));n[i]=s<<2|a>>4,64!==c&&(n[i+1]=(15&a)<<4|c>>2),64!==u&&(n[i+2]=(3&c)<<6|u)}return n},e.bufferToBase64=function(e){for(var r="",n=new Uint8Array(e),i=n.byteLength-n.byteLength%3,o=0;o<i;o+=3){var s=n[o]<<16|n[o+1]<<8|n[o+2];r+=t[s>>18&63]+t[s>>12&63]+t[s>>6&63]+t[63&s]}if((i=n.byteLength)%3==1){var a=n[i-1];r+=t[a>>2&63]+t[a<<4&63]+"=="}else if(i%3==2){var c=n[i-2]<<8|n[i-1];r+=t[c>>10&63]+t[c>>4&63]+t[c<<2&63]+"="}return r};var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="})),define("discourse/plugins/discourse-encrypt/lib/database",["exports","discourse-common/config/environment","discourse/plugins/discourse-encrypt/lib/protocol","rsvp"],(function(e,t,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.setUseLocalStorage=function(r){if(!(0,t.isTesting)())throw new Error("`setUseLocalStorage` can be called from tests only");e.useLocalStorage=s=r},e.setIndexedDb=function(r){if(!(0,t.isTesting)())throw new Error("`setIndexedDb` can be called from tests only");e.indexedDb=a=r},e.setUserAgent=function(r){if(!(0,t.isTesting)())throw new Error("`setUserAgent` can be called from tests only");e.userAgent=c=r},e.saveDbIdentity=function(e){if(s)return p(e);return new n.Promise((function(t,r){var n=l(!0);n.onerror=function(n){p(e).then(t,r)},n.onsuccess=function(n){var s=n.target.result,a=s.transaction("keys","readwrite").objectStore("keys").add(e);a.onsuccess=function(r){window.localStorage.setItem(i,!0),window.localStorage.setItem(o,e.version),t(r),s.close()},a.onerror=function(n){p(e).then(t,r)}}}))},e.loadDbIdentity=function(){if(s)return d();return u().then((function(){return new n.Promise((function(e,t){var r=l(!1);r.onerror=function(r){d().then(e,t)},r.onsuccess=function(r){var n=r.target.result,i=n.transaction("keys","readonly").objectStore("keys").getAll();i.onsuccess=function(r){var i=r.target.result;if(n.close(),i&&i.length>0){var o=i[i.length-1];e(o)}else t()},i.onerror=function(r){d().then(e,t)}}}))}))},e.deleteDb=function(){return window.localStorage.removeItem(i),window.localStorage.removeItem(o),u().then((function(){return new n.Promise((function(e){var t=a.deleteDatabase(i);t.onsuccess=function(t){return e(t)},t.onerror=function(t){return e(t)},t.onblocked=function(t){return e(t)}}))}))},e.userAgent=e.indexedDb=e.useLocalStorage=e.DB_VERSION=e.DB_NAME=void 0;var i="discourse-encrypt";e.DB_NAME=i;var o="discourse-encrypt-version";e.DB_VERSION=o;var s=!1;e.useLocalStorage=s;var a=window.indexedDB;e.indexedDb=a;var c=window.navigator.userAgent;function u(){return c.match(/Version\/14.+?Safari/)?new n.Promise((function(t,r){var n=function(){return a.databases().then(t,r)};e=setInterval(n,100),n()})).finally((function(){clearInterval(e)})):n.Promise.resolve();var e}function l(e){var t=a.open(i,1);return t.onupgradeneeded=function(t){if(e){var r=t.target.result;r.objectStoreNames.contains("keys")||r.createObjectStore("keys",{keyPath:"id",autoIncrement:!0})}else t.target.transaction.abort()},t}function p(e){return(0,r.exportIdentity)(e).then((function(t){window.localStorage.setItem(i,t.private),window.localStorage.setItem(o,e.version)}))}function d(){var e=window.localStorage.getItem(i);return e&&"true"!==e?(0,r.importIdentity)(e):n.Promise.reject()}e.userAgent=c})),define("discourse/plugins/discourse-encrypt/lib/debounced-queue",["exports","discourse-common/lib/debounce","rsvp"],(function(e,t,r){"use strict";function n(e,t){if(r=e,!(null!=(n=t)&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?n[Symbol.hasInstance](r):r instanceof n))throw new TypeError("Cannot call a class as a function");var r,n}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=function(){function e(t,r){n(this,e),this.wait=t,this.handler=r,this.queue=null,this.promise=null,this.resolve=null}var o,s,a;return o=e,(s=[{key:"push",value:function(){var e,n=this;return this.queue||(this.queue=[],this.promise=new r.Promise((function(e){n.resolve=e})),(0,t.default)(this,this.pop,this.wait)),(e=this.queue).push.apply(e,arguments),this.promise}},{key:"pop",value:function(){var e=Array.from(new Set(this.queue));this.handler(e).then(this.resolve),this.queue=null,this.promise=null,this.resolve=null}}])&&i(o.prototype,s),a&&i(o,a),e}();e.default=o})),define("discourse/plugins/discourse-encrypt/lib/discourse",["exports","discourse-common/config/environment","discourse/lib/ajax","discourse/plugins/discourse-encrypt/lib/database","discourse/plugins/discourse-encrypt/lib/pack","discourse/plugins/discourse-encrypt/lib/paper-key","discourse/plugins/discourse-encrypt/lib/protocol","discourse/plugins/discourse-encrypt/lib/utils","rsvp"],(function(e,t,r,n,i,o,s,a,c){"use strict";function u(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(e,"__esModule",{value:!0}),e.resetUserIdentity=function(){if(!(0,t.isTesting)())throw new Error("`resetUserIdentity` can be called from tests only");p=null},e.getIdentity=m,e.getUserIdentities=function(e){if(e.some((function(e){return!d[e]}))){var t=(0,r.ajax)("/encrypt/user",{type:"GET",data:{usernames:e}}).then((function(e){return(0,a.getCaseInsensitiveObj)(e)}));e.forEach((function(e){d[e]=t.then((function(t){return t[e]?(0,s.importIdentity)(t[e]):c.Promise.reject(e)}))}))}return c.Promise.all(e.map((function(e){return d[e]}))).then((function(t){for(var r={},n=0;n<e.length;++n)r[e[n]]=t[n];return(0,a.getCaseInsensitiveObj)(r)}))},e.putTopicKey=function(e,t){e&&t&&(E[e]=t)},e.getTopicKey=A,e.hasTopicKey=function(e){return!!E[e]},e.putTopicTitle=function(e,t){if(!e||!t)return;if(f[e]&&f[e].encrypted===t)return;f[e]=new y(e,t)},e.getTopicTitle=function(e){var t=f[e];if(!t)return c.Promise.reject();return t.promise},e.syncGetTopicTitle=function(e){var t=f[e];if(!t)return null;return t.result},e.hasTopicTitle=function(e){return!!f[e]},e.waitForPendingTitles=function(){return c.Promise.all(Object.values(f).filter((function(e){return!e.result})).map((function(e){return e.promise})))},e.getEncryptionStatus=function(e){if(!e||!e.can_encrypt||!e.encrypt_public)return 0;if(!window.localStorage.getItem(n.DB_NAME)||!window.localStorage.getItem(n.DB_VERSION))return 1;return 2},e.enableEncrypt=function(e,t){var o=t?(0,s.importIdentity)((0,i.unpackIdentity)(t)):(0,s.generateIdentity)(),a=o.then((function(e){return(0,s.exportIdentity)(e)})).then((function(t){return e.set("encrypt_public",t.public),(0,r.ajax)("/encrypt/keys",{type:"PUT",data:{public:t.public}})})),u=o.then((function(e){return(0,n.saveDbIdentity)(e)}));return c.Promise.all([a,u])},e.activateEncrypt=function(e,t){var r=JSON.parse(e.encrypt_private),i=c.Promise.reject();if(!r)return i;var a=t.indexOf(" ");if(-1!==a){var u="paper_"+t.substr(0,a).toLowerCase();r[u]&&(i=i.catch((function(){return(0,s.importIdentity)(r[u],(0,o.fixPaperKey)(t))})))}r.device&&(i=i.catch((function(){return(0,s.importIdentity)(r.device,(0,o.fixPaperKey)(t))})));r.passphrase&&(i=i.catch((function(){return(0,s.importIdentity)(r.passphrase,t)})));return i.then((function(e){return(0,n.saveDbIdentity)(e)}))},e.reload=function(){return window.location.reload()},e.ENCRYPT_ACTIVE=e.ENCRYPT_ENABLED=e.ENCRYPT_DISABLED=void 0;e.ENCRYPT_DISABLED=0;e.ENCRYPT_ENABLED=1;var p;e.ENCRYPT_ACTIVE=2;var d=(0,a.getCaseInsensitiveObj)(),E={},f={},y=function(){function e(t,r){!function(e,t){if(!u(e,t))throw new TypeError("Cannot call a class as a function")}(this,e),this.topicId=t,this.encrypted=r}var t,r,n;return t=e,(r=[{key:"promise",get:function(){var e=this;return this._promise||(this._promise=A(this.topicId).then((function(t){return(0,s.decrypt)(t,e.encrypted)})).then((function(e){return e.raw})).then((function(t){return e.result=t}))),this._promise}}])&&l(t.prototype,r),n&&l(t,n),e}();function m(){return p||(p=(0,n.loadDbIdentity)()),p}function A(e){var t=E[e];return t?u(t,CryptoKey)?c.Promise.resolve(t):(u(t,c.Promise)||u(t,window.Promise)||(E[e]=m().then((function(e){return(0,s.importKey)(t,e.encryptPrivate)}))),E[e]):c.Promise.reject()}})),define("discourse/plugins/discourse-encrypt/lib/pack",["exports"],(function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.packIdentity=function(e){var n=[];n.push(t);for(var i=0,o=e.length;i<o;i+=71)n.push(e.substr(i,71));return n.push(r),n.join("\n")},e.unpackIdentity=function(e){var n=e.replace(t,"").replace(r,"").split(/\s+/).map((function(e){return e.trim()})).join(""),i="-----------------------------------------------------------------------";-1!==n.indexOf(i)&&(n="0$"+n.split(i).join("$"));return n},e.getPackedPlaceholder=function(){return t+"\n"+(".".repeat(71)+"\n").repeat(3)+r},e.PACKED_KEY_FOOTER=e.PACKED_KEY_HEADER=e.PACKED_KEY_COLUMNS=void 0;e.PACKED_KEY_COLUMNS=71;var t="============== BEGIN EXPORTED DISCOURSE ENCRYPT KEY PAIR ==============";e.PACKED_KEY_HEADER=t;var r="=============== END EXPORTED DISCOURSE ENCRYPT KEY PAIR ===============";e.PACKED_KEY_FOOTER=r})),define("discourse/plugins/discourse-encrypt/lib/paper-key",["exports"],(function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e._bufferToPaperKey=n,e._paperKeyToBuffer=function(e){for(var n=(e=e.toUpperCase().trim()).split(/\s+/),i="",o=0;o<n.length;++o){var s=t.indexOf(n[o]);i+=s.toString(2).padStart(r,"0")}for(var a=8*Math.floor(n.length*r/8),c=i.length-a,u=0,l=0;l<a;l+=c)u+=parseInt(i.substr(l,c),2);if((u=(u=u.toString(2).padStart(c,"0")).substr(u.length-c))!==i.substr(i.length-c))return void console.warn("Parity failed for paper key:",e);for(var p=new Uint8Array(Math.floor(n.length*r/8)),d=0,E=0;d<i.length;d+=8)p[E++]=parseInt(i.substr(d,8),2);return p},e.generatePaperKey=function(){return n(window.crypto.getRandomValues(new Uint8Array(16)))},e.fixPaperKey=function(e){return e.split(" ").filter(Boolean).join(" ").toUpperCase()};var t=["ABANDON","ABILITY","ABLE","ABOUT","ABOVE","ABSENT","ABSORB","ABSTRACT","ABSURD","ABUSE","ACCESS","ACCIDENT","ACCOUNT","ACCUSE","ACHIEVE","ACID","ACOUSTIC","ACQUIRE","ACROSS","ACT","ACTION","ACTOR","ACTRESS","ACTUAL","ADAPT","ADD","ADDICT","ADDRESS","ADJUST","ADMIT","ADULT","ADVANCE","ADVICE","AEROBIC","AFFAIR","AFFORD","AFRAID","AGAIN","AGE","AGENT","AGREE","AHEAD","AIM","AIR","AIRPORT","AISLE","ALARM","ALBUM","ALCOHOL","ALERT","ALIEN","ALL","ALLEY","ALLOW","ALMOST","ALONE","ALPHA","ALREADY","ALSO","ALTER","ALWAYS","AMATEUR","AMAZING","AMONG","AMOUNT","AMUSED","ANALYST","ANCHOR","ANCIENT","ANGER","ANGLE","ANGRY","ANIMAL","ANKLE","ANNOUNCE","ANNUAL","ANOTHER","ANSWER","ANTENNA","ANTIQUE","ANXIETY","ANY","APART","APOLOGY","APPEAR","APPLE","APPROVE","APRIL","ARCH","ARCTIC","AREA","ARENA","ARGUE","ARM","ARMED","ARMOR","ARMY","AROUND","ARRANGE","ARREST","ARRIVE","ARROW","ART","ARTEFACT","ARTIST","ARTWORK","ASK","ASPECT","ASSAULT","ASSET","ASSIST","ASSUME","ASTHMA","ATHLETE","ATOM","ATTACK","ATTEND","ATTITUDE","ATTRACT","AUCTION","AUDIT","AUGUST","AUNT","AUTHOR","AUTO","AUTUMN","AVERAGE","AVOCADO","AVOID","AWAKE","AWARE","AWAY","AWESOME","AWFUL","AWKWARD","AXIS","BABY","BACHELOR","BACON","BADGE","BAG","BALANCE","BALCONY","BALL","BAMBOO","BANANA","BANNER","BAR","BARELY","BARGAIN","BARREL","BASE","BASIC","BASKET","BATTLE","BEACH","BEAN","BEAUTY","BECAUSE","BECOME","BEEF","BEFORE","BEGIN","BEHAVE","BEHIND","BELIEVE","BELOW","BELT","BENCH","BENEFIT","BEST","BETRAY","BETTER","BETWEEN","BEYOND","BICYCLE","BID","BIKE","BIND","BIOLOGY","BIRD","BIRTH","BITTER","BLACK","BLADE","BLAME","BLANKET","BLAST","BLEAK","BLESS","BLIND","BLOOD","BLOSSOM","BLOUSE","BLUE","BLUR","BLUSH","BOARD","BOAT","BODY","BOIL","BOMB","BONE","BONUS","BOOK","BOOST","BORDER","BORING","BORROW","BOSS","BOTTOM","BOUNCE","BOX","BOY","BRACKET","BRAIN","BRAND","BRASS","BRAVE","BREAD","BREEZE","BRICK","BRIDGE","BRIEF","BRIGHT","BRING","BRISK","BROCCOLI","BROKEN","BRONZE","BROOM","BROTHER","BROWN","BRUSH","BUBBLE","BUDDY","BUDGET","BUFFALO","BUILD","BULB","BULK","BULLET","BUNDLE","BUNKER","BURDEN","BURGER","BURST","BUS","BUSINESS","BUSY","BUTTER","BUYER","BUZZ","CABBAGE","CABIN","CABLE","CACTUS","CAGE","CAKE","CALL","CALM","CAMERA","CAMP","CAN","CANAL","CANCEL","CANDY","CANNON","CANOE","CANVAS","CANYON","CAPABLE","CAPITAL","CAPTAIN","CAR","CARBON","CARD","CARGO","CARPET","CARRY","CART","CASE","CASH","CASINO","CASTLE","CASUAL","CAT","CATALOG","CATCH","CATEGORY","CATTLE","CAUGHT","CAUSE","CAUTION","CAVE","CEILING","CELERY","CEMENT","CENSUS","CENTURY","CEREAL","CERTAIN","CHAIR","CHALK","CHAMPION","CHANGE","CHAOS","CHAPTER","CHARGE","CHASE","CHAT","CHEAP","CHECK","CHEESE","CHEF","CHERRY","CHEST","CHICKEN","CHIEF","CHILD","CHIMNEY","CHOICE","CHOOSE","CHRONIC","CHUCKLE","CHUNK","CHURN","CIGAR","CINNAMON","CIRCLE","CITIZEN","CITY","CIVIL","CLAIM","CLAP","CLARIFY","CLAW","CLAY","CLEAN","CLERK","CLEVER","CLICK","CLIENT","CLIFF","CLIMB","CLINIC","CLIP","CLOCK","CLOG","CLOSE","CLOTH","CLOUD","CLOWN","CLUB","CLUMP","CLUSTER","CLUTCH","COACH","COAST","COCONUT","CODE","COFFEE","COIL","COIN","COLLECT","COLOR","COLUMN","COMBINE","COME","COMFORT","COMIC","COMMON","COMPANY","CONCERT","CONDUCT","CONFIRM","CONGRESS","CONNECT","CONSIDER","CONTROL","CONVINCE","COOK","COOL","COPPER","COPY","CORAL","CORE","CORN","CORRECT","COST","COTTON","COUCH","COUNTRY","COUPLE","COURSE","COUSIN","COVER","COYOTE","CRACK","CRADLE","CRAFT","CRAM","CRANE","CRASH","CRATER","CRAWL","CRAZY","CREAM","CREDIT","CREEK","CREW","CRICKET","CRIME","CRISP","CRITIC","CROP","CROSS","CROUCH","CROWD","CRUCIAL","CRUEL","CRUISE","CRUMBLE","CRUNCH","CRUSH","CRY","CRYSTAL","CUBE","CULTURE","CUP","CUPBOARD","CURIOUS","CURRENT","CURTAIN","CURVE","CUSHION","CUSTOM","CUTE","CYCLE","DAD","DAMAGE","DAMP","DANCE","DANGER","DARING","DASH","DAUGHTER","DAWN","DAY","DEAL","DEBATE","DEBRIS","DECADE","DECEMBER","DECIDE","DECLINE","DECORATE","DECREASE","DEER","DEFENSE","DEFINE","DEFY","DEGREE","DELAY","DELIVER","DEMAND","DEMISE","DENIAL","DENTIST","DENY","DEPART","DEPEND","DEPOSIT","DEPTH","DEPUTY","DERIVE","DESCRIBE","DESERT","DESIGN","DESK","DESPAIR","DESTROY","DETAIL","DETECT","DEVELOP","DEVICE","DEVOTE","DIAGRAM","DIAL","DIAMOND","DIARY","DICE","DIESEL","DIET","DIFFER","DIGITAL","DIGNITY","DILEMMA","DINNER","DINOSAUR","DIRECT","DIRT","DISAGREE","DISCOVER","DISEASE","DISH","DISMISS","DISORDER","DISPLAY","DISTANCE","DIVERT","DIVIDE","DIVORCE","DIZZY","DOCTOR","DOCUMENT","DOG","DOLL","DOLPHIN","DOMAIN","DONATE","DONKEY","DONOR","DOOR","DOSE","DOUBLE","DOVE","DRAFT","DRAGON","DRAMA","DRASTIC","DRAW","DREAM","DRESS","DRIFT","DRILL","DRINK","DRIP","DRIVE","DROP","DRUM","DRY","DUCK","DUMB","DUNE","DURING","DUST","DUTCH","DUTY","DWARF","DYNAMIC","EAGER","EAGLE","EARLY","EARN","EARTH","EASILY","EAST","EASY","ECHO","ECOLOGY","ECONOMY","EDGE","EDIT","EDUCATE","EFFORT","EGG","EIGHT","EITHER","ELBOW","ELDER","ELECTRIC","ELEGANT","ELEMENT","ELEPHANT","ELEVATOR","ELITE","ELSE","EMBARK","EMBODY","EMBRACE","EMERGE","EMOTION","EMPLOY","EMPOWER","EMPTY","ENABLE","ENACT","END","ENDLESS","ENDORSE","ENEMY","ENERGY","ENFORCE","ENGAGE","ENGINE","ENHANCE","ENJOY","ENLIST","ENOUGH","ENRICH","ENROLL","ENSURE","ENTER","ENTIRE","ENTRY","ENVELOPE","EPISODE","EQUAL","EQUIP","ERA","ERASE","ERODE","EROSION","ERROR","ERUPT","ESCAPE","ESSAY","ESSENCE","ESTATE","ETERNAL","ETHICS","EVIDENCE","EVIL","EVOKE","EVOLVE","EXACT","EXAMPLE","EXCESS","EXCHANGE","EXCITE","EXCLUDE","EXCUSE","EXECUTE","EXERCISE","EXHAUST","EXHIBIT","EXILE","EXIST","EXIT","EXOTIC","EXPAND","EXPECT","EXPIRE","EXPLAIN","EXPOSE","EXPRESS","EXTEND","EXTRA","EYE","EYEBROW","FABRIC","FACE","FACULTY","FADE","FAINT","FAITH","FALL","FALSE","FAME","FAMILY","FAMOUS","FAN","FANCY","FANTASY","FARM","FASHION","FAT","FATAL","FATHER","FATIGUE","FAULT","FAVORITE","FEATURE","FEBRUARY","FEDERAL","FEE","FEED","FEEL","FEMALE","FENCE","FESTIVAL","FETCH","FEVER","FEW","FIBER","FICTION","FIELD","FIGURE","FILE","FILM","FILTER","FINAL","FIND","FINE","FINGER","FINISH","FIRE","FIRM","FIRST","FISCAL","FISH","FIT","FITNESS","FIX","FLAG","FLAME","FLASH","FLAT","FLAVOR","FLEE","FLIGHT","FLIP","FLOAT","FLOCK","FLOOR","FLOWER","FLUID","FLUSH","FLY","FOAM","FOCUS","FOG","FOIL","FOLD","FOLLOW","FOOD","FOOT","FORCE","FOREST","FORGET","FORK","FORTUNE","FORUM","FORWARD","FOSSIL","FOSTER","FOUND","FOX","FRAGILE","FRAME","FREQUENT","FRESH","FRIEND","FRINGE","FROG","FRONT","FROST","FROWN","FROZEN","FRUIT","FUEL","FUN","FUNNY","FURNACE","FURY","FUTURE","GADGET","GAIN","GALAXY","GALLERY","GAME","GAP","GARAGE","GARBAGE","GARDEN","GARLIC","GARMENT","GAS","GASP","GATE","GATHER","GAUGE","GAZE","GENERAL","GENIUS","GENRE","GENTLE","GENUINE","GESTURE","GHOST","GIANT","GIFT","GIGGLE","GINGER","GIRAFFE","GIRL","GIVE","GLAD","GLANCE","GLARE","GLASS","GLIDE","GLIMPSE","GLOBE","GLOOM","GLORY","GLOVE","GLOW","GLUE","GOAT","GODDESS","GOLD","GOOD","GOOSE","GORILLA","GOSPEL","GOSSIP","GOVERN","GOWN","GRAB","GRACE","GRAIN","GRANT","GRAPE","GRASS","GRAVITY","GREAT","GREEN","GRID","GRIEF","GRIT","GROCERY","GROUP","GROW","GRUNT","GUARD","GUESS","GUIDE","GUILT","GUITAR","GUN","GYM","HABIT","HAIR","HALF","HAMMER","HAMSTER","HAND","HAPPY","HARBOR","HARD","HARSH","HARVEST","HAT","HAVE","HAWK","HAZARD","HEAD","HEALTH","HEART","HEAVY","HEDGEHOG","HEIGHT","HELLO","HELMET","HELP","HEN","HERO","HIDDEN","HIGH","HILL","HINT","HIP","HIRE","HISTORY","HOBBY","HOCKEY","HOLD","HOLE","HOLIDAY","HOLLOW","HOME","HONEY","HOOD","HOPE","HORN","HORROR","HORSE","HOSPITAL","HOST","HOTEL","HOUR","HOVER","HUB","HUGE","HUMAN","HUMBLE","HUMOR","HUNDRED","HUNGRY","HUNT","HURDLE","HURRY","HURT","HUSBAND","HYBRID","ICE","ICON","IDEA","IDENTIFY","IDLE","IGNORE","ILL","ILLEGAL","ILLNESS","IMAGE","IMITATE","IMMENSE","IMMUNE","IMPACT","IMPOSE","IMPROVE","IMPULSE","INCH","INCLUDE","INCOME","INCREASE","INDEX","INDICATE","INDOOR","INDUSTRY","INFANT","INFLICT","INFORM","INHALE","INHERIT","INITIAL","INJECT","INJURY","INMATE","INNER","INNOCENT","INPUT","INQUIRY","INSANE","INSECT","INSIDE","INSPIRE","INSTALL","INTACT","INTEREST","INTO","INVEST","INVITE","INVOLVE","IRON","ISLAND","ISOLATE","ISSUE","ITEM","IVORY","JACKET","JAGUAR","JAR","JAZZ","JEALOUS","JEANS","JELLY","JEWEL","JOB","JOIN","JOKE","JOURNEY","JOY","JUDGE","JUICE","JUMP","JUNGLE","JUNIOR","JUNK","JUST","KANGAROO","KEEN","KEEP","KETCHUP","KEY","KICK","KID","KIDNEY","KIND","KINGDOM","KISS","KIT","KITCHEN","KITE","KITTEN","KIWI","KNEE","KNIFE","KNOCK","KNOW","LAB","LABEL","LABOR","LADDER","LADY","LAKE","LAMP","LANGUAGE","LAPTOP","LARGE","LATER","LATIN","LAUGH","LAUNDRY","LAVA","LAW","LAWN","LAWSUIT","LAYER","LAZY","LEADER","LEAF","LEARN","LEAVE","LECTURE","LEFT","LEG","LEGAL","LEGEND","LEISURE","LEMON","LEND","LENGTH","LENS","LEOPARD","LESSON","LETTER","LEVEL","LIAR","LIBERTY","LIBRARY","LICENSE","LIFE","LIFT","LIGHT","LIKE","LIMB","LIMIT","LINK","LION","LIQUID","LIST","LITTLE","LIVE","LIZARD","LOAD","LOAN","LOBSTER","LOCAL","LOCK","LOGIC","LONELY","LONG","LOOP","LOTTERY","LOUD","LOUNGE","LOVE","LOYAL","LUCKY","LUGGAGE","LUMBER","LUNAR","LUNCH","LUXURY","LYRICS","MACHINE","MAD","MAGIC","MAGNET","MAID","MAIL","MAIN","MAJOR","MAKE","MAMMAL","MAN","MANAGE","MANDATE","MANGO","MANSION","MANUAL","MAPLE","MARBLE","MARCH","MARGIN","MARINE","MARKET","MARRIAGE","MASK","MASS","MASTER","MATCH","MATERIAL","MATH","MATRIX","MATTER","MAXIMUM","MAZE","MEADOW","MEAN","MEASURE","MEAT","MECHANIC","MEDAL","MEDIA","MELODY","MELT","MEMBER","MEMORY","MENTION","MENU","MERCY","MERGE","MERIT","MERRY","MESH","MESSAGE","METAL","METHOD","MIDDLE","MIDNIGHT","MILK","MILLION","MIMIC","MIND","MINIMUM","MINOR","MINUTE","MIRACLE","MIRROR","MISERY","MISS","MISTAKE","MIX","MIXED","MIXTURE","MOBILE","MODEL","MODIFY","MOM","MOMENT","MONITOR","MONKEY","MONSTER","MONTH","MOON","MORAL","MORE","MORNING","MOSQUITO","MOTHER","MOTION","MOTOR","MOUNTAIN","MOUSE","MOVE","MOVIE","MUCH","MUFFIN","MULE","MULTIPLY","MUSCLE","MUSEUM","MUSHROOM","MUSIC","MUST","MUTUAL","MYSELF","MYSTERY","MYTH","NAIVE","NAME","NAPKIN","NARROW","NASTY","NATION","NATURE","NEAR","NECK","NEED","NEGATIVE","NEGLECT","NEITHER","NEPHEW","NERVE","NEST","NET","NETWORK","NEUTRAL","NEVER","NEWS","NEXT","NICE","NIGHT","NOBLE","NOISE","NOMINEE","NOODLE","NORMAL","NORTH","NOSE","NOTABLE","NOTE","NOTHING","NOTICE","NOVEL","NOW","NUCLEAR","NUMBER","NURSE","NUT","OAK","OBEY","OBJECT","OBLIGE","OBSCURE","OBSERVE","OBTAIN","OBVIOUS","OCCUR","OCEAN","OCTOBER","ODOR","OFF","OFFER","OFFICE","OFTEN","OIL","OKAY","OLD","OLIVE","OLYMPIC","OMIT","ONCE","ONE","ONION","ONLINE","ONLY","OPEN","OPERA","OPINION","OPPOSE","OPTION","ORANGE","ORBIT","ORCHARD","ORDER","ORDINARY","ORGAN","ORIENT","ORIGINAL","ORPHAN","OSTRICH","OTHER","OUTDOOR","OUTER","OUTPUT","OUTSIDE","OVAL","OVEN","OVER","OWN","OWNER","OXYGEN","OYSTER","OZONE","PACT","PADDLE","PAGE","PAIR","PALACE","PALM","PANDA","PANEL","PANIC","PANTHER","PAPER","PARADE","PARENT","PARK","PARROT","PARTY","PASS","PATCH","PATH","PATIENT","PATROL","PATTERN","PAUSE","PAVE","PAYMENT","PEACE","PEANUT","PEAR","PEASANT","PELICAN","PEN","PENALTY","PENCIL","PEOPLE","PEPPER","PERFECT","PERMIT","PERSON","PET","PHONE","PHOTO","PHRASE","PHYSICAL","PIANO","PICNIC","PICTURE","PIECE","PIG","PIGEON","PILL","PILOT","PINK","PIONEER","PIPE","PISTOL","PITCH","PIZZA","PLACE","PLANET","PLASTIC","PLATE","PLAY","PLEASE","PLEDGE","PLUCK","PLUG","PLUNGE","POEM","POET","POINT","POLAR","POLE","POLICE","POND","PONY","POOL","POPULAR","PORTION","POSITION","POSSIBLE","POST","POTATO","POTTERY","POVERTY","POWDER","POWER","PRACTICE","PRAISE","PREDICT","PREFER","PREPARE","PRESENT","PRETTY","PREVENT","PRICE","PRIDE","PRIMARY","PRINT","PRIORITY","PRISON","PRIVATE","PRIZE","PROBLEM","PROCESS","PRODUCE","PROFIT","PROGRAM","PROJECT","PROMOTE","PROOF","PROPERTY","PROSPER","PROTECT","PROUD","PROVIDE","PUBLIC","PUDDING","PULL","PULP","PULSE","PUMPKIN","PUNCH","PUPIL","PUPPY","PURCHASE","PURITY","PURPOSE","PURSE","PUSH","PUT","PUZZLE","PYRAMID","QUALITY","QUANTUM","QUARTER","QUESTION","QUICK","QUIT","QUIZ","QUOTE","RABBIT","RACCOON","RACE","RACK","RADAR","RADIO","RAIL","RAIN","RAISE","RALLY","RAMP","RANCH","RANDOM","RANGE","RAPID","RARE","RATE","RATHER","RAVEN","RAW","RAZOR","READY","REAL","REASON","REBEL","REBUILD","RECALL","RECEIVE","RECIPE","RECORD","RECYCLE","REDUCE","REFLECT","REFORM","REFUSE","REGION","REGRET","REGULAR","REJECT","RELAX","RELEASE","RELIEF","RELY","REMAIN","REMEMBER","REMIND","REMOVE","RENDER","RENEW","RENT","REOPEN","REPAIR","REPEAT","REPLACE","REPORT","REQUIRE","RESCUE","RESEMBLE","RESIST","RESOURCE","RESPONSE","RESULT","RETIRE","RETREAT","RETURN","REUNION","REVEAL","REVIEW","REWARD","RHYTHM","RIB","RIBBON","RICE","RICH","RIDE","RIDGE","RIFLE","RIGHT","RIGID","RING","RIOT","RIPPLE","RISK","RITUAL","RIVAL","RIVER","ROAD","ROAST","ROBOT","ROBUST","ROCKET","ROMANCE","ROOF","ROOKIE","ROOM","ROSE","ROTATE","ROUGH","ROUND","ROUTE","ROYAL","RUBBER","RUDE","RUG","RULE","RUN","RUNWAY","RURAL","SAD","SADDLE","SADNESS","SAFE","SAIL","SALAD","SALMON","SALON","SALT","SALUTE","SAME","SAMPLE","SAND","SATISFY","SATOSHI","SAUCE","SAUSAGE","SAVE","SAY","SCALE","SCAN","SCARE","SCATTER","SCENE","SCHEME","SCHOOL","SCIENCE","SCISSORS","SCORPION","SCOUT","SCRAP","SCREEN","SCRIPT","SCRUB","SEA","SEARCH","SEASON","SEAT","SECOND","SECRET","SECTION","SECURITY","SEED","SEEK","SEGMENT","SELECT","SELL","SEMINAR","SENIOR","SENSE","SENTENCE","SERIES","SERVICE","SESSION","SETTLE","SETUP","SEVEN","SHADOW","SHAFT","SHALLOW","SHARE","SHED","SHELL","SHERIFF","SHIELD","SHIFT","SHINE","SHIP","SHIVER","SHOCK","SHOE","SHOOT","SHOP","SHORT","SHOULDER","SHOVE","SHRIMP","SHRUG","SHUFFLE","SHY","SIBLING","SICK","SIDE","SIEGE","SIGHT","SIGN","SILENT","SILK","SILLY","SILVER","SIMILAR","SIMPLE","SINCE","SING","SIREN","SISTER","SITUATE","SIX","SIZE","SKATE","SKETCH","SKI","SKILL","SKIN","SKIRT","SKULL","SLAB","SLAM","SLEEP","SLENDER","SLICE","SLIDE","SLIGHT","SLIM","SLOGAN","SLOT","SLOW","SLUSH","SMALL","SMART","SMILE","SMOKE","SMOOTH","SNACK","SNAKE","SNAP","SNIFF","SNOW","SOAP","SOCCER","SOCIAL","SOCK","SODA","SOFT","SOLAR","SOLDIER","SOLID","SOLUTION","SOLVE","SOMEONE","SONG","SOON","SORRY","SORT","SOUL","SOUND","SOUP","SOURCE","SOUTH","SPACE","SPARE","SPATIAL","SPAWN","SPEAK","SPECIAL","SPEED","SPELL","SPEND","SPHERE","SPICE","SPIDER","SPIKE","SPIN","SPIRIT","SPLIT","SPOIL","SPONSOR","SPOON","SPORT","SPOT","SPRAY","SPREAD","SPRING","SPY","SQUARE","SQUEEZE","SQUIRREL","STABLE","STADIUM","STAFF","STAGE","STAIRS","STAMP","STAND","START","STATE","STAY","STEAK","STEEL","STEM","STEP","STEREO","STICK","STILL","STING","STOCK","STOMACH","STONE","STOOL","STORY","STOVE","STRATEGY","STREET","STRIKE","STRONG","STRUGGLE","STUDENT","STUFF","STUMBLE","STYLE","SUBJECT","SUBMIT","SUBWAY","SUCCESS","SUCH","SUDDEN","SUFFER","SUGAR","SUGGEST","SUIT","SUMMER","SUN","SUNNY","SUNSET","SUPER","SUPPLY","SUPREME","SURE","SURFACE","SURGE","SURPRISE","SURROUND","SURVEY","SUSPECT","SUSTAIN","SWALLOW","SWAMP","SWAP","SWARM","SWEAR","SWEET","SWIFT","SWIM","SWING","SWITCH","SWORD","SYMBOL","SYMPTOM","SYRUP","SYSTEM","TABLE","TACKLE","TAG","TAIL","TALENT","TALK","TANK","TAPE","TARGET","TASK","TASTE","TATTOO","TAXI","TEACH","TEAM","TELL","TEN","TENANT","TENNIS","TENT","TERM","TEST","TEXT","THANK","THAT","THEME","THEN","THEORY","THERE","THEY","THING","THIS","THOUGHT","THREE","THRIVE","THROW","THUMB","THUNDER","TICKET","TIDE","TIGER","TILT","TIMBER","TIME","TINY","TIP","TIRED","TISSUE","TITLE","TOAST","TOBACCO","TODAY","TODDLER","TOE","TOGETHER","TOILET","TOKEN","TOMATO","TOMORROW","TONE","TONGUE","TONIGHT","TOOL","TOOTH","TOP","TOPIC","TOPPLE","TORCH","TORNADO","TORTOISE","TOSS","TOTAL","TOURIST","TOWARD","TOWER","TOWN","TOY","TRACK","TRADE","TRAFFIC","TRAGIC","TRAIN","TRANSFER","TRAP","TRASH","TRAVEL","TRAY","TREAT","TREE","TREND","TRIAL","TRIBE","TRICK","TRIGGER","TRIM","TRIP","TROPHY","TROUBLE","TRUCK","TRUE","TRULY","TRUMPET","TRUST","TRUTH","TRY","TUBE","TUITION","TUMBLE","TUNA","TUNNEL","TURKEY","TURN","TURTLE","TWELVE","TWENTY","TWICE","TWIN","TWIST","TWO","TYPE","TYPICAL","UGLY","UMBRELLA","UNABLE","UNAWARE","UNCLE","UNCOVER","UNDER","UNDO","UNFAIR","UNFOLD","UNHAPPY","UNIFORM","UNIQUE","UNIT","UNIVERSE","UNKNOWN","UNLOCK","UNTIL","UNUSUAL","UNVEIL","UPDATE","UPGRADE","UPHOLD","UPON","UPPER","UPSET","URBAN","URGE","USAGE","USE","USED","USEFUL","USELESS","USUAL","UTILITY","VACANT","VACUUM","VAGUE","VALID","VALLEY","VALVE","VAN","VANISH","VAPOR","VARIOUS","VAST","VAULT","VEHICLE","VELVET","VENDOR","VENTURE","VENUE","VERB","VERIFY","VERSION","VERY","VESSEL","VETERAN","VIABLE","VIBRANT","VICIOUS","VICTORY","VIDEO","VIEW","VILLAGE","VINTAGE","VIOLIN","VIRTUAL","VIRUS","VISA","VISIT","VISUAL","VITAL","VIVID","VOCAL","VOICE","VOID","VOLCANO","VOLUME","VOTE","VOYAGE","WAGE","WAGON","WAIT","WALK","WALL","WALNUT","WANT","WARFARE","WARM","WARRIOR","WASH","WASP","WASTE","WATER","WAVE","WAY","WEALTH","WEAPON","WEAR","WEASEL","WEATHER","WEB","WEDDING","WEEKEND","WEIRD","WELCOME","WEST","WET","WHALE","WHAT","WHEAT","WHEEL","WHEN","WHERE","WHIP","WHISPER","WIDE","WIDTH","WIFE","WILD","WILL","WIN","WINDOW","WINE","WING","WINK","WINNER","WINTER","WIRE","WISDOM","WISE","WISH","WITNESS","WOLF","WOMAN","WONDER","WOOD","WOOL","WORD","WORK","WORLD","WORRY","WORTH","WRAP","WRECK","WRESTLE","WRIST","WRITE","WRONG","YARD","YEAR","YELLOW","YOU","YOUNG","YOUTH","ZEBRA","ZERO","ZONE","ZOO"],r=Math.floor(Math.log2(t.length));function n(e){for(var n="",i=0;i<e.length;++i)n+=e[i].toString(2).padStart(8,"0");for(var o=Math.ceil(n.length/r)*r-n.length,s=0,a=0;a<n.length;a+=o)s+=parseInt(n.substr(a,o),2);n+=(s=s.toString(2).padStart(o,"0")).substr(s.length-o);for(var c=[],u=0;u<n.length;u+=r){var l=parseInt(n.substr(u,r),2);c.push(t[l])}return c.join(" ")}})),define("discourse/plugins/discourse-encrypt/lib/protocol-v0",["exports","discourse/plugins/discourse-encrypt/lib/base64","rsvp"],(function(e,t,r){"use strict";function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw o}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function o(e){for(var t=new ArrayBuffer(2*e.length),r=new Uint16Array(t),n=0;n<e.length;++n)r[n]=e.charCodeAt(n);return t}function s(e){return new TextDecoder("UTF-16").decode(e)}function a(e){return new r.Promise((function(r,n){window.crypto.subtle.exportKey("jwk",e).then((function(e){return(0,t.bufferToBase64)(o(JSON.stringify(e)))})).then(r,n)}))}function c(e,n,i){return new r.Promise((function(r,o){window.crypto.subtle.importKey("jwk",JSON.parse(s((0,t.base64ToBuffer)(e))),{name:"RSA-OAEP",hash:{name:"SHA-256"}},i,n||["encrypt","wrapKey"]).then(r,o)}))}function u(e,n){var i=window.crypto.getRandomValues(new Uint8Array(12));return new r.Promise((function(r,o){window.crypto.subtle.wrapKey("jwk",e,n,{name:"AES-GCM",iv:i}).then((function(e){return(0,t.bufferToBase64)(i)+(0,t.bufferToBase64)(e)})).then(r,o)}))}function l(e,n,i){var o=(0,t.base64ToBuffer)(e.substring(0,16)),s=(0,t.base64ToBuffer)(e.substring(16));return new r.Promise((function(e,t){window.crypto.subtle.unwrapKey("jwk",s,n,{name:"AES-GCM",iv:o},{name:"RSA-OAEP",hash:{name:"SHA-256"}},i,["decrypt","unwrapKey"]).then(e,t)}))}function p(){return(0,t.bufferToBase64)(window.crypto.getRandomValues(new Uint8Array(16)))}function d(e,n){return new r.Promise((function(r,i){window.crypto.subtle.importKey("raw",o(e),{name:"PBKDF2"},!1,["deriveBits","deriveKey"]).then((function(e){return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:(0,t.base64ToBuffer)(n),iterations:128e3,hash:"SHA-256"},e,{name:"AES-GCM",length:256},!1,["wrapKey","unwrapKey"])})).then(r,i)}))}Object.defineProperty(e,"__esModule",{value:!0}),e._stringToBuffer=o,e._bufferToString=s,e._exportPublicKey=a,e._importPublicKey=c,e._exportPrivateKey=u,e._importPrivateKey=l,e._getSalt=p,e._getPassphraseKey=d,e.generateIdentity=function(){return new r.Promise((function(e,t){window.crypto.subtle.generateKey({name:"RSA-OAEP",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["encrypt","decrypt","wrapKey","unwrapKey"]).then((function(e){return{publicKey:e.publicKey,privateKey:e.privateKey}})).then(e,t)}))},e.exportIdentity=function(e,t){if(t){var i=p();return r.Promise.all([a(e.publicKey),d(t,i).then((function(t){return u(e.privateKey,t)}))]).then((function(e){var t=n(e,2),r=t[0];return{public:r,private:r+"$"+t[1]+"$"+i}}))}return r.Promise.all([a(e.publicKey),a(e.privateKey)]).then((function(e){var t=n(e,2),r=t[0];return{public:r,private:r+"$"+t[1]}}))},e.importIdentity=function(e,t,i){if(t){var o=n(e.split("$"),3),s=o[0],a=o[1],u=o[2];return r.Promise.all([c(s,null,i),d(t,u).then((function(e){return l(a,e,i)}))]).then((function(e){var t=n(e,2);return{publicKey:t[0],privateKey:t[1]}}))}var p=n(e.split("$"),2),E=p[0],f=p[1];return r.Promise.all([c(E,null,i),f?c(f,["decrypt","unwrapKey"],i):void 0]).then((function(e){var t=n(e,2);return{publicKey:t[0],privateKey:t[1]}}))},e.encrypt=function(e,n){var i=window.crypto.getRandomValues(new Uint8Array(12)),s=o(n);return new r.Promise((function(r,n){window.crypto.subtle.encrypt({name:"AES-GCM",iv:i,tagLength:128},e,s).then((function(e){return(0,t.bufferToBase64)(i)+(0,t.bufferToBase64)(e)})).then(r,n)}))},e.decrypt=function(e,n){var i=(0,t.base64ToBuffer)(n.substring(0,16)),o=(0,t.base64ToBuffer)(n.substring(16));return new r.Promise((function(t,r){window.crypto.subtle.decrypt({name:"AES-GCM",iv:i,tagLength:128},e,o).then((function(e){return s(e)})).then(t,r)}))}})),define("discourse/plugins/discourse-encrypt/lib/protocol-v1",["exports","discourse/plugins/discourse-encrypt/lib/base64","rsvp"],(function(e,t,r){"use strict";function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw o}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){return new r.Promise((function(r,n){window.crypto.subtle.importKey("raw",(new TextEncoder).encode(e),{name:"PBKDF2"},!1,["deriveBits","deriveKey"]).then((function(e){return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:128e3,hash:"SHA-256"},e,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])})).then(r,n)}))}function a(e){return(new TextEncoder).encode("object"===o(e)?JSON.stringify(e,Object.keys(e).sort()):JSON.stringify(e))}Object.defineProperty(e,"__esModule",{value:!0}),e.generateIdentity=function(){var e=window.crypto.subtle.generateKey({name:"RSA-OAEP",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["encrypt","decrypt","wrapKey","unwrapKey"]),t=window.crypto.subtle.generateKey({name:"RSA-PSS",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]);return r.Promise.all([e,t]).then((function(e){var t=n(e,2),r=t[0],i=t[1];return{encryptPublic:r.publicKey,encryptPrivate:r.privateKey,signPublic:i.publicKey,signPrivate:i.privateKey}}))},e.exportIdentity=function(e,i){var o,a=r.Promise.all([window.crypto.subtle.exportKey("jwk",e.encryptPublic),window.crypto.subtle.exportKey("jwk",e.encryptPrivate),window.crypto.subtle.exportKey("jwk",e.signPublic),window.crypto.subtle.exportKey("jwk",e.signPrivate)]).then((function(e){var t=n(e,4);return{encryptPublic:t[0],encryptPrivate:t[1],signPublic:t[2],signPrivate:t[3]}})),c=a.then((function(e){return(0,t.bufferToBase64)((new TextEncoder).encode(JSON.stringify({encryptPublic:e.encryptPublic,signPublic:e.signPublic})))}));if(i){var u=window.crypto.getRandomValues(new Uint8Array(16)),l=window.crypto.getRandomValues(new Uint8Array(12));o=r.Promise.all([s(i,u),a]).then((function(e){var t=n(e,2),r=t[0],i=t[1];return window.crypto.subtle.encrypt({name:"AES-GCM",iv:l,tagLength:128},r,(new TextEncoder).encode(JSON.stringify(i)))})).then((function(e){return(0,t.bufferToBase64)(u)+(0,t.bufferToBase64)(l)+(0,t.bufferToBase64)(e)}))}else o=a.then((function(e){return(0,t.bufferToBase64)((new TextEncoder).encode(JSON.stringify(e)))}));return r.Promise.all([c,o]).then((function(e){var t=n(e,2);return{public:t[0],private:t[1]}}))},e.importIdentity=function(e,i,o){var a;if(i){var c=(0,t.base64ToBuffer)(e.substring(0,24)),u=(0,t.base64ToBuffer)(e.substring(24,40)),l=(0,t.base64ToBuffer)(e.substring(40));a=s(i,c).then((function(e){return window.crypto.subtle.decrypt({name:"AES-GCM",iv:u,tagLength:128},e,l)}))}else a=r.Promise.resolve((0,t.base64ToBuffer)(e));return a.then((function(t){return e=JSON.parse((new TextDecoder).decode(t)),r.Promise.all([window.crypto.subtle.importKey("jwk",e.encryptPublic,{name:"RSA-OAEP",hash:{name:"SHA-256"}},!!o,["encrypt","wrapKey"]),e.encryptPrivate?window.crypto.subtle.importKey("jwk",e.encryptPrivate,{name:"RSA-OAEP",hash:{name:"SHA-256"}},!!o,["decrypt","unwrapKey"]):void 0,window.crypto.subtle.importKey("jwk",e.signPublic,{name:"RSA-PSS",hash:{name:"SHA-256"}},!!o,["verify"]),e.signPrivate?window.crypto.subtle.importKey("jwk",e.signPrivate,{name:"RSA-PSS",hash:{name:"SHA-256"}},!!o,["sign"]):void 0]).then((function(e){var t=n(e,4);return{encryptPublic:t[0],encryptPrivate:t[1],signPublic:t[2],signPrivate:t[3]}}))}))},e.encrypt=function(e,n,i){var o=n?window.crypto.subtle.sign({name:"RSA-PSS",saltLength:32},n,a(i)).then((function(e){return i.signature=(0,t.bufferToBase64)(e),i})):r.Promise.resolve(i),s=window.crypto.getRandomValues(new Uint8Array(12));return new r.Promise((function(r,n){o.then((function(t){return window.crypto.subtle.encrypt({name:"AES-GCM",iv:s,tagLength:128},e,a(t))})).then((function(e){return(0,t.bufferToBase64)(s)+(0,t.bufferToBase64)(e)})).then(r,n)}))},e.decrypt=function(e,n){var i=(0,t.base64ToBuffer)(n.substring(0,16)),o=(0,t.base64ToBuffer)(n.substring(16));return new r.Promise((function(t,r){window.crypto.subtle.decrypt({name:"AES-GCM",iv:i,tagLength:128},e,o).then((function(e){return JSON.parse((new TextDecoder).decode(e))})).then(t,r)}))},e.verify=function(e,n){var i=n.signature;return delete n.signature,new r.Promise((function(r){window.crypto.subtle.verify({name:"RSA-PSS",saltLength:32},e,(0,t.base64ToBuffer)(i),a(n)).then((function(e){return r(!!e)})).catch((function(){return r(!1)}))}))}})),define("discourse/plugins/discourse-encrypt/lib/protocol",["exports","discourse/plugins/discourse-encrypt/lib/base64","discourse/plugins/discourse-encrypt/lib/database","discourse/plugins/discourse-encrypt/lib/protocol-v0","discourse/plugins/discourse-encrypt/lib/protocol-v1","rsvp"],(function(e,t,r,n,i,o){"use strict";function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.generateIdentity=function(e){e=e||1;var t=o.Promise.reject();0===e?t=(0,n.generateIdentity)().then((function(e){return{encryptPublic:e.publicKey,encryptPrivate:e.privateKey}})):1===e&&(t=(0,i.generateIdentity)());return t.then((function(t){return t.version=e,t}))},e.exportIdentity=function(e,t){var r=o.Promise.reject();0===e.version?r=(0,n.exportIdentity)({publicKey:e.encryptPublic,privateKey:e.encryptPrivate},t):1===e.version&&(r=(0,i.exportIdentity)(e,t));return r.then((function(t){return{public:e.version+"$"+t.public,private:e.version+"$"+t.private}}))},e.importIdentity=function(e,t,s){s=!!s||r.useLocalStorage||!0;var a=e.indexOf("$"),c=parseInt(e.substr(0,a),10);e=e.substr(a+1);var u=o.Promise.reject();0===c?u=(0,n.importIdentity)(e,t,s).then((function(e){return{encryptPublic:e.publicKey,encryptPrivate:e.privateKey}})):1===c&&(u=(0,i.importIdentity)(e,t,s));return u.then((function(e){return e.version=c,e}))},e.encrypt=function(e,t,r){var a="";if(r&&r.includeUploads){var c=t.raw.match(/upload:\/\/[A-Za-z0-9\.]+/g);c&&(a+="\n"+c.map((function(e){return"[](".concat(e,")")})).join())}var u=r&&r.version||1,l=o.Promise.reject();0===u?l=(0,n.encrypt)(e,"object"===s(t)?t.raw:t):1===u&&(l=(0,i.encrypt)(e,r&&r.signKey,t));return l.then((function(e){return u+"$"+e+a}))},e.decrypt=function(e,t){var r=(t=t.split("\n")[0]).indexOf("$"),s=parseInt(t.substr(0,r),10);if(t=t.substr(r+1),0===s)return(0,n.decrypt)(e,t).then((function(e){return{raw:e}}));if(1===s)return(0,i.decrypt)(e,t);return o.Promise.reject()},e.verify=function(e,t,r){var n=(r=r.split("\n")[0]).indexOf("$"),s=parseInt(r.substr(0,n),10);if(r=r.substr(n+1),0===s)return o.Promise.resolve(null);if(1===s)return(0,i.verify)(e,t,r);return o.Promise.reject()},e.generateKey=function(){return new o.Promise((function(e,t){window.crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]).then(e,t)}))},e.exportKey=function(e,r){return new o.Promise((function(n,i){window.crypto.subtle.wrapKey("raw",e,r,{name:"RSA-OAEP",hash:{name:"SHA-256"}}).then((function(e){return(0,t.bufferToBase64)(e)})).then(n,i)}))},e.importKey=function(e,r){return new o.Promise((function(n,i){window.crypto.subtle.unwrapKey("raw",(0,t.base64ToBuffer)(e),r,{name:"RSA-OAEP",hash:{name:"SHA-256"}},{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]).then(n,i)}))},e.ENCRYPT_PROTOCOL_VERSION=void 0;e.ENCRYPT_PROTOCOL_VERSION=1})),define("discourse/plugins/discourse-encrypt/lib/uploads",["exports","discourse/lib/uploads","rsvp"],(function(e,t,r){"use strict";function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}Object.defineProperty(e,"__esModule",{value:!0}),e.getMetadata=function(e,n){if(!(0,t.isImage)(e.name))return r.Promise.resolve({original_filename:e.name});return new r.Promise((function(t,r){var n=new Image;n.onload=function(){return t(n)},n.onerror=function(e){return r(e)},n.src=window.URL.createObjectURL(e)})).then((function(t){var r=1;return(t.width>n.max_image_width||t.height>n.max_image_height)&&(r=Math.min(n.max_image_width/t.width,n.max_image_height/t.height)),{original_filename:e.name,url:t.src,width:t.width,height:t.height,thumbnail_width:Math.floor(t.width*r),thumbnail_height:Math.floor(t.height*r)}}))},e.readFile=function(e){return new r.Promise((function(t,r){var n=new FileReader;n.onloadend=function(){return t(n.result)},n.onerror=function(e){return r(e)},n.readAsArrayBuffer(e)}))},e.generateUploadKey=function(){return new r.Promise((function(e,t){window.crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]).then(e,t)}))},e.downloadEncryptedFile=function(e,t,i){i=i||{};var o=new r.Promise((function(t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){var e=n.getResponseHeader("Content-Disposition");e&&(e=e.match(/filename="(.*?)"/)[1]),t({buffer:n.response,filename:e})},n.onerror=r,n.send()}));return r.Promise.all([t,o]).then((function(e){var t,o,s=(o=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw o}}return r}}(t,o)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(t,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=s[0],c=s[1],u=c.buffer.slice(0,12),l=c.buffer.slice(12);return new r.Promise((function(e,t){window.crypto.subtle.decrypt({name:"AES-GCM",iv:u,tagLength:128},a,l).then(e,t)})).then((function(e){return{blob:new Blob([e],{type:i.type||"application/x-binary"}),name:c.filename}}))}))}})),define("discourse/plugins/discourse-encrypt/lib/uppy-upload-encrypt-plugin",["exports","discourse/plugins/discourse-encrypt/lib/discourse","rsvp","discourse/plugins/discourse-encrypt/lib/base64","discourse/lib/uppy-plugin-base","discourse/mixins/uppy-upload","discourse/plugins/discourse-encrypt/lib/uploads"],(function(e,t,r,n,i,o,s){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){if(r=e,!(null!=(n=t)&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?n[Symbol.hasInstance](r):r instanceof n))throw new TypeError("Cannot call a class as a function");var r,n}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=E(e);if(t){var i=E(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return d(this,r)}}function d(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var f,y,m,A=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(f,e);var i,a,d,E=p(f);function f(e,t){var r;return c(this,f),(r=E.call(this,e,t)).composerModel=t.composerModel,r.storeEncryptedUpload=t.storeEncryptedUpload,r.siteSettings=t.siteSettings,r}return i=f,(a=[{key:"_encryptFile",value:async function(e){var t=this._getFile(e);if(t.size>o.HUGE_FILE_THRESHOLD_BYTES)return this._emitError(t,"The provided file is too large to upload to an encrypted message.");this._emitProgress(t);var r=await(0,s.generateUploadKey)(),i=await window.crypto.subtle.exportKey("raw",r);i=(0,n.bufferToBase64)(i);var a=await(0,s.getMetadata)(t.data,this.siteSettings),c=await(0,s.readFile)(t.data),u=window.crypto.getRandomValues(new Uint8Array(12)),l=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:u,tagLength:128},r,c),p=new Blob([u,l],{type:"application/x-binary"});this._setFileState(e,{data:p,size:p.size,name:"".concat(t.name,".encrypted")}),this.storeEncryptedUpload(t.name,{key:i,metadata:a,type:t.type,filesize:p.size}),this._emitComplete(t)}},{key:"_encryptFiles",value:async function(e){var n=this;if(!this.composerModel.isEncrypted&&!(0,t.hasTopicKey)(this.composerModel.get("topic.id")))return this._consoleDebug("Composer is not being used in an encrypted context, skipping all files."),this._skipAll(e,!0);var i=e.map((function(e){return n._encryptFile(e)}));return r.Promise.all(i)}},{key:"install",value:function(){this._install(this._encryptFiles.bind(this))}},{key:"uninstall",value:function(){this._uninstall(this._encryptFiles.bind(this))}}])&&u(i.prototype,a),d&&u(i,d),f}(i.UploadPreProcessorPlugin);e.default=A,m="uppy-upload-encrypt",(y="pluginId")in(f=A)?Object.defineProperty(f,y,{value:m,enumerable:!0,configurable:!0,writable:!0}):f[y]=m})),define("discourse/plugins/discourse-encrypt/lib/utils",["exports"],(function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getCaseInsensitiveObj=function(e){return e=e||{},new Proxy(e,{get:function(e,t){return e[t]?e[t]:(t=t.toLowerCase(),e[t=Object.keys(e).find((function(e){return t===e.toLowerCase()}))])}})},e.filterObjectKeys=function(e,t){var r={};return t.forEach((function(t){t in e&&(r[t]=e[t])})),r}}));