$(function(){$('body').on('touchstart',function(){});$('#acclink').on('click',function(e){e.preventDefault();if(!$('#acclinks').hasClass('closed')){$('#acclinks').slideUp('medium').addClass('closed');}else{$('#acclinks').slideDown('medium').removeClass('closed');}});$('#meslink').on('click',function(e){e.preventDefault();if(!$('#meslinks').hasClass('closed')){$('#meslinks').slideUp('medium').addClass('closed');}else{$('#meslinks').slideDown('medium').removeClass('closed');}});$('#quicklink').on('click',function(e){e.preventDefault();if(!$('#quicklinks').hasClass('closed')){$('#quicklinks').slideUp('medium').addClass('closed');}else{$('#quicklinks').slideDown('medium').removeClass('closed');}});$(document.body).on('mouseup',function(e){if(!$('#acclinks').hasClass('closed')&&$(e.target).parents('.acc-links-body').length==0&&$(e.target).parents('#acclink').length==0&&$(e.target).parents('.rel-box').length==0){$('#acclinks').slideUp('medium').addClass('closed');}
if(!$('#meslinks').hasClass('closed')&&$(e.target).parents('.mes-links-body').length==0&&$(e.target).parents('#meslink').length==0&&$(e.target).parents('.mes-box').length==0){$('#meslinks').slideUp('medium').addClass('closed');}
if(!$('#quicklinks').hasClass('closed')&&$(e.target).parents('.quick-links-body').length==0&&$(e.target).parents('#quicklink').length==0){$('#quicklinks').slideUp('medium').addClass('closed');}
if($('.news-rate-stars').is(':visible')&&$(e.target).parents('.news-rate-stars').length==0){$('.news-rate-stars').fadeOut('slow');}
if($('.search').hasClass('act')&&$(e.target).parents('.search').length==0&&$(e.target).parents('.site-search').length==0){$('.site-search').removeClass('trans');$('.search').removeClass('act');}
if($('.hint').is(':visible')){$('.hint').fadeOut('medium',function(){$(this).remove();});}});$('.mod-search').on('submit',function(){var min=(typeof(this.query.dataset.minChar)!=='undefined')?this.query.dataset.minChar:3;if(this.query.value==''||this.query.value.length<min){this.query.focus();return false;}});if($('#top_notifications').length){$('body').data({'usrid':$('#top_notifications').data('usrid'),'usid':$('#top_notifications').data('sid'),'uname':$('#top_notifications').data('uname'),'ulevel':$('#top_notifications').data('ulevel'),'ucolor':$('#top_notifications').data('ucolor'),'ignores':$('#top_notifications').data('ignores')});$('#top_notifications').removeAttr('data-usrid data-sid data-uname data-ulevel data-ignores data-ucolor');var dd=$('#members_shout_box').length?500:5000;delay('user_top_notices();',dd);}
if($('#popup-data').length){$('body').data({'usrid':$('#popup-data').data('usrid'),'usid':$('#popup-data').data('sid'),'uname':$('#popup-data').data('uname'),'ulevel':$('#popup-data').data('ulevel'),'ucolor':$('#popup-data').data('ucolor'),'ignores':$('#popup-data').data('ignores')});$('#popup-data').remove();}
var socket='';if(typeof(io)==='function'){socket=io.connect('wss://io.thetechgame.com',{'reconnection':true,'reconnectionDelay':1000,'reconnectionDelayMax':5000,'reconnectionAttempts':Infinity});io=function(){};socket.on('new notification',function(data){if(data.hasOwnProperty('banner')){alerts.show({title:data.banner.notification.title,text:data.banner.notification.body,click:data.banner.notification.click_action,icon:data.banner.notification.icon});}else{alerts.show({title:data.notification.title,text:data.notification.body,click:data.notification.click_action,icon:data.notification.icon});}});socket.on('live_message',function(data){alerts.show({title:data.title.val().replace(/{USERNAME}/igm,$('body').data('uname')),text:data.message.val().replace(/{USERNAME}/igm,$('body').data('uname')),click:data.click,type:data.type,timer:data.timer});});socket.on('showsocketstats',function(data){console.log(data);});$('#getsocketstats').click(function(){socket.emit('getsocketstats');});$('#live-message-acp-preview, #live-message-acp-send').on('click',function(){var message=$('#live-messages-acp'),room=$('#live-messages-room'),type=$('#live-messages-type'),title=$('#live-messages-title'),timer=$('#live-messages-timer'),action=$('#live-messages-action');if(!title.val().length){title.focus();return false;}
if(!message.val().length){message.focus();return false;}
if($.trim(room.val())===''){room.focus();return false;}
var data={};data.message=message.val();data.room=room.val();data.type=type.val();data.title=title.val();data.timer=timer.val()!==''?timer.val()*1000:'';data.action=action.val();if($(this).attr('id')==='live-message-acp-preview'){alerts.show({title:data.title.replace(/{USERNAME}/igm,$('body').data('uname')),text:data.message.replace(/{USERNAME}/igm,$('body').data('uname')),click:data.action,type:data.type,timer:data.timer});}else{Dialog({title:'Please confirm your action.',content:'<p class="bold mt mb">Are you sure you want to send this message to all users in the '+room.val()+' channel?</p>',overlay:true,buttons:{"Send it!":function(){console.log(data);feedback.show({content:'The message was sent successfully!'});DialogDelete();},"Cancel":function(){DialogDelete();return false;}}});}});if($('#staff_shout_box').length||$('#members_shout_box').length){socket.on('disconnect',function(reason){console.log(reason);if(reason==='io server disconnect'){socket.connect();}else{socket.emit('joinchat',shout_room);}});function save_emoji_history(emoji){var emojiHistory=JSON.parse(Crackers.get('emoji-history'))||[],added;if(emojiHistory.hasOwnProperty('cats')){var current_emojis=emojiHistory.cats[0].emojis.split(' ');var check=current_emojis.indexOf(emoji);if(check===-1){added=true;current_emojis.unshift(emoji);}else if(check>0){added=false;current_emojis.splice(check,1);current_emojis.unshift(emoji);}
if(current_emojis.length>30){current_emojis=current_emojis.slice(0,30);}
var c={"cats":[{"category":"history","emojis":current_emojis.join(' ')}]};}else{var c={"cats":[{"category":"history","emojis":emoji}]};added=true;}
Crackers.set('emoji-history',JSON.stringify(c));return added;};function rebuild_emoji_history(){var emojiHistory=JSON.parse(Crackers.get('emoji-history'))||[];$('tbody.history').remove();$('tbody.all-smilies-header').remove();var _split=emojiHistory.cats[0].emojis.split(' ');_split.reverse();_split.forEach(function(emoji){var es=$('.smilies').find('[data-smile="'+emoji+'"]').clone(true);var e=$('<td class="history" align="center"></td>');e.append(es);$('.smilies').prepend(e);});$('.smilies').prepend('<tbody class="history"><tr><td colspan="6" class="bold row2">Frequently used smilies <span class="right clear-emoji-history clickable" title="Clear history"><i class="fa fa-times mr"></i></td></tr></tbody>');$('.smilies td.history').chunk(6).wrap('<tr class="history"></tr>');$('.smilies tr.history').chunk(1).wrap('<tbody class="history"></tbody>');if($('.smilies td.history').length===_split.length){$('<tbody class="all-smilies-header"><tr><td colspan="6" class="bold row2">All smilies</td></tr></tbody>').insertAfter('tbody.history:last');}
$('.clear-emoji-history').click(function(){Crackers.remove('emoji-history');$('tbody.history').remove();$('tbody.all-smilies-header').remove();});};function shout_time(timestamp){const pad=num=>("0"+num).slice(-2);var date=new Date(timestamp*1000);var hours=date.getHours(),minutes=date.getMinutes(),seconds=date.getSeconds();return '['+pad(hours)+":"+pad(minutes)+":"+pad(seconds)+'] ';};$.fn.chunk=function(size){var arr=[];for(var i=0;i<this.length;i+=size){arr.push(this.slice(i,i+size));}
return this.pushStack(arr,"chunk",size);};function shout_sort(elements,dataorder,datauid){elements.sort(function(a,b){if(parseInt($(a).attr(dataorder))!=parseInt($(b).attr(dataorder))){if(parseInt($(a).attr(dataorder))<parseInt($(b).attr(dataorder)))return-1;if(parseInt($(a).attr(dataorder))>parseInt($(b).attr(dataorder)))return 1;return 0;}
if(parseInt($(a).attr(datauid))<parseInt($(b).attr(datauid)))return-1;if(parseInt($(a).attr(datauid))>parseInt($(b).attr(datauid)))return 1;return 0;});$.each(elements,function(idx,item){idx=idx+1;item.style.order=idx;$(item).find('.online-number').attr('data-order-num',idx);});};var sbDebug=false,shoutTyping=false,shoutTimeout;function clear_typing_timeout(){shoutTyping=false;var data={};data.typing=shoutTyping;data.room=shout_room;socket.emit('shout_typing',data);};socket.on('shout_user_typing',function(data){if(data.typing){$('#online-'+data.userId).addClass('typing');shoutTimeout=setTimeout(clear_typing_timeout,1500);}else{$('#online-'+data.userId).removeClass('typing');}});$(document.body).on('click','.at-shout',function(){$('#message').val($('#message').val()+'@'+$(this).data('at-uname')+' ');$('#message').focus();});$('#settings').click(function(){Dialog({title:'Shout Box Settings:',source:'op=ajax_popup&subop=shout_settings&mod='+shout_mod});});$('#smilies').click(function(){var emojiHistory=JSON.parse(Crackers.get('emoji-history'))||[];Dialog({title:'Smilies',width:'550',source:'op=ajax_popup&subop=shout_smilies',overlay:false,dragit:true,onComplete:function(data){if(emojiHistory.hasOwnProperty('cats')){var _split=emojiHistory.cats[0].emojis.split(' ');_split.reverse();_split.forEach(function(emoji){var es=$(data).find('[data-smile="'+emoji+'"]').clone(true);var e=$('<td class="history" align="center"></td>');e.append(es);$('.smilies').prepend(e);});$('.smilies').prepend('<tbody class="history"><tr><td colspan="6" class="bold row2">Frequently used smilies <span class="right clear-emoji-history clickable" title="Clear history"><i class="fa fa-times mr"></i></td></tr></tbody>');$('.smilies td.history').chunk(6).wrap('<tr class="history"></tr>');$('.smilies tr.history').chunk(1).wrap('<tbody class="history"></tbody>');if($('.smilies td.history').length===_split.length){$('<tbody class="all-smilies-header"><tr><td colspan="6" class="bold row2">All smilies</td></tr></tbody>').insertAfter('tbody.history:last');}}
$('.smile-add').click(function(){save_emoji_history($(this).data('smile'));rebuild_emoji_history();$('#message').val($('#message').val()+' '+$(this).data('smile')+' ');$('#message').focus();});$('.clear-emoji-history').click(function(){Crackers.remove('emoji-history');$('tbody.history').remove();$('tbody.all-smilies-header').remove();});}});});$('.chatsize').each(function(){if($(this).data('height')){var size=parseInt($(this).data('height'));$(this).click(function(){size=(size>249&&size<601)?size:250;if(is_popup==1){window.resizeTo(1030,size+240);$('.shout-scroll').height(size);}else{$('.shout-scroll').animate({height:size},'fast');}});}});$('.show-members-chat').click(function(e){e.preventDefault();$('.shoutbox .user').toggle(300);});$('#hideshout').click(function(){var uid=$('body').data('usrid');if($(this).hasClass('fa-square')){socket.emit('hideinshout',shout_room);if(!$.trim($('#online-'+uid+' .online-viewonline').html())){$('#online-'+uid+' .online-viewonline').html(' *');}
$(this).addClass('fa-check-square').removeClass('fa-square');}else{socket.emit('showinshout',shout_room);$('#online-'+uid+' .online-viewonline').html('');$(this).addClass('fa-square').removeClass('fa-check-square');}});$('#emptyshout').click(function(){Dialog({title:'Please confirm your action.',content:'<p class="bold mt mb">Are you sure you want to empty the shoutbox?</p>',overlay:true,buttons:{"Ok":function(){$('#chatloading').css('display','block');socket.emit('emptyshout',shout_room);DialogDelete();$('#chatloading').delay(500).fadeOut();},"Cancel":function(){DialogDelete();}}});});socket.emit('joinchat',shout_room);socket.on('joinedchat',function(data){var ud=$('body'),uid=parseInt(ud.data('usrid')),ul=parseInt(ud.data('ulevel'));if($('#online-'+data.userId).length===0){if(data.user_allow_viewonline||ul>1){if(!data.user_allow_viewonline&&data.user_level===2&&ul!==2){return false;}
$(data.user).hide().appendTo('#userwindow').fadeIn('fast');if(data.userId===uid){$('#online-'+data.userId).find('.user-at').remove();}
shout_sort($('#userwindow').children('div').get(),'data-order','data-uid');$('#online_shout_list_num').text(data.onlineNumber);}
if(sbDebug){console.log(data);}}});socket.on('leftchat',function(data){$('#online-'+data.userId).remove();shout_sort($('#userwindow').children('div').get(),'data-order','data-uid');$('#online_shout_list_num').text(data.onlineNumber);if(sbDebug){console.log(data);}});socket.on('newchat',function(data){var ud=$('body'),ig=ud.data('ignores'),un=ud.data('uname'),uid=parseInt(ud.data('usrid')),ul=parseInt(ud.data('ulevel'));$('#online-'+data.userId).find('.away').remove();if(ig!==undefined&&$.trim(ig)!==''){var igx=ig.split(',').map(x=>parseInt(x));if(igx.length&&igx.indexOf(data.userId)!==-1&&parseInt(data.user_level)===1){return false;}}
if($('#no_shouts').length){$('#no_shouts').remove();}
var my_shout_alert=Crackers.get('shout-shoutalert')==1?1:0;var my_high_color=Crackers.get('shout-highlight')||'yellow';var my_time_stamps=Crackers.get('shout-timestamps')==1?1:0;var my_allow_color=Crackers.get('shout-allowcolor')==0?0:1;var reuname=new RegExp('(>|\\s)(@'+un+')(<|\\s)','ig');var at_class=data.message.match(reuname)!==null&&data.userId!==uid?'atyou'+my_high_color:'';if(at_class!==''&&my_shout_alert===1){play_sound('notice');}
if(my_allow_color!==1){data.message=data.message.replace(/<span style="color:#[a-z0-9]+;">(.*)<\/span>/igm,'$1');}
var shm=$(data.message);if(at_class!==''){shm.addClass(at_class);}
shm.find('.shout-stamp').text(shout_time(shm.attr('data-shout-time')));if(my_time_stamps===1){shm.find('.shout-stamp').removeClass('ui-helper-hidden');}
if(ul>1){var canDelete=(parseInt(data.user_level)===2&&ul!==2)?false:true;if(canDelete){shm.find('.shout-stamp').after('<span class="far fa-trash-alt fa-14px clickable mr delete-shout pause-shout" title="Delete" data-id="'+data.id+'"></span> ');}}
$('#chatwindow .new').each(function(){$(this).delay(500).removeClass('new');});shm.hide().prependTo('#chatwindow').fadeIn('medium');var chats=$('#chatwindow .shout').length;if(chats>300){$('#chatwindow .shout').slice(300).remove();}
if(sbDebug){console.log(data);}});socket.on('removechat',function(data){$('#shout-'+data.id).remove();delay(function(){if($('#chatwindow .shout').length===0){$('#chatwindow').prepend('<div id="no_shouts" class="messagewrapper row1">No shouts... be the first to send one...</div>');}else{$('#chatwindow .shout').slice(0,1).addClass('new');}},10);});socket.on('clearchat',function(){$('#chatwindow').html('<div id="no_shouts" class="messagewrapper row1">No shouts... be the first to send one...</div>');});socket.on('floodwarning',function(){$('#message').data('border-color',$('#message').css('border-color')).css('border-color','red').attr('placeholder','Please wait a few seconds in between shouts.');delay(function(){$('#message').css('border-color',$('#message').data('border-color')).attr('placeholder','Enter a message');},1000);});socket.on('mutedwarning',function(){$('#message').data('border-color',$('#message').css('border-color')).css('border-color','red').attr('placeholder','Your account has been temporarily muted.');delay(function(){$('#message').css('border-color',$('#message').data('border-color')).attr('placeholder','Enter a message');},1000);});socket.on('deletewarning',function(){feedback.show({content:'You don\'t have the authorization level required to delete this shout.',type:'info-red'});});socket.on('sbgeneratorrunning',function(data){if($('#no_shouts').length){$('#no_shouts').remove();}
$('#chatwindow .new').each(function(){$(this).delay(500).removeClass('new');});$('#chatwindow').prepend('<div class="messagewrapper row1 draw-message shout bold new"><span class="far fa-gift gold mr"></span>'+data.message+'</div>');});socket.on('sbgeneratordone',function(data){var ud=$('body'),uname=ud.data('uname'),uid=parseInt(ud.data('usrid'));if($('#no_shouts').length){$('#no_shouts').remove();}
$('#chatwindow .new').each(function(){$(this).delay(500).removeClass('new');});$('#chatwindow').prepend('<div class="messagewrapper row1 draw-message shout bold new"><span class="far fa-gift gold mr"></span>'+data.message+'</div>');$('#online-'+data.gift).addClass('gift-winner');if(data.gift===uid){alerts.show({title:'Congratulations '+uname+'!',text:'Congratulations on winning the giveaway!',icon:czcms.config.alertlogo});}
delay(function(){$('#online-'+data.gift).removeClass('gift-winner');},5000);});socket.on('extrashoutstuff',function(data){if(data.repfairy){$.getScript('scripts/extras/particle.js');if(parseInt(Crackers.get('shout-shoutsounds'))===1){delay(function(){play_sound('fairydust');},500);}}
if(data.refresh){window.location.reload(true);}
if(data.xmastime){$.getScript('scripts/extras/xmas.js');}
if(data.fireworks){$.getScript('scripts/extras/fireworks.js');}
if(data.bugs){$.getScript('scripts/extras/bug-min.js');}
if(data.hshake){$.getScript('scripts/extras/hshake.js');}});socket.on('markback',function(data){$('#online-'+data.userId).find('.away').remove();});socket.on('hideonline',function(data){var ud=$('body'),ul=parseInt(ud.data('ulevel'));if((data.user_level===2&&ul!==2)||(data.user_level===3&&ul<2)){var oln=data.onlineNumber-1;$('#online-'+data.userId).remove();shout_sort($('#userwindow').children('div').get(),'data-order','data-uid');$('#online_shout_list_num').text(oln);}});socket.on('userlistupdates',function(mutes,aways){if(aways.length||mutes.length){$('#userwindow [data-uid] .online-status').each(function(){var upuser=parseInt($(this).parents('.userwrapper').data('uid'));if(aways.indexOf(upuser)!==-1&&mutes.indexOf(upuser)===-1){if(!$(this).find('.away').length){$(this).html(' <small class="blue away">(Away)</small>');}}else if(aways.indexOf(upuser)!==-1&&mutes.indexOf(upuser)!==-1){if(!$(this).find('.muted').length){$(this).html(' <small class="red muted">(Muted)</small>');}}else if(aways.indexOf(upuser)===-1&&mutes.indexOf(upuser)!==-1){if(!$(this).find('.muted').length){$(this).html(' <small class="red muted">(Muted)</small>');}}else if(aways.indexOf(upuser)===-1&&mutes.indexOf(upuser)===-1){$(this).html('');}});}else{$('#userwindow [data-uid] .online-status:not(:empty)').each(function(){$(this).html('');});}});socket.on('userupdates',function(changes){var ud=$('body'),ig=ud.data('ignores'),un=ud.data('uname'),uc=ud.data('ucolor'),uid=parseInt(ud.data('usrid')),ul=parseInt(ud.data('ulevel'));if((ig!==undefined&&ig!==changes.ignores)||(ig===undefined&&changes.ignores!=='')){$('body').data('ignores',changes.ignores);}
if(un!==changes.username){$('body').data('uname',changes.username);var data={};data.userId=uid;data.room=shout_room;data.username=changes.username;socket.emit('usernamechange',data);}
if(ul!==changes.user_level){$('body').data('ulevel',changes.user_level);var data={};data.userId=uid;data.room=shout_room;data.user_level=changes.user_level;socket.emit('userlevelchange',data);}
if(uc!==changes.user_color){$('body').data('ucolor',changes.user_color);var data={};data.userId=uid;data.room=shout_room;data.user_color=changes.user_color;socket.emit('usercolorchange',data);}});socket.on('userdataupdate',function(data){if(data.updateType==='username'){$('#online-'+data.userId+' .online-name .user-avatar').attr('data-uname',data.username);$('#online-'+data.userId+' .online-name span').text(data.username);}
if(data.updateType==='usercolor'){if($.trim(data.user_color)===''){$('#online-'+data.userId+' .online-name span').removeAttr('style').removeClass('bold');}else{$('#online-'+data.userId+' .online-name span').css('color','#'+data.user_color);}}
if(data.updateType==='userlevel'){$('#online-'+data.userId).attr('data-order',data.order);if(data.user_level>1){var hammer='';if(data.user_level===2){hammer='<span class="fa fa-gavel fa-flip-horizontal gold mr" title="Ban Hammer"></span> ';}else if(data.user_level===3){hammer='<span class="fa fa-gavel fa-flip-horizontal brown mr" title="Ban Hammer"></span> ';}
$('#online-'+data.userId+' .online-level').html(hammer);}else{$('#online-'+data.userId+' .online-level').html('');}
shout_sort($('#userwindow').children('div').get(),'data-order','data-uid');}});$('#message-send').on('click',function(e){var uid=parseInt($('body').data('usrid'));if(uid===24273){console.log(e);}
var message=jstrip_bbcode($('#message').val());if(shout_room==='members_shout_box'){message=jnormalize_string(message);}
var check_message=jstrip_spaces($.trim(message));if(!check_message.length){$('#message').focus();return false;}
if(check_message.length>250){feedback.show({content:'Maximum allowed characters is 250.',type:'info-red'});$('#message').focus();return false;}
$('#chatloading').css('display','block');var data={};data.message=message;data.room=shout_room;data.allow_extras=$('#message').data('ace');data.my_text_color=Crackers.get('shout-textcolor')||'';$('#message').val('');socket.emit('sendchat',data);$('#chatloading').delay(500).fadeOut();});$('#message').on('keypress',function(e){if(e.which!==13){shoutTyping=true;var data={};data.typing=shoutTyping;data.room=shout_room;socket.emit('shout_typing',data);clearTimeout(shoutTimeout);shoutTimeout=setTimeout(clear_typing_timeout,1500);}else{clearTimeout(shoutTimeout);clear_typing_timeout();$('#message-send').click();}});$('.run-extras').on('click',function(){var we=$(this).attr('id');var data={}
data.room=shout_room;data[we]=true;socket.emit('sendextrashoutstuff',data);})
$(document.body).on('click','.delete-shout',function(){var data={};data.id=$(this).attr('data-id');data.room=shout_room;socket.emit('deletechat',data);});$(document.body).on('click','.user-unmute-shout, .user-mute-shout',function(e){var op=$(this).hasClass('user-unmute-shout')?'unmute_user':'mute_user',rm='&rm='+shout_room,el=$(this).data('elm'),m=(op=='mute_user')?'&mt='+$('#mute_time').val():'';ajax_request({target:el,loading:false,params:'op=ajax_account&subop='+op+'&u='+$(this).data('uid')+m+rm});});$(document.body).on('click','.show-preview-inline',function(){var t=$(this);if(t.next().is(':visible')){t.next().slideUp('fast');return;}
t.css('cursor','progress');var i=t.next().find('img');if(!i.data('loaded')){i.attr('src',i.attr('data-src')).on('load',function(){i.data('loaded',1);t.css('cursor','pointer');t.next().slideDown('fast');});}else{t.css('cursor','pointer');t.next().slideDown('fast');}});$(document.body).on('click','#sb-generator-new',function(){var is=$('#sb-generator-staff').prop('checked')?1:0;var ia=$('#sb-generator-aways').prop('checked')?1:0;$(this).attr('disabled','disabled');$.post('/scripts/json/user.php',{action:'shoutbox_gift_generator_start',room:shout_room,is:is,ia:ia},function(data){if(data.hasOwnProperty('success')){socket.emit('sbgeneratorstart',data);delay(function(){$.post('/scripts/json/user.php',{action:'shoutbox_gift_generator_end',pid:data.pid,draw:data.draw,room:data.room,is:data.is},function(winner){socket.emit('sbgeneratorend',winner);if(winner.hasOwnProperty('success')){winner.repfairy=true;socket.emit('sendextrashoutstuff',winner);}});},2000);}else{feedback.show({content:data.message,type:'info-red'});}});DialogDelete();return false;});setInterval(function(){$.post(czcms.config.ajaxbase,{name:shout_mod,file:'ajax_shout',subop:'ping'});},(1000*60)*15);}}
$('#staff-list').on('change',function(){if($(this).val()==='')return false;$('html, body').goScroll('#'+$(this).val(),'medium');});$('.fa-refresh').on('mouseenter',function(){$(this).addClass('fa-spin');}).on('mouseleave',function(){$(this).removeClass('fa-spin');});$('.top-poster').each(function(c){var a=$(this),t=a.text(),l=t.length,lev=parseInt(360/l,10),n='',int=[];a.data('started',1);for(var i=0;i<l;i++){n+='<span style="font-weight:bold;color:hsla('+i*lev+', 100%, 50%, 1);">'+t.charAt(i)+'</span>';}
a.html(n);var ch=a.find('span');int[c]=setInterval(function(){ch.each(function(){var h=+$(this).attr('style').split(',')[0].split('(')[1]-4%360;$(this).attr({style:"color:hsla("+h+", 100%, 50%, 1)"});});},20);});$('#blocksurvey, .topic-ticker[data-ticker-loc="forum"]').appear();if($('.topic-ticker[data-ticker-loc="forum"]').length){$(document.body).one('appear','.topic-ticker',function(e){$('.topic-ticker').ticker();});}else if($('.topic-ticker[data-ticker-loc="home"]').length){$('.topic-ticker').ticker();}
$('#toggle_thanksdata').on('click',function(){$('#thanksdata').fadeToggle('medium');});$(document.body).on('click','.show-hide-toggle',function(e){e.preventDefault();if($(this).data('elm')){var s=$(this).data('speed')||'fast',ns=$(this).data('noswap-text');if($('#'+$(this).data('elm')).is(':visible')){$('#'+$(this).data('elm')).fadeToggle(s);if($(this).data('open-text')&&$(this).data('close-text')){if(typeof(ns)==='undefined'){if($(this).attr('type')=='button'){$(this).attr('value',$(this).data('open-text'));}else{$(this).html($(this).data('open-text'));}}}
if($(this).data('cookie')==1){Crackers.set('cookie_'+$(this).data('elm'),'none');}}else{$('#'+$(this).data('elm')).fadeToggle(s);if($(this).data('open-text')&&$(this).data('close-text')){if(typeof(ns)==='undefined'){if($(this).attr('type')=='button'){$(this).attr('value',$(this).data('close-text'));}else{$(this).html($(this).data('close-text'));}}}
if($(this).data('cookie')==1){Crackers.set('cookie_'+$(this).data('elm'),'block');}}}});$('.email-link').on('click',function(e){e.preventDefault();var title=$(this).data('email-title'),url=$(this).data('email-url'),strTo,strSubject,strBody;strTo="";if(title===undefined){strSubject="I recommended a page for you at "+czcms.config.sitename;}else{strSubject="I recommended a page for you at "+czcms.config.sitename+": "+encodeURIComponent(title);}
if(url===undefined){strPageURL=location.href;}else{strPageURL=url;}
strBody="I am sending this message to you so you can check out the following page:"+"%0d%0a%0d%0a"+encodeURIComponent(strPageURL)+"%0d%0a%0d%0a"+"To jump to the page, open your web browser and copy the address exactly as shown. Or, if your mail reader supports in-line links, simply click on the address.";window.location="mailto:"+strTo+"?subject="+strSubject+"&body="+strBody;});$('.auto-tabs').each(function(){var ps=$(this).data('push-state')||false;$(this).tabs({fx:{opacity:'show',duration:'slow'},select:function(event,ui){if(ps){history.pushState(null,document.title,location.href.replace(/#[a-z0-9_-]+/g,'')+ui.tab.hash);}}});$(this).show();});$('.site-message').on('click',function(e){e.preventDefault();var mssid=$(this).data('messageid');if($('#site_message_holder_'+mssid).html()==''){$.ajax({url:'/scripts/json/site.php',data:{action:'site_message',m:mssid},cache:false,success:function(data){$('#site_message_holder_'+mssid).hide().html(data).fadeToggle('fast');$('#site_message_holder_'+mssid+' .toggle').on('click',function(e){e.preventDefault();$('#site_message_holder_'+mssid).fadeToggle('fast');});}});}else{$('#site_message_holder_'+mssid).fadeToggle('fast');}});if($('#top_notifications').length&&$('#frl').length){if($('#friends-online').length){$('#frl').parent().hide();}
$('body').append('<div id="friends_list_online" class="ui-helper-hidden"><div class="onlineboxhead clear-fix"><div class="onlineboxtitle" id="friends_list_title">0 Friends Online</div><div class="chatboxoptions"><button id="frlm" title="Minimize" class="clickable mr"><span class="fa fa-minus vam"></span></button><button id="frlh" title="Close" class="clickable mr"><span class="fa fa-times vam"></span></button></div></div><div id="friends_online_side"><div id="friends-online-list"></div></div><div class="onlineboxfooter ui-helper-hidden"><input type="text" name="search_friends" class="search-friends" placeholder="Search Friends Online" autocomplete="off" /></div></div>');$('#frl').on('click',function(e){e.preventDefault();if($('#friends_list_online').is(':hidden')){friends_online_side();}
$('#friends_list_online').css('z-index','999');$('#friends_list_online').show().animate({'right':'-1px'},'medium',function(){});Crackers.set('fropenonload',1);});$('#frlh').on('click',function(e){e.preventDefault();$('#friends_list_online').animate({'right':'-252px'},'medium',function(){$(this).hide();});Crackers.set('fropenonload',0);});$('#frlm').on('click',function(e){e.preventDefault();if($('#friends_online_side').css('display')=='none'){$(this).find('span.fa').removeClass('fa-plus').addClass('fa-minus').attr('title','Minimize');$('#friends_online_side').css({'display':'block','height':'300px'});Crackers.set('frminonload',0);}else{$(this).find('span.fa').removeClass('fa-minus').addClass('fa-plus').attr('title','Maximize');$('#friends_online_side').css({'display':'none','height':'0px'});Crackers.set('frminonload',1);}});if(Crackers.get('fropenonload')==1&&!$('#friends-online').length){friends_online_side();$('#friends_list_online').css('z-index','999');$('#friends_list_online').show().animate({'right':'-1px'},'medium',function(){});if(Crackers.get('frminonload')==1){$('#frlm span.fa').removeClass('fa-minus').addClass('fa-plus').attr('title','Maximize');$('#friends_online_side').css({'display':'none','height':'0px'});}}
$('.search-friends').on('keyup',function(){var t=$(this),s=$('#friends-online-list div[data-uname]');if(t.val().length>=2){s.hide();s.filter(function(){return $(this).attr('data-uname').indexOf(t.val().toLowerCase())!==-1;}).show();if(!$('#friends-online-list div[data-uname]:visible').length&&!$('#no-friend-results').length){$('#friends-online-list').append('<div id="no-friend-results" class="brow2 d-flex clear-fix padded"><div class="col-90 vam">No results found.</div><div class="col-fill right"><span class="fa fa-exchange fa-1x im-hidden"></span></div></div>');}else{if($('#friends-online-list div[data-uname]:visible').length){$('#no-friend-results').remove();}}}else{s.show();$('#no-friend-results').remove();}});}
$('.faq-helpful').on('click',function(e){e.preventDefault();var e=$(this).data('elm');ajax_request({target:e,params:'name=FAQ&op='+$(this).data('op')+'&id='+$(this).data('faqid'),loading:false,onComplete:function(response){$('#'+e).delay(2000).fadeOut('slow',function(){$(this).html('&nbsp;').show();});}});});$('.media-favorite').on('click',function(e){e.preventDefault();var e=$(this),u=e.data('url');$.ajax({url:'/scripts/json/'+u,data:{action:'favorite',id:e.data('id')},cache:false,dataType:'json',success:function(data){if(data.change==1){e.removeClass('fa-plus-circle').addClass('fa-minus-circle').attr('title','Remove from Favorites');if($('#favorite-count').length){$('#favorite-count').html(parseInt($('#favorite-count').text())+1);}}else{e.removeClass('fa-minus-circle').addClass('fa-plus-circle').attr('title','Add to Favorites');if($('#favorite-count').length){$('#favorite-count').html(parseInt($('#favorite-count').text())-1);}}}});});$(document.body).on('click','.scroller',function(e){e.preventDefault();elm=$(this).attr('href').split('#')[1];if(elm=='quick_reply'){$('#quick_reply_holder').show();$('html, body').goScroll('#'+elm,'slow');}else{$('html, body').goScroll('#'+elm,'slow');}});$(document.body).on('click','.confirm-action',function(e){e.preventDefault();if($(this).data('confirm-message')){var cm=$(this).data('confirm-message'),cl=$(this).attr('href');Dialog({title:'Please confirm your action.',content:'<p class="bold mt mb">'+cm+'</p>',overlay:true,buttons:{"Ok":function(){window.location.href=cl;DialogDelete();},"Cancel":function(){DialogDelete();return false;}}});}});$(document.body).on('click','.users-ignore-add, .users-ignore-remove',function(e){e.preventDefault();var t=$(this),a=t.hasClass('users-ignore-remove')?'remignore':'addignore',n=t.data('uname'),u=t.data('uid'),e=t.data('elm'),r=t.data('return')||'';Dialog({title:'Please confirm your action.',content:'<p class="bold">Are you sure you want to '+((a=='remignore')?'remove':'add')+' '+n+' '+((a=='remignore')?'from':'to')+' your ignore list?</p>',overlay:true,width:550,buttons:{'Ok':function(){ajax_request({params:'op=ajax_account&subop='+a+'&u='+u,target:e,loading:false,onComplete:function(data){if(t.find('span.fa').length){if(a=='remignore'){t.removeClass('users-ignore-remove').addClass('users-ignore-add').attr('title','Block all communication from this user');t.find('span.fa').removeClass('fa-plus-circle green').addClass('fa-ban red');}else{t.removeClass('users-ignore-add').addClass('users-ignore-remove').attr('title','Allow all communication from this user');t.find('span.fa').removeClass('fa-ban red').addClass('fa-plus-circle green');}}
if(e=='ignore_div_mini'&&$('#ignore_div').length){$('#ignore_div').html(data);}
if(r=='ign-io'){Dialog({title:'Ignored Members',width:550,source:'op=ajax_popup&subop=ignored_users'});}else if(r=='min-io'){if(typeof _gaq!=='undefined'&&_gaq!==null){_gaq.push(['_trackPageview','/'+n]);}
var _s=(current_mod&&/_Shout/i.test(current_mod))?'&s=1':'';Dialog({title:'Mini profile for: '+n,width:550,source:'op=ajax_popup&subop=profile&u='+u+_s});}else{DialogDelete();}}});},'Cancel':function(){DialogDelete();}}});});$(document.body).on('click','.topic-notice-mark',function(e){e.preventDefault();var op=($(this).data('op')=='mark')?'mark_topic':'unwatch_topic',t=$(this).data('topicid'),s=$(this).data('start');ajax_request({params:'op=ajax_forums&subop='+op+'&t='+t,loading:false,onComplete:function(){s=(s>0)?'&start='+s:'';ajax_request({target:'notifications_noanchor',params:'op=ajax_popup&subop=notifications'+s,onComplete:function(){user_top_notices();}});}});});$(document.body).on('click','.forum-notice-mark',function(e){e.preventDefault();var op=($(this).data('op')=='mark')?'mark_forum':'unwatch_forum',f=$(this).data('forumid'),s=$(this).data('start');ajax_request({params:'op=ajax_forums&subop='+op+'&f='+f,loading:false,onComplete:function(){s=(s>0)?'&start='+s:'';ajax_request({target:'notifications_noanchor',params:'op=ajax_popup&subop=forum_notifications'+s,onComplete:function(){user_top_notices();}});}});});$('.active-dialog-link').on('click',function(e){e.preventDefault();var w=$(this).data('width')!==undefined?$(this).data('width'):550;Dialog({title:$(this).attr('title'),width:w,source:$(this).data('href')});});$('.video-popup').on('click',function(e){e.preventDefault();if(typeof _gaq!=='undefined'&&_gaq!==null){_gaq.push(['_trackPageview',$(this).attr('href')]);}
Dialog({title:$(this).data('title'),width:850,source:'op=ajax_popup&subop=play_video&vid='+$(this).data('source')});});$(document.body).on('focus','.auto-complete',function(e){var highLight=function(s,t){var matcher=new RegExp("^("+$.ui.autocomplete.escapeRegex(t)+")","ig");return s.replace(matcher,"<span class=\"achl\">$1</span>");};var dataUrl=$(this).data('url'),dataMin=$(this).data('min'),dataNam=$(this).attr('name');$(this).autocomplete({source:function(request,response){var term=request.term;if(autocache[term+'|'+dataUrl]){response($.map(autocache[term+'|'+dataUrl],function(item){return{id:item.id,label:highLight(item.label,request.term),value:item.label};}));return;}
$.ajax({url:'/scripts/json/'+dataUrl,dataType:'json',data:{term:request.term},success:function(data){autocache[term+'|'+dataUrl]=data;response($.map(data,function(item){return{id:item.id,label:highLight(item.label,request.term),value:item.label};}));}});},minLength:dataMin,select:function(ev,ui){}}).data("autocomplete")._renderItem=function(ul,item){return $("<li></li>").data("item.autocomplete",item).append($("<a data-acid=\""+item.id+"\"></a>").html(item.label)).appendTo(ul);};});$('.items-popular').on('click',function(e){e.preventDefault();var link=$(this),dataid=link.data('period'),datamod=link.data('mod');if(!link.hasClass('light')){return false;}
link.css('cursor','progress');var html=scid='';$.ajax({url:'/scripts/json/'+datamod+'.php?action=popular',data:{p:dataid},cache:false,dataType:'json',success:function(data){$.each(data.items,function(i,item){if(item){if(item.error){alert(item.error);}else{var num=item.hasOwnProperty('num')?item.num+'. ':'';html+='<li><a href="'+item.link+'" title="'+item.alt+'">'+num+item.title+'</a> <span class="smaller ml">('+item.hits+')</span></li>';}}});$('.popular-list').empty().append(html);$('.items-popular').addClass('light');link.css('cursor','pointer').removeClass('light');}});});$('.news-hottest').on('click',function(e){e.preventDefault();var link=$(this),dataid=link.data('period');if(!link.hasClass('light')){return false;}
link.css('cursor','progress');var html=scid='';$.ajax({url:'/scripts/json/news.php?action=hottest_news',data:{p:dataid},cache:false,dataType:'json',success:function(data){$.each(data.items,function(i,item){if(item){if(item.error){alert(item.error);}else{preloadimages(czcms.config.siteurl+'/images/news/article/'+item.imgid);html+='<div><img src="/images/news/article/'+item.imgid+'" class="story-thumb"><span class="related-articles-desc"><a class="white" href="'+item.link+'" title="'+item.title+'">'+item.title+'</a><br /><br /><a class="white" href="'+item.link+'" title="Read full story">Read full story</a></span><span class="related-articles-num" title="'+(item.comments!=1?item.comments+' comments':'1 comment')+'">'+item.comments+'</span><span class="related-articles-time"><i class="fal fa-clock mr"></i>'+item.time+'</span></div>';}}});$('.related-articles').empty().append(html);$('.news-hottest').addClass('light');link.css('cursor','pointer').removeClass('light');}});});$('.news-more').on('click',function(e){e.preventDefault();dataid=$(this).data('topic');datatitle=$(this).data('topic-title');datahold=$(this).data('cid');link=$(this);link.css('cursor','progress');if(typeof _gaq!=='undefined'&&_gaq!==null){_gaq.push(['_trackPageview',link.attr('href')]);}
var html=scid='';next=(parseInt(readmore[dataid])>0)?parseInt(readmore[dataid]):1;if(next==4){}
$.ajax({url:'/scripts/json/news.php?action=news_more',data:{t:dataid,n:next},cache:false,dataType:'json',success:function(data){$.each(data.items,function(i,item){if(item){if(item.error){alert(item.error);}else{preloadimages(czcms.config.siteurl+'/images/news/thumbs/'+item.imgid);html='<div class="game-one clear-fix'+item.cssclass+'"><div class="game-one-lft">'+((item.comments>=50)?'<div class="ribbon"><span class="ribbon-hot">HOT</span></div>':'')+'<a href="'+item.link+'"><img src="'+czcms.config.siteurl+'/images/news/thumbs/'+item.imgid+'" width="200" height="179" class="story-thumb" title="'+item.title+'" alt="" /></a><ul><li class="last"><a href="'+item.link+'#comments"><span class="comment-number" title="Comments">'+item.comments+'</span></a></li></ul></div><div class="game-one-rht news-cont"><h2><a href="'+item.link+'">'+item.title+'</a></h2><p>'+item.hometext+'</p><span class="news-time-home">- '+item.time+'</span></div></div>';$(html).insertBefore('#h-'+datahold);}}});readmore[dataid]=next+1;link.css('cursor','pointer');}});});$('.comment-quote').on('click',function(e){e.preventDefault();datatid=$(this).data('tid');datasid=$(this).data('sid');currval=$('#comment-text').val();if(commquote[datasid,datatid]){return false;}
$.ajax({url:'/scripts/json/'+comment_process+'.php?action=comment_quote',cache:false,data:{s:datasid,t:datatid},dataType:'json',success:function(data){$.each(data.items,function(i,item){if(item){if(item.quote){$('#comment-text').val(((currval!='')?currval+'\n\n':'')+item.quote+'\n\n');$('html, body').goScroll('#comment-menu-block','medium');$('#comment-text').selectRange($('#comment-text').val().length,$('#comment-text').val().length);commquote[datasid,datatid]=true;if(typeof _gaq!=='undefined'&&_gaq!==null){_gaq.push(['_trackPageview','/News/comments/op=reply/sid='+datasid+'/tid='+datatid+'.html']);}}}});}});});$('.comment-preview').on('click',function(e){e.preventDefault();datasid=$(this).data('sid');currval=$('#comment-text').val();if(trim(currval)==''){$('#comment-text').focus();return false;}else if(jstrip_bbcode(jstrip_bbquote(jstrip_spaces(trim(currval)))).length<20){$('#comment-text').val(trim(currval));alert("The comment must contain at least 20 characters.");$('#comment-text').focus();return false;}
$.ajax({url:'/scripts/json/'+comment_process+'.php?action=comment_preview',data:{s:datasid,c:currval},cache:false,type:'POST',dataType:'json',success:function(data){$.each(data.items,function(i,item){if(item){if(item.preview){if($('#comment-preview').length){$('#comment-preview .comment-post').html(item.preview);}else{$('<div class="comment-block ui-helper-hidden" id="comment-preview"><div class="comment-avatar">'+item.avatar+'<h2><a href="'+item.link+'" title="View Profile">'+item.uname+'</a><span class="comment-time">Posted: Preview</span></h2><div class="clear"></div></div><div class="comment-post comment-edit">'+item.preview+'</div></div>').prependTo($('.comments-holder')).slideDown('slow');}}}});}});});$('.comment-post-button').on('click',function(e){e.preventDefault();datacomm=$('#comment-text').val();datasid=$(this).data('sid');if(datacomm==''){$('#comment-text').focus();return false;}else if(jstrip_bbcode(jstrip_bbquote(jstrip_spaces(trim(datacomm)))).length<20){$('#comment-text').val(trim(datacomm));alert("The comment must contain at least 20 characters.");$('#comment-text').focus();return false;}
$.ajax({url:'/scripts/json/'+comment_process+'.php?action=comment_post',cache:false,type:'POST',data:{s:datasid,c:datacomm},dataType:'json',success:function(data){$.each(data.items,function(i,item){if(item){if(item.error){Dialog({title:'Error',width:'400',content:'<p class="bold">'+item.error+'</p>'});}else{$('#comment-text').val('').css('height',$('#comment-text').attr('original-height')+'px');if($('#comment-preview').length){$('#comment-preview .comment-time').html('Posted: Less than 1 minute ago');$('#comment-preview .comment-post').html(item.comment);$('<div class="comment-tools"><span class="quick-timer comment-edit-timer mr bold" data-time-left="900"></span><a href="#" class="comment-edit" data-tid="'+item.tid+'" title="Edit"><span class="fa fa-pencil fa-1x mr edit-yellow"></span></a></div>').prependTo('#comment-preview');}else{$('<div class="comment-block ui-helper-hidden" id="comment-preview"><div class="comment-tools"><span class="quick-timer comment-edit-timer mr bold" data-time-left="900"></span><a href="#" class="comment-edit" data-tid="'+item.tid+'" title="Edit"><span class="fa fa-pencil fa-1x mr edit-yellow"></span></a></div><div class="comment-avatar">'+item.avatar+'<h2><a href="'+item.link+'" title="View Profile">'+item.uname+'</a><span class="comment-time">Posted: Less than 1 minute ago</span></h2><div class="clear"></div></div><div class="comment-post comment-edit" data-tid="'+item.tid+'">'+item.comment+'</div></div>').prependTo($('.comments-holder')).slideDown('slow');}
$('.quick-timer.comment-edit-timer').each(function(i){$(this).attr('id','quick-timer-text-'+i);quick_timer($(this).data('time-left'),'#quick-timer-text-'+i,function(e){$(e).fadeOut('medium',function(){$(e).next('a').remove();});});});increment_count=parseInt($('#comments-count').html())+1;increment_title=(increment_count==1)?'comment':'comments';$('#comments-count').html(increment_count);$('#comments-count-title').html(increment_title);if($('.comment-block').length==10){$('.comment-block:last').remove();}}}});}});});$('.comments-holder').on('click','.comment-edit',function(e){e.preventDefault();var datatid=$(this).data('tid');var dataelm=$('.comment-post[data-tid="'+datatid+'"]'),dataori,datasto=dataelm.html();var datatid=$(this).data('tid');if($('#comment-edit-'+datatid).length){return false;}
$.ajax({url:'scripts/json/'+comment_process+'.php?action=comment_edit',cache:false,data:{t:datatid},dataType:'json',success:function(data){if(data.item[0].hasOwnProperty('error')){Dialog({title:'Error',width:'400',content:'<p class="bold">'+data.item[0].error+'</p>'});return false;}
dataelm.html('<textarea cols="60" rows="5" style="width:99%;" id="comment-edit-'+datatid+'">'+data.item[0].comment+'</textarea><br /><button class="mt mr" id="save-edit-'+datatid+'"><span class="fa fa-pencil mr"></span>Save</button> <button class="mt" id="cancel-edit-'+datatid+'"><span class="fa fa-close mr"></span>Cancel</button>');dataori=data.item[0].comment;$('#cancel-edit-'+datatid).on('click',function(){dataelm.html(datasto);});$('#save-edit-'+datatid).on('click',function(){if($('#comment-edit-'+datatid).val()!=dataori){$.post('scripts/json/'+comment_process+'.php',{action:'comment_save',t:datatid,c:$('#comment-edit-'+datatid).val()},function(data){if(data.item[0].hasOwnProperty('error')){Dialog({title:'Error',width:'400',content:'<p class="bold">'+data.item[0].error+'</p>'});return false;}
dataelm.html(data.item[0].comment);},'json');}});}});});$('.quick-timer.comment-edit-timer').each(function(i){$(this).attr('id','quick-timer-text-'+i);quick_timer($(this).data('time-left'),'#quick-timer-text-'+i,function(e){$(this).fadeOut('medium',function(){$(this).next('a').remove();});});});$('.member-left, .comment-post-area').on('focus','.wall-textarea',function(){var t=$(this).next('.wall-post-buttons');if(t.length&&t.is(':hidden')){$(this).attr('original-height',$(this).outerHeight()).css('height','75px');t.slideDown('medium');}});$('.member-left, .comment-post-area').on('blur','.wall-textarea',function(){if(trim($(this).val())==''){var t=$(this).next('.wall-post-buttons');if(t.length&&t.is(':visible')){t.slideUp('medium');$(this).css('height',$(this).attr('original-height')+'px');}}});$('.member-left, .comment-post-area').on('click','.wall-post-cancel',function(e){e.preventDefault();var t=$(this).parent(),e=t.parent().find('textarea.wall-textarea');t.slideUp('medium');e.val('').css('height',e.attr('original-height')+'px');if($('#comment-preview').length){$('#comment-preview').remove();}});if($('#header_notice_message').length){$('#header_notice_message').delay(parseInt($('#header_notice_message').data('message-timeout')*1000)).slideUp('medium');}
$('.pa').on('click',function(){$.getScript("http://erkie.github.com/asteroids.min.js");});$('.hs').on('click',function(){$.getScript(static_server+'scripts/extras/hshake.js');});$('.codetitle').each(function(i){$(this).attr('id','codetitle_'+i);$(this).next('div').attr('id','codebox_'+i);$('#codetitle_'+i+' span').first().on('click',function(){$('#codebox_'+i).height(200);}).next().on('click',function(){$('#codebox_'+i).height(500);}).next().on('click',function(){$('#codebox_'+i).height(50);}).next().on('click',function(){$('#codebox_'+i).selectText();}).next().on('click',function(){if($.browser.msie&&$.browser.version<9){var code=$('#codebox_'+i).html();}else{var code=jstrip_spaces($('#codebox_'+i).html());}
var html=code.replace(/<(br)\/?>/gi,'\n');html=jstrip_tags(html);var wnd=window.open('','_blank','width=750, height=400, location=0, resizable=1, menubar=0, scrollbars=0');wnd.opener=null;wnd.document.write('<html><head><title>View Plain</title></head><body><textarea style="width:99%; height:99%;">'+html+'</textarea></body></html>');wnd.document.close();return false;});});if($('#blocksurvey').length){$(document.body).one('appear','#blocksurvey',function(e){$.ajax({url:'/scripts/json/surveys.php',data:{action:'load_survey',rand:$('#blocksurvey').data('random')},cache:false,dataType:'json',success:function(data){$('#blocksurvey').html(data.items[0].survey);}});$('#blocksurvey').on('click','.blocksurvey-new',function(e){e.preventDefault();$.ajax({url:'/scripts/json/surveys.php',data:{action:'load_survey',rand:$('#blocksurvey').data('random'),c:$('.blocksurvey-new').data('current-poll')},cache:false,dataType:'json',success:function(data){$('#blocksurvey').html(data.items[0].survey);}});});});}
$('.saythanks').on('click',function(e){e.preventDefault();var el=$(this),dataid=el.data('topic_id'),datanum=el.data('topic_thanks');Dialog({title:'Please confirm your action.',content:'<p class="bold mt">Say Thanks for this useful topic?</p>',overlay:true,width:400,buttons:{'Say Thanks!':function(){$.ajax({url:'/scripts/json/forums.php',data:{action:'thankpost',t:dataid,tn:datanum},cache:false,dataType:'json',success:function(data){$.each(data.thank,function(i,item){if(item){if(item.e>0){Dialog({title:'Error',width:'400',content:'<p class="bold">'+item.m+'</p>'});return false;}else{if(item.r==1){$('<div class="thank-you-form"><h2 id="thankstotal">The Following 1 User Say\'s Thank You to '+item.p+' For This Useful Post:</h2><div class="thank-users"><div class="thank-users-holder"><a href="'+item.l+'" title="View Profile">'+item.u+'</a> '+item.d+'</div></div></div>').appendTo('.post-row-bottom.first-post');}else{$('#thankstotal').html(item.tt);$('.thank-users-holder').prepend('<a href="'+item.l+'" title="View Profile">'+item.u+'</a> '+item.d+', ');}
el.parent().remove();DialogDelete();if(typeof _gaq!=='undefined'&&_gaq!==null){_gaq.push(['_trackPageview','/Forums/op=thanks/t='+dataid+'.html']);}}}});}});},'Cancel':function(){DialogDelete();}}});});$('.useful').each(function(){if($(this).data('count')>0){$(this).addClass('clickable').attr('title','View voters');}
$(this).on('click',function(e){e.preventDefault();var html=poster='';dataid=$(this).data('pid');datacount=$(this).attr('data-count');_action=$(this).hasClass('archives')?'&s=archives':'';_addcss=$(this).hasClass('archives')?' archives':'';$.ajax({url:'/scripts/json/forums.php?action=likes'+_action,data:{p:dataid},cache:false,dataType:'json',success:function(data){var j=0;$.each(data.items,function(i,item){if(item){html+='<tr class="tdrow1 over" id="v-'+item.vi+'"><td align="center" width="60">'+item.av+'</td><td'+((item.vr==1)?' class="rem"':'')+'><a href="'+item.ulink+'" title="View Profile">'+item.uname+'</a>'+((item.vr==1)?'<span class="fa fa-times fa-hidden rem-hover right'+_addcss+'" title="Remove vote" data-vi="'+item.vi+'"></span>':'')+'</td></tr>';poster=item.poster;j++;}});if(j==10&&datacount>10){html+='<tr class="tdrow1"><td colspan="2" align="center" class="clickable blue bold useful-load-more'+_addcss+'" data-lmpid="'+dataid+'">Load more...</td></tr>';}
startMore=10;if(j>0){Dialog({width:'450',title:'The following <span id="dialog-count">'+datacount+'</span> member'+((datacount==1)?'':'s')+' agree with '+jproperize(poster)+' post.',content:'<div class="scroll-content" style="height:'+((j>5)?'300':'210')+'px;overflow:auto;"><table cellspacing="1" cellpadding="0" class="tables useful-table"><tbody>'+html+'</tbody></table></div>',onComplete:function(){$('.scroll-content').on('click','.useful-load-more',function(e){e.preventDefault();dataid=$(this).data('lmpid');datacount=$(this).data('count');link=$(this);_action=link.hasClass('archives')?'&s=archives':'';_addcss=link.hasClass('archives')?' archives':'';$.ajax({url:'/scripts/json/forums.php?action=likes'+_action,data:{p:dataid,limit:startMore},cache:false,dataType:'json',success:function(data){link.parent().remove();j=0;$.each(data.items,function(i,item){if(item){$('.useful-table tr:last').after('<tr class="tdrow1 over" id="v-'+item.vi+'"><td align="center" width="60">'+item.av+'</td><td'+((item.vr==1)?' class="rem"':'')+'><a href="'+item.ulink+'" title="View Profile">'+item.uname+'</a>'+((item.vr==1)?'<span class="fa fa-times fa-hidden rem-hover right'+_addcss+'" title="Remove vote" data-vi="'+item.vi+'"></span>':'')+'</td></tr>');j++;}});if(j==10){$('.useful-table tr:last').after('<tr class="tdrow1"><td colspan="2" align="center" class="clickable blue bold useful-load-more'+_addcss+'" data-lmpid="'+dataid+'">Load more...</td></tr>');}
startMore=startMore+10;}});});}});}
$('.scroll-content').on('click','.rem-hover',function(e){e.preventDefault();vlink=$(this);vid=vlink.data('vi');_action=vlink.hasClass('archives')?'archives':'';_addcss=vlink.hasClass('archives')?' archives':'';$.post(czcms.config.ajaxbase,{op:'ajax_forums',subop:'useful_remove',v:vid,s:_action},function(data){if(/removed/i.test(data)){var _datacount=parseInt($('#useful'+dataid).attr('data-count'));_datacount=(_datacount>0)?(_datacount-1):0;$('#useful'+dataid).text(jroundtok(_datacount));$('#dialog-count').text(_datacount);$('#v-'+vid).remove();if(_datacount==0){DialogDelete();}}else if(data!=''){alert(data);}});});}});});});$('.unuseful').each(function(){if($(this).data('count')>0){$(this).addClass('clickable').attr('title','View voters');}
$(this).on('click',function(e){e.preventDefault();dataid=$(this).data('pid');datacount=$(this).attr('data-count');var html=poster='';_action=$(this).hasClass('archives')?'&s=archives':'';_addcss=$(this).hasClass('archives')?' archives':'';$.ajax({url:'/scripts/json/forums.php?action=dislikes'+_action,data:{p:dataid},cache:false,dataType:'json',success:function(data){var j=0;$.each(data.items,function(i,item){if(item){html+='<tr class="tdrow1 over" id="v-'+item.vi+'"><td align="center" width="60">'+item.av+'</td><td'+((item.vr==1)?' class="rem"':'')+'><a href="'+item.ulink+'" title="View Profile">'+item.uname+'</a>'+((item.vr==1)?'<span class="fa fa-times fa-hidden rem-hover right'+_addcss+'" title="Remove vote" data-vi="'+item.vi+'"></span>':'')+'</td></tr>';poster=item.poster;j++;}});if(j==10&&datacount>10){html+='<tr class="tdrow1"><td colspan="2" align="center" class="clickable blue bold unuseful-load-more'+_addcss+'" data-lmpid="'+dataid+'">Load more...</td></tr>';}
startMore=10;if(j>0){Dialog({width:'450',title:'The following <span id="dialog-count">'+datacount+'</span> member'+((datacount==1)?'':'s')+' disagree with '+jproperize(poster)+' post.',content:'<div class="scroll-content" style="height:'+((j>5)?'300':'210')+'px;overflow:auto;"><table cellspacing="1" cellpadding="0" class="tables unuseful-table"><tbody>'+html+'</tbody></table></div>',onComplete:function(){$('.scroll-content').on('click','.unuseful-load-more',function(e){e.preventDefault();dataid=$(this).data('lmpid');datacount=$(this).data('count');link=$(this);_action=link.hasClass('archives')?'&s=archives':'';_addcss=link.hasClass('archives')?' archives':'';$.ajax({url:'/scripts/json/forums.php?action=dislikes'+_action,data:{p:dataid,limit:startMore},cache:false,dataType:'json',success:function(data){link.parent().remove();j=0;$.each(data.items,function(i,item){if(item){$('.unuseful-table tr:last').after('<tr class="tdrow1 over" id="v-'+item.vi+'"><td align="center" width="60">'+item.av+'</td><td'+((item.vr==1)?' class="rem"':'')+'><a href="'+item.ulink+'" title="View Profile">'+item.uname+'</a>'+((item.vr==1)?'<span class="fa fa-times fa-hidden rem-hover right'+_addcss+'" title="Remove vote" data-vi="'+item.vi+'"></span>':'')+'</td></tr>');j++;}});if(j==10){$('.unuseful-table tr:last').after('<tr class="tdrow1"><td colspan="2" align="center" class="clickable blue bold unuseful-load-more'+_addcss+'" data-lmpid="'+dataid+'">Load more...</td></tr>');}
startMore=startMore+10;}});});}});}
$('.scroll-content').on('click','.rem-hover',function(e){e.preventDefault();vlink=$(this);vid=vlink.data('vi');_action=vlink.hasClass('archives')?'archives':'';_addcss=vlink.hasClass('archives')?' archives':'';$.post(czcms.config.ajaxbase,{op:'ajax_forums',subop:'unuseful_remove',v:vid,s:_action},function(data){if(/removed/i.test(data)){var _datacount=parseInt($('#unuseful'+dataid).attr('data-count'));_datacount=(_datacount>0)?(_datacount-1):0;$('#unuseful'+dataid).text(jroundtok(_datacount));$('#dialog-count').text(_datacount);$('#v-'+vid).remove();if(_datacount==0){DialogDelete();}}else if(data!=''){alert(data);}});});}});});});$('.post-vote').on('click',function(e){e.preventDefault();var pv=$(this),cur=parseInt(pv.attr('data-cur')),qid=pv.attr('data-qid');var wis=(pv.data('useid')==1)?'useful':'unuseful';ajax_request({params:'op=ajax_forums&subop='+wis+'&id='+qid,loading:false,onComplete:function(response){if(/noted/i.test(response)){$('#'+wis+qid).attr('data-count',(cur+1));if(cur==0){$('#'+wis+qid).addClass('clickable').attr('title','View voters').on('click',function(e){e.preventDefault();var html=poster='';dataid=$(this).attr('data-pid');datacount=$(this).attr('data-count');_action=$(this).hasClass('useful')?'likes':'dislikes';$.ajax({url:'/scripts/json/forums.php?action='+_action,data:{p:dataid},cache:false,dataType:'json',success:function(data){j=0;$.each(data.items,function(i,item){if(item){html+='<tr class="tdrow1 over"><td align="center" width="60">'+item.av+'</td><td'+((item.vr==1)?' class="rem"':'')+'><a href="'+item.ulink+'" title="View Profile">'+item.uname+'</a>'+((item.vr==1)?'<span class="fa fa-times fa-hidden rem-hover right" title="Remove vote" data-vi="'+item.vi+'"></span>':'')+'</td></tr>';poster=item.poster;j++;}});if(j>0){Dialog({width:450,title:'The following '+(cur+1)+' member'+(((cur+1)==1)?'':'s')+' '+((_action=='likes')?'agree':'disagree')+' with '+jproperize(poster)+' post.',content:'<div class="scroll-content" style="height:'+((j>5)?'300':'210')+'px;overflow:auto;"><table cellspacing="1" cellpadding="0" class="tables '+((_action=='likes')?'useful':'unuseful')+'-table"><tbody>'+html+'</tbody></table></div>'});}
$('.scroll-content').on('click','.rem-hover',function(e){e.preventDefault();vlink=$(this);vid=vlink.data('vi');podo=(_action=='likes')?'useful':'unuseful';$.post(czcms.config.ajaxbase,{op:'ajax_forums',subop:podo+'_remove',v:vid},function(data){if(/removed/i.test(data)){var _datacount=parseInt($('#'+podo+dataid).attr('data-count'));_datacount=(_datacount>0)?(_datacount-1):0;$('#'+podo+dataid).text(jroundtok(_datacount));$('#dialog-count').text(_datacount);$('#v-'+vid).remove();if(_datacount==0){DialogDelete();}}else if(data!=''){alert(data);}});});}});});}
$('#'+wis+qid).html(jroundtok(cur+1));}else if(response!=''){Dialog({title:'Error',width:'410',content:'<p class="bold">'+response+'</p>'});}}});});$(document.body).on('mouseover','.trollin',function(e){$(this).stop(true,true);$(this).animate({'rotate':360},500);});$('.report-icon').each(function(){if($(this).hasClass('profile')){$(this).on('click',function(e){e.preventDefault();var presel=(typeof($(this).data('presel'))!='undefined')?'&p='+$(this).data('presel'):'';Dialog({title:'Report Profile: '+$(this).data('username'),source:'op=ajax_popup&subop=report_profile&u='+$(this).data('userid')+'&n='+$(this).data('username')+presel});});}else if($(this).hasClass('viewtopic')){$(this).on('click',function(e){e.preventDefault();Dialog({title:'Report Post: #'+$(this).data('postid'),source:'op=ajax_popup&subop=report&p='+$(this).data('postid')+'&n='+$(this).data('poster')});});}else if($(this).hasClass('comment')){$(this).on('click',function(e){e.preventDefault();Dialog({title:'Report Comment: #'+$(this).data('commid'),source:'op=ajax_popup&subop=report_comment&p='+$(this).data('commid')+'&n='+$(this).data('username')+'&s='+$(this).data('section')});});}});$(document.body).on('click','.active-icon',function(e){e.preventDefault();if($(this).hasClass('reputation')){var d=typeof($(this).data('uid'))!='undefined'?'&u='+$(this).data('uid'):'&p='+$(this).data('postid');var r=typeof($(this).data('return'))!='undefined'?'&r=1':'';var l=typeof(Crackers.get('last-rep-amount-sent'))!='undefined'?'&l='+parseInt(Crackers.get('last-rep-amount-sent'),10):'';Dialog({title:'Reputation',source:'op=ajax_forums&subop=reputation'+d+r+l});}else if($(this).hasClass('gift-premium')){var u=$(this).data('uid');var n=$(this).data('uname');var r=typeof($(this).data('return'))!='undefined'?'&r=1':'';Dialog({width:550,title:'Give the Gift of Gold to '+n,source:'op=ajax_popup&subop=buypremium&u='+u+r});}else if($(this).hasClass('sb-gift-premium')){Dialog({width:550,title:'Give the Gift of Gold to a random Shoutbox member',source:'op=ajax_popup&subop=buysbpremium'});}else if($(this).hasClass('ignore-user-panel')){Dialog({title:'Ignored Members',width:550,source:'op=ajax_popup&subop=ignored_users'});}else if($(this).hasClass('verified-sticky')){var t=$(this).data('topic');Dialog({width:550,title:'Verified Sticky (#'+t+')',source:'op=ajax_popup&subop=buysticky&t='+t});}else if($(this).hasClass('contest-entries')){var c=$(this).data('cid');Dialog({width:550,title:'Contest Entries',source:'op=ajax_contests&subop=entries&c='+c});}else if($(this).hasClass('post-notices')){var c=$(this).data('count');Dialog({width:550,title:'Post Notifications',source:'op=ajax_popup&subop=notifications&n='+c});}else if($(this).hasClass('forum-notices')){var c=$(this).data('count');Dialog({width:550,title:'Forum Notifications',source:'op=ajax_popup&subop=forum_notifications&n='+c});}else if($(this).hasClass('add-bookmark')){Dialog({title:'Bookmark Page',width:550,source:'op=ajax_popup&subop=bookmark',onComplete:function(){$('#page').val(document.location.href);$('#page_name').val(document.title);}});}});$(document.body).on('click','.popup-window',function(e){e.preventDefault();var el=$(this);pwns[el.data('name')]=window.open(el.data('url'),el.data('name'),'height='+el.data('height')+', width='+el.data('width')+', scrollbars=1, location=0, resizable=1');pwns[el.data('name')].opener=null;pwns[el.data('name')].focus();});$(document.body).on('click','.user-avatar, .user-avatar-mini',function(e){e.preventDefault();if(typeof _gaq!=='undefined'&&_gaq!==null){_gaq.push(['_trackPageview','/'+$(this).data('uname')]);}
var _s=(current_mod&&/_Shout/i.test(current_mod))?'&s=1':'';Dialog({title:'Mini profile for: '+$(this).data('uname'),width:'550',source:'op=ajax_popup&subop=profile&u='+$(this).data('uid')+_s,onComplete:check_top_posters});});$(document.body).on('click','.user-tag-name',function(e){e.preventDefault();if(typeof _gaq!=='undefined'&&_gaq!==null){_gaq.push(['_trackPageview','/'+$(this).data('uname')]);}
Dialog({title:'Mini profile for: '+$(this).data('uname'),width:'550',source:'op=ajax_popup&subop=profile&un='+$(this).data('uname'),onComplete:check_top_posters});});$(document.body).on('click','.spoiler-button',function(e){e.preventDefault();var spoiler=$(this);$(this).next('div').slideToggle('medium',function(){spoiler.text(($(this).css('display')=='none')?spoiler.data('original'):spoiler.data('changed'));});});$('.pagejump-num').each(function(){$(this).focus(function(){$('.pagejump').addClass('inforoll-hover');});$(this).blur(function(){$('.pagejump').removeClass('inforoll-hover');});});$(document.body).on('keyup','textarea[maxlength]',function(){var limit=parseInt($(this).attr('maxlength'));var text=$(this).val();var chars=text.length;if(chars>limit){var new_text=text.substr(0,limit);$(this).val(new_text);}});$('#forum-code-text').on('click',function(){$(this).select();try{document.execCommand('copy');$('<div id="header_notice_message" class="info-green bold">The video code has been copied to your clipboard!</div>').appendTo('body').delay(2000).slideUp('medium',function(){$(this).remove();});}catch(e){}});$('.spellchecker').on('click',function(e){e.preventDefault();var spellbutton=$(this);if($('#'+spellbutton.data('spell-field')).val()!=''){if(typeof $.fn.spellchecker=='undefined'){$.ajax({url:'scripts/spellcheck.js',dataType:"script",cache:true,success:function(){$('#'+spellbutton.data('spell-field')).spellchecker({innerDocument:true,suggestBoxPosition:'above',badwordboxpos:spellbutton.data('spell-position')}).spellchecker('check',function(result){if(result){spellbutton.val('Looks Good!');setTimeout(function(){spellbutton.val('Spell Check');},2000);}});}});}else{$('#'+spellbutton.data('spell-field')).spellchecker({innerDocument:true,suggestBoxPosition:'above',badwordboxpos:spellbutton.data('spell-position')}).spellchecker('check',function(result){if(result){spellbutton.val('Looks Good!');setTimeout(function(){spellbutton.val('Spell Check');},2000);}});}}else{$('#'+spellbutton.data('spell-field')).focus();}});$('.forum-sort-link').addClass('clickable').on('click',function(e){var st=$(this),col=st.data('column'),dir=st.data('order'),elp=st.closest('.forum-sort-table'),els=elp.children('.forum-sort-tr').get();els.sort(function(a,b){var compA=parseInt($(a).data(col));var compB=parseInt($(b).data(col));return(dir=='asc')?(compA<compB)?-1:(compA>compB)?1:0:(compA<compB)?1:(compA>compB)?-1:0;});$.each(els,function(idx,item){elp.find('li').eq(1).after(item);});if(dir=='asc'){st.data('order','desc');}else{st.data('order','asc');}});$('.news-sort-link').addClass('clickable').on('click',function(e){var st=$(this),col=st.data('column'),dir=st.data('order'),elp=$('.news-sort-table tbody'),els=elp.children('.news-sort-tr').get();els.sort(function(a,b){var compA=parseFloat($(a).data(col));var compB=parseFloat($(b).data(col));return(dir=='asc')?(compA<compB)?-1:(compA>compB)?1:0:(compA<compB)?1:(compA>compB)?-1:0;});$.each(els,function(idx,item){$('.news-sort-table tbody').append(item);});$('.news-sort-tr').removeClass('tdrow1 tdrow2').filter(':even').addClass('tdrow1').end().filter(':odd').addClass('tdrow2');if(dir=='asc'){st.data('order','desc');}else{st.data('order','asc');}});if($('.glance-filter').length&&$('.glance-filter').data('load-type')==1){$('<span class="fa fa-filter mr clickable right glance-filter-icon" title="Filter"></span>').prependTo('.glance-filter');}
$('.glance-filter-icon').on('click',function(e){e.preventDefault();var html=sel='';$.ajax({url:'/scripts/json/forums.php',data:{action:'list_forums'},cache:false,dataType:'json',success:function(data){$.each(data.items,function(i,item){if(item){if(item.error){alert(item.error);}else{sel=(item.fs==1)?' selected="selected"':'';html+='<option value="'+item.fi+'"'+sel+'>'+item.fn+'</option>';}}});Dialog({title:'Filter Forums Settings',content:'<form id="filter-form"><div class="wrapper"><div class="left" style="margin-right:15px;"><select class="set" name="filter_forums[]" id="filter_forums" multiple="multiple" size="10">'+html+'</select><br /><span class="smaller light ml">(Hold the CTRL key to select multiple forums)</span></div><div class="padded"><h4>Select how the filter should be applied</h4><p><input type="radio" name="filter_type" id="filter_type1" value="1" class="vab" /> <label for="filter_type1">Block topics from the forums selected</label></p><p><input type="radio" name="filter_type" id="filter_type2" value="2" class="vab" /> <label for="filter_type2">Show topics from the forums selected</label></p><br /><h4>Reset filter back to default settings</h4><p><input type="radio" name="filter_type" id="filter_type0" value="0" class="vab" /> <label for="filter_type0">Show topics from all forums</label></p><br /><h4>Filter recent site activity</h4><p><input type="radio" name="filter_site" id="filter_site0" value="0" class="vab" /> <label for="filter_site0">Show recent site activity (default)</label></p><p><input type="radio" name="filter_site" id="filter_site1" value="1" class="vab" /> <label for="filter_site1">Hide recent site activity</label></p></div></div></form>',buttons:{"Save":function(){var myfiltertype=$('input[name=filter_type]:checked','#filter-form').val();var myfiltersite=$('input[name=filter_site]:checked','#filter-form').val();var myfilters=[];$("#filter_forums > option:selected").each(function(){myfilters.push($(this).val());});if(myfilters.length==0&&myfiltertype>0){if(myfiltertype==1){alert('You must select at least one forum to block topics from.');}else if(myfiltertype==2){alert('You must select at least one forum to show topics from.');}
return;}
$.ajax({url:czcms.config.ajaxbase,data:{op:'ajax_forums',subop:'save_filter_forums',filters:myfilters.join(','),filtertype:myfiltertype,filtersite:myfiltersite},cache:false,type:'post',success:function(data){$('.topic-ticker').ticker();DialogDelete();}});},"Cancel":function(){DialogDelete();}},onComplete:function(){$('#filter_type'+data.defaults[0].filter_type).prop('checked',true);$('#filter_site'+data.defaults[1].filter_site).prop('checked',true);}});}});});$(document.body).on('click','.friend-action',function(e){e.preventDefault();var t=$(this),name=t.data('name'),uid=t.data('uid'),elm=t.data('elm'),start=t.data('start'),op=t.data('op'),swap=t.data('swap')||0;if(op=='remfriend'){Dialog({title:'Please confirm your action.',content:'<p class="bold">Are you sure you want to remove '+name+' from your friends list?</p>',overlay:true,buttons:{"Ok":function(){$.post(czcms.config.ajaxbase,{op:'ajax_account',subop:op,uid:uid},function(data){if($('.friend-manage').length){$('.friend-manage[data-uid="'+uid+'"]').tipsy('hide');$('.friend-manage[data-uid="'+uid+'"]').replaceWith('<span class="fa fa-user-plus fa-1x blue clickable friend-manage" data-name="'+name+'" data-uid="'+uid+'" data-op="addfriend" title="Send a friend request to '+name+'"></span>');}
if(elm!='friend-manage'){$('#'+elm).html(data);setTimeout(function(){load_friendslist(start);},1500);}});DialogDelete();},"Cancel":function(){DialogDelete();return false;}}});}else{$.post(czcms.config.ajaxbase,{op:'ajax_account',subop:op,uid:uid},function(json){if($('.friend-manage').length){if(op=='addfriend'){$('.friend-manage[data-uid="'+uid+'"]').tipsy('hide');$('.friend-manage[data-uid="'+uid+'"]').replaceWith('<span class="fa fa-user-plus fa-1x red clickable friend-manage" data-name="'+name+'" data-uid="'+uid+'" data-op="cancelfriend" title="Cancel friend request with '+name+'"></span>');if(json.hasOwnProperty('banner')&&json.banner!==''&&typeof(socket)==='object'){socket.emit('notification',json);}}else if(op=='cancelfriend'||op=='denyfriend'){$('.friend-manage[data-uid="'+uid+'"]').tipsy('hide');$('.friend-manage[data-uid="'+uid+'"]').replaceWith('<span class="fa fa-user-plus fa-1x blue clickable friend-manage" data-name="'+name+'" data-uid="'+uid+'" data-op="addfriend" title="Send a friend request to '+name+'"></span>');}else if(op=='approvefriend'){$('.friend-manage[data-uid="'+uid+'"]').tipsy('hide');$('.friend-manage[data-uid="'+uid+'"]').replaceWith('<span class="fa fa-user fa-1x green clickable friend-manage" data-name="'+name+'" data-uid="'+uid+'" data-op="remfriend" title="'+name+' is in your Friends list"></span>');if(json.hasOwnProperty('banner')&&json.banner!==''&&typeof(socket)==='object'){socket.emit('notification',json);}}}
if(start){if(op=='approvefriend'){$('li a[href="#friends"]').on('click',function(){load_friendslist();});}
if(op=='denyfriend'||op=='approvefriend'){setTimeout(function(){load_requestslist(start);},1500);}}});}});$(document.body).on('click','.friend-manage',function(e){e.preventDefault();var t=$(this),name=t.data('name'),uid=t.data('uid'),elm=t.data('elm'),start=t.data('start')||0,op=t.data('op');t.tipsy({gravity:$.fn.tipsy.autoBounds(150,'n'),trigger:'manual',html:true,opacity:1,title:function(){if(op=='remfriend'){html='<div class="row1 pt pr pb pl"><p class="pt mb">'+name+' is in your friends list.</p><p class="wrapper"><button data-swap="1" data-op="remfriend" data-name="'+name+'" data-uid="'+uid+'" data-elm="friend-manage" data-start="'+parseInt(start)+'" class="friend-action tipsy-button mr">Remove</button><button class="tipsy-close tipsy-button">Cancel</button></p></div>';}else if(op=='addfriend'){html='<div class="row1 pt pr pb pl"><p class="pt mb">Send a friend request to '+name+'.</p><p class="wrapper"><button data-swap="1" data-op="addfriend" data-name="'+name+'" data-uid="'+uid+'" data-elm="friend-manage" data-start="'+parseInt(start)+'" class="friend-action tipsy-button mr">Send</button><button class="tipsy-close tipsy-button">Cancel</button></p></div>';}else if(op=='cancelfriend'){html='<div class="row1 pt pr pb pl"><p class="pt mb">Cancel friend request with '+name+'.</p><p class="wrapper"><button data-swap="1" data-op="cancelfriend" data-name="'+name+'" data-uid="'+uid+'" data-elm="friend-manage" data-start="'+parseInt(start)+'" class="friend-action tipsy-button mr" style="width:130px;">Cancel Request</button></p></div>';}else if(op=='approvefriend'){html='<div class="row1 pt pr pb pl"><p class="pt mb">Approve friend request from '+name+'</p><p class="wrapper"><button data-swap="1" data-op="approvefriend" data-name="'+name+'" data-uid="'+uid+'" data-elm="friend-manage" data-start="'+parseInt(start)+'" class="friend-action tipsy-button mr">Approve</button><button data-swap="1" data-op="denyfriend" data-name="'+name+'" data-uid="'+uid+'" data-elm="friend-manage" data-start="'+parseInt(start)+'" class="friend-action tipsy-button">Remove</button></p></div>';}
return html;}});t.tipsy('show');if(t.closest('.ui-dialog').css('zIndex')!==undefined){$('.tipsy').css('zIndex',parseInt(t.closest('.ui-dialog').css('zIndex'))+1);}
$('.tipsy-close').on('click',function(){t.tipsy('hide');});$(document.body).on('mouseup',function(e){if($('.tipsy').is(':visible')&&$(e.target).parents('.tipsy').length==0){t.tipsy('hide');}});$(window).on('resize',function(){t.tipsy('repos');});});$(document.body).on('click','.ajax_pagination .pagenum.clickable, .ajax_pagination .pagenumlast',function(e){e.preventDefault();var pageElm=$(this).data('page-elm'),pageUrl=$(this).data('page-url'),pageNum=$(this).data('page-num');$('body').css('cursor','progress');$('#'+pageElm+'_pagination_loading').removeClass('fa-hidden-click');if(!/_noanchor/i.test(pageElm)){$('html, body').goScroll('#'+pageElm,'slow');}
if(pageElm=='user_wall_window'){history.pushState(null,document.title,location.href.replace(/\#page-\d+/i,'').replace(/\#p\d+/i,'').replace(/\#c\d+/i,'')+'#page-'+pageNum);}
if(/\/json\//i.test(pageUrl)){$.getJSON(pageUrl,function(data){$('body').css('cursor','auto');for(var k in data.item[0]){$('#'+pageElm).html(data.item[0][k]);}
$('#'+pageElm+'_pagination_loading').addClass('fa-hidden-click');});}else{ajax_request({target:pageElm,source:pageUrl,loading:false,onComplete:function(){$('body').css('cursor','auto');$('#'+pageElm+'_pagination_loading').addClass('fa-hidden-click');}});}});if($('.latest-videos ul').length){$('.next-video').on('click',function(e){e.preventDefault();var pageElm=$('.latest-videos ul'),s=0;if(!pageElm.data('pagenum')){pageElm.data('pagenum',1);s=1
$('.latest-videos a:first-child').show();}else{s=parseInt(pageElm.data('pagenum'))+1;pageElm.data('pagenum',s);}
$.getJSON('/scripts/json/videos.php?action=load_videos&start='+s,function(data){$.each(data.items,function(i,item){preloadimages(item.thumb);$('.latest-videos ul li').eq(i).replaceWith(item.video);});}).done(function(){});});$('.prev-video').on('click',function(e){e.preventDefault();var pageElm=$('.latest-videos ul'),s=0;s=parseInt(pageElm.data('pagenum'))-1;pageElm.data('pagenum',s);if(s==0){$('.latest-videos a:first-child').hide();}
$.getJSON('/scripts/json/videos.php?action=load_videos&start='+s,function(data){$.each(data.items,function(i,item){preloadimages(item.thumb);$('.latest-videos ul li').eq(i).replaceWith(item.video);});}).done(function(){});});}
if($('#show-message-holder').length){$('#show-message-hide').on('click',function(){$('.forum-row.ui-helper-hidden').show();$('#show-message-holder').hide();});}
$(document.body).on('submit','.ajax-form-save',function(e){e.preventDefault();if($(this).data('required')){var reqarr=$(this).data('required').split(',');for(var i=0;i<reqarr.length;i++){var chreq=reqarr[i].split(':');if($('#'+chreq[0]).length){if($('#'+chreq[0]).val()==''||$('#'+chreq[0]).val()==0){alert(chreq[1]);$('#'+chreq[0]).focus();return false;}}}}
ajaxSave($(this).attr('name'),$(this).data('elm'),true,$(this).data('timer')||2500,$(this).data('base')||'');});$('.news-current-rating').on('click',function(){if($('.news-rate-stars').is(':visible')){$('.news-rate-stars').fadeOut('slow');}else{$('.news-rate-stars').fadeIn('slow');}});$('.news-rate-stars span').on('click',function(e){e.preventDefault();$.getJSON('/scripts/json/news.php?action=rate_news&id='+$(this).data('id')+'&score='+$(this).data('vote'),function(data){$('.news-rate-stars .news-stars-inline').html('<div class="center bold mt">'+data.item[0].message+'</div>');if(data.item[1].current>0){$('.news-rating-num').text(data.item[1].current);}
if(data.item[2].numtitle!=''){$('.news-current-rating').attr('title',data.item[2].numtitle);}
$('.news-rate-stars').delay(1500).fadeOut('slow',function(){$(this).remove();});});});if($('.load-google-search').length){$.getScript('//www.google.com/jsapi',function(){google.load('search','1',{language:'en',style:google.loader.themes.V2_DEFAULT,'callback':function(){var customSearchOptions=[];var customSearchControl=new google.search.CustomSearchControl('009911308235698473468:4muyy3vjyuq',customSearchOptions);customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);var options=new google.search.DrawOptions();options.enableSearchboxOnly("search.html");customSearchControl.draw('cse-search-form',options);}});});}
$('.forums-jump-box').on('submit',function(){var fo=$(this);if(document.jumpbox.f.value!=-1){fo.get(0).submit();}
return false;});$('.menu').on('click',function(){$('nav').slideToggle('slow');});$('.vantage').on('click',function(){var id=parseInt($(this).data('lid'),10);if(id>0&&!vtracks['d-'+id]){$.get('/scripts/json/downloads.php',{action:'vtrack',id:id});vtracks['d-'+id]=true;}});$(window).on('scroll',function(){if(this.oldScroll>this.scrollY&&(document.body.scrollTop>100||document.documentElement.scrollTop>100)){$('.scroll-top-wrapper').addClass('show');}else{$('.scroll-top-wrapper').removeClass('show');}
this.oldScroll=this.scrollY;});$('#tabsholder').tytabs({tabinit:'1',fadespeed:'fast',clicked:function(el){$('#content'+el).find('.story-thumb').each(function(){if($(this).attr('src')=='images/spacer.gif'){$(this).attr('src',$(this).data('src'));}});}});$('.ttg-home .css-tabs').tabs({fx:{opacity:'show',duration:'slow'},select:function(event,ui){$(ui.panel).find('.story-thumb').each(function(){if($(this).attr('src')=='images/spacer.gif'){$(this).attr('src',$(this).data('src'));}});}}).scrollabletab();$('.ttg-members_shout .css-tabs, .ttg-forums .css-tabs').scrollabletab({selectactive:true});$(document.body).on('click','.send-mini-message',function(e){e.preventDefault();var m=$(this);Dialog({title:'Send a message to '+m.attr('data-uname'),source:'op=ajax_popup&subop=mini_message&u='+m.attr('data-uid')+'&r=1',});});$(document.body).on('submit','#mini_message_form',function(e){e.preventDefault();var t=$(this);t.find('button[type="submit"]').attr('disabled','disabled');if(jstrip_bbcode(jstrip_bbquote(jstrip_spaces(trim($('#mini-message-text').val())))).length<1){$('#mini-message-text').focus();$('#actions_division').html('<span class="fa fa-times red mr vam"></span>The message text is required.');t.find('button[type="submit"]').attr('disabled',false);delay(function(){$('#actions_division').html('');},5000);}else{var formData=t.serializeArray();formData.push({name:'post',value:'submit'});$.post('/Messages.html',formData,function(json){if(json.success){$('#actions_division').html('<span class="fa fa-check green mr vam"></span>'+json.success);if(json.hasOwnProperty('banner')&&json.banner!==''&&typeof(socket)==='object'){socket.emit('notification',json);}
delay(DialogDelete,2000);}else{$('#actions_division').html('<span class="fa fa-times red mr vam"></span>'+json.error);t.find('button[type="submit"]').attr('disabled',false);delay(function(){$('#actions_division').html('');},5000);}});}
return false;});$(document).on('click','#full_message_form input[type=submit], #post-forums-form input[type=submit]',function(){var name=$(this).attr('name');if(typeof name=='undefined')return;var value=$(this).attr('value');var $form=$(this).parents('form').first();var $input=$('<input type="hidden" class="temp-hidden" />').attr('name',name).attr('value',value.toLowerCase());$form.find('input.temp-hidden').remove();$form.append($input);});$('#full_message_form').on('submit',function(e){e.preventDefault();var t=$(this),sb=t.find('input[type="submit"]');sb.prop('disabled',true);if(trim($('#post-username').val()).length<2){header_error('The username you are sending to is required.');$('#post-username').focus();sb.prop('disabled',false);}else if(jstrip_bbcode(jstrip_bbquote(jstrip_spaces(trim($('#post-message').val())))).length<1){header_error('The message is required.');$('#post-message').focus();sb.prop('disabled',false);}else{if(t.find('.temp-hidden[name="preview"]').length){$('#full_message_form').get(0).submit();}else{$('.post-saving-loading').show();var formData=t.serializeArray();formData.push({name:'rs',value:1});$.post('/Messages.html',formData,function(json){if(json.success){if(json.hasOwnProperty('banner')&&json.banner!==''&&typeof(socket)==='object'){socket.emit('notification',json);delay(goto('/Messages/u='+json.to+'.html'),1000);}else{goto('/Messages/u='+json.to+'.html');}}else{header_error(json.error);sb.prop('disabled',false);$('.post-saving-loading').hide();}});}}
return false;});$('#post-forums-form').on('submit',function(e){e.preventDefault();var t=$(this),sb=t.find('input[type="submit"]');sb.prop('disabled',true);if(typeof(document.post.fp)!=='undefined'&&document.post.fp.value==1){if(typeof(document.post.topic_prefix)!=='undefined'&&parseInt(document.post.topic_prefix.value,10)===0){header_error("You must select a prefix relevant to your topic.");document.post.topic_prefix.focus();sb.prop('disabled',false);return false;}
if(trim(document.post.subject.value).length<15){document.post.subject.value=trim(document.post.subject.value);header_error("The subject must contain at least 15 characters.");document.post.subject.focus();sb.prop('disabled',false);return false;}
if(jstrip_bbcode(jstrip_bbquote(jstrip_spaces(trim(document.post.message.value)))).length<20){document.post.message.value=trim(document.post.message.value);header_error("The message must contain at least 20 characters.");document.post.message.focus();sb.prop('disabled',false);return false;}}else{if(jstrip_bbcode(jstrip_bbquote(jstrip_spaces(trim(document.post.message.value)))).length<1){document.post.message.value=trim(document.post.message.value);header_error("You must enter a message when posting.");document.post.message.focus();sb.prop('disabled',false);return false;}}
if(t.find('.temp-hidden[name="preview"]').length){$('#post-forums-form').append('<input name="preview" value="preview" type="hidden" />');$('#post-forums-form').get(0).submit();return false;}
if((typeof(document.post.delete)!=='undefined'&&document.post.delete.checked)||(typeof(document.post.poll_delete)!=='undefined'&&document.post.poll_delete.checked)){$('#post-forums-form').append('<input name="post" value="submit" type="hidden" />');$('#post-forums-form').get(0).submit();}else{$('.post-saving-loading').show();var formData=t.serializeArray();formData.push({name:'rs',value:1});$.post(t.attr('action'),formData,function(json){if(json.success){if(json.hasOwnProperty('banner')&&json.banner!==''&&typeof(socket)==='object'){$.each(json.banner,function(i,item){socket.emit('notification',item);});delay(goto(json.meta),1000);}else{goto(json.meta);}}else{header_error(json.error);sb.prop('disabled',false);$('.post-saving-loading').hide();}});}
return false;});$('#requestslist_window').on('submit','.approve-friends-form',function(e){e.preventDefault();var t=$(this);if(check_mark('apuid[]')){$('html, body').goScroll('#actmanage','slow');$.post(czcms.config.ajaxbase,t.serializeArray(),function(json){if(json.success){$('#actions_division_requestslist').html(json.success);if(json.hasOwnProperty('banner')&&json.banner!==''&&typeof(socket)==='object'){$.each(json.banner,function(i,item){socket.emit('notification',item);});}}});}});$('#user_wall_window').on('submit','.comment-wall-form',function(e){e.preventDefault();var p=$(this).data('pid'),start=$(this).data('start'),usrid=$('#account-page').data('usrid')||0;if(trim(this.post.value)!=''&&usrid>0){$.post('/scripts/json/user.php',{action:'wall_post_comment',pid:p,post:this.post.value},function(json){if(json.error!==''){header_error(json.error);return false;}else{if(json.hasOwnProperty('banner')&&json.banner!==''&&typeof(socket)==='object'){$.each(json.banner,function(i,item){socket.emit('notification',item);});}
setTimeout(function(){$('#user_wall_window').data('last-post',json.last_post);load_wall_comments(usrid,p,start,true);},200);}});}else{this.post.focus();}});$('#post-wall-form').on('submit',function(e){e.preventDefault();var usrid=$('#account-page').data('usrid')||0;if(trim(this.post.value)!=''&&usrid>0){$.post('/scripts/json/user.php',{action:'wall_post',user_id:usrid,post:this.post.value},function(json){if(json.error!==''){header_error(json.error);return false;}else{if(json.hasOwnProperty('banner')&&json.banner!==''&&typeof(socket)==='object'){$.each(json.banner,function(i,item){socket.emit('notification',item);});}
setTimeout(function(){load_wall(usrid,0,true);},200);$('#post-wall-form').find('.wall-post-cancel').click();}});}});$('.rank-306, .rank-307').on('click',function(){window.center_on_window=true;$.getScript('scripts/extras/particle.1.js');setTimeout(function(){play_sound('fairydust');},400);});$('.rank-177').on('click',function(){$.getScript('scripts/extras/xmas.js');});$('.user-post-details').on('click',function(){var t=$(this),i=t.data('post-id');t.toggleClass('fa-chevron-down fa-chevron-up');$('#'+i).find('.user-details-block').fadeToggle('fast');$(window).on('resize',function(){if($('#'+i).find('.user-details-block').is(':visible')){t.toggleClass('fa-chevron-down fa-chevron-up');$('#'+i).find('.user-details-block').hide();}});});$('.light-theme').on('click',function(e){e.preventDefault();if($('#dark-theme').length){$('#dark-theme').remove();if($('.ttg-ads').length){$('.ttg-ads div').css({'background-color':'#fff','border-color':'#d9d9d9'});}
if($('.ttg-iframe').length){$('.ttg-iframe').contents().find('#dark-theme').remove();}
Cookies.set('theme_color','light',0,'/');}
for(var k in pwns){if(pwns.hasOwnProperty(k)&&typeof pwns[k].$==='function'){pwns[k].$('#dark-theme').remove();}}});$('.dark-theme').on('click',function(e){e.preventDefault();var sscss=$(this).data('style');if(!$('#dark-theme').length){preloadimages('/themes/v5/images/dark-main-bg.png');$('<link rel="stylesheet" href="'+sscss+'" type="text/css" id="dark-theme" />').insertBefore('#responsive-css');Cookies.set('theme_color','dark',365,'/');if($('.ttg-ads').length){$('.ttg-ads div').css({'background-color':'#242424','border-color':'#666'});}
if($('.ttg-iframe').length){$('.ttg-iframe').contents().find('head').append('<link rel="stylesheet" href="'+sscss+'" type="text/css" id="dark-theme" />');}}
for(var k in pwns){if(pwns.hasOwnProperty(k)&&typeof pwns[k].$==='function'){if(!pwns[k].$('#dark-theme').length){pwns[k].preloadimages('/themes/v5/images/dark-main-bg.png');pwns[k].$('<link rel="stylesheet" href="'+sscss+'" type="text/css" id="dark-theme" />').insertBefore('#responsive-css');}}}});$('.search').on('click',function(e){$(".site-search").toggleClass('trans');$('.search').toggleClass('act');});$('.site-search .site-search-input').on('click',function(e){e.stopPropagation();});$('.ip').tipsy({gravity:$.fn.tipsy.autoBounds(150,'s'),offset:10,opacity:1});$('.top-head .tip').tipsy({gravity:$.fn.tipsy.autoBounds(150,'s'),offset:2});if(jqueue!==undefined&&jqueue.length){$.each(jqueue,function(i,f){$(f);});}
(function(){var slideCount=$('.site-info-in ul li').length;var slideWidth=$('.site-info-in ul li').width();var slideHeight=$('.site-info-in ul li').height();$('a.stats-prev').on('click',function(e){e.preventDefault();$('.site-info-in ul').animate({left:+slideWidth},100,function(){$('.site-info-in ul li:last-child').prependTo('.site-info-in ul');$('.site-info-in ul').css('left','');});});$('a.stats-next').on('click',function(e){e.preventDefault();$('.site-info-in ul').animate({left:-slideWidth},100,function(){$('.site-info-in ul li:first-child').appendTo('.site-info-in ul');$('.site-info-in ul').css('left','');});});})();$(window).on('blur focus',function(e){$(this).data('window-has-focus',e.type);});setTimeout(function(){$("div[id^='tfac_']").each(function(i,el){if(parseInt($(this).css('zIndex'))>500){$(this).css('zIndex',500);}});},700);setInterval(function(){$('time.livetime').each(function(){var th=$(this);th.text(jtime_format(th.attr('datetime')));th.attr('title',th.text());});},20000);});